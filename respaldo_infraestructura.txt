

########################################
ARCHIVO: .\.env
########################################

# =============================================================================
# GPUCHILE - Configuraci√≥n de Entorno Local
# =============================================================================

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres123
POSTGRES_DB=gpuchile

# -----------------------------------------------------------------------------
# Redis Cache
# -----------------------------------------------------------------------------
REDIS_PASSWORD=redis123

# -----------------------------------------------------------------------------
# Backend Security
# -----------------------------------------------------------------------------
SECRET_KEY=clave_secreta_super_segura_para_desarrollo_local_12345

# -----------------------------------------------------------------------------
# AWS S3 (NECESARIO PARA QUE EL BACKEND ARRANQUE)
# -----------------------------------------------------------------------------
# Aunque no uses AWS real, el c√≥digo valida que estas variables existan.
S3_BUCKET_NAME=gpuchile-dev-placeholder
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=fake
AWS_SECRET_ACCESS_KEY=fake

# -----------------------------------------------------------------------------
# Frontend Environment
# -----------------------------------------------------------------------------
VITE_API_URL=http://localhost:8000/api

########################################
ARCHIVO: .\.env.example
########################################

# =============================================================================
# GPUCHILE - Example Environment Variables
# =============================================================================

# PostgreSQL
POSTGRES_USER=postgres
POSTGRES_PASSWORD=change-me-please
POSTGRES_DB=gpuchile

# Redis
REDIS_PASSWORD=change-me-please

# Backend
SECRET_KEY=generate-with-python-secrets-module-min-32-chars

# Frontend
VITE_API_URL=http://localhost:8000/api


########################################
ARCHIVO: .\.gitignore
########################################

# Environment variables
.env
.env.local
.env.*.local

# Docker
docker-compose.override.yml

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/

# Node
node_modules/
dist/
.cache/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log
logs/

# Database
*.db
*.sqlite3


########################################
ARCHIVO: .\actualizar.json
########################################

{
  "name": "NVIDIA RTX 4090",
  "brand": "NVIDIA",
  "model": "RTX 4090",
  "price": 1699.99,
  "vram": 24,
  "cuda_cores": 16384,
  "image_url": "https://placehold.co/600x400/000000/76b900/png?text=NVIDIA+RTX+4090+Ultimate",
  "stock": 5,
  "description": "La bestia del gaming. 24GB VRAM, DLSS 3.0 y Ray Tracing.",
  "is_featured": true
}

########################################
ARCHIVO: .\backend-fix-validation.txt
########################################

=== SECURITY GROUPS ===
RDS SG: sg-082e01893875ee12f
EKS SG: sg-0855d4465534cdc26

=== RDS SG RULES (Port 5432) ===
[
    {
        "IpProtocol": "tcp",
        "FromPort": 5432,
        "ToPort": 5432,
        "UserIdGroupPairs": [
            {
                "Description": "PostgreSQL from EKS",
                "UserId": "380002980493",
                "GroupId": "sg-031747854ba1f5d3c"
            },
            {
                "UserId": "380002980493",
                "GroupId": "sg-0855d4465534cdc26"
            }
        ],
        "IpRanges": [],
        "Ipv6Ranges": [],
        "PrefixListIds": []
    }
]

=== POD STATUS ===
NAME                                READY   STATUS    RESTARTS   AGE
gpuchile-backend-7875db4b66-4rhbv   1/1     Running   0          119s

=== POD LOGS (√∫ltimas 20 l√≠neas) ===

=== BACKEND HEALTH CHECK ===
Backend not ready

=== API TEST ===
API not ready


########################################
ARCHIVO: .\deep-diagnostics.txt
########################################

=== POD DESCRIPTION ===
      memory:  512Mi
    Requests:
      cpu:     250m
      memory:  256Mi
    Environment Variables from:
      db-credentials  Secret  Optional: false
    Environment:
      AWS_REGION:                   us-east-1
      S3_BUCKET_NAME:               gpuchile-images-dev-nicolas-2026
      REDIS_URL:                    redis://redis-service.default.svc.cluster.local:6379/0
      AWS_STS_REGIONAL_ENDPOINTS:   regional
      AWS_ROLE_ARN:                 arn:aws:iam::380002980493:role/gpuchile-cluster-gpuchile-backend-sa-role
      AWS_WEB_IDENTITY_TOKEN_FILE:  /var/run/secrets/eks.amazonaws.com/serviceaccount/token
    Mounts:
      /var/run/secrets/eks.amazonaws.com/serviceaccount from aws-iam-token (ro)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-n44kt (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  aws-iam-token:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  86400
  kube-api-access-n44kt:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    Optional:                false
    DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age                 From               Message
  ----     ------     ----                ----               -------
  Normal   Scheduled  10m                 default-scheduler  Successfully assigned default/gpuchile-backend-7875db4b66-4rhbv to ip-10-0-102-77.ec2.internal
  Normal   Pulled     10m                 kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 137ms (137ms including waiting)
  Normal   Pulled     8m24s               kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 135ms (135ms including waiting)
  Normal   Pulled     5m55s               kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 141ms (141ms including waiting)
  Normal   Pulled     3m11s               kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 133ms (133ms including waiting)
  Warning  BackOff    17s (x7 over 6m9s)  kubelet            spec.containers{backend}: Back-off restarting failed container backend in pod gpuchile-backend-7875db4b66-4rhbv_default(822eb9c2-8017-4d02-b9be-291accbcadf8)
  Normal   Pulling    3s (x5 over 10m)    kubelet            spec.containers{backend}: Pulling image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest"
  Normal   Created    2s (x5 over 10m)    kubelet            spec.containers{backend}: Created container: backend
  Normal   Started    2s (x5 over 10m)    kubelet            spec.containers{backend}: Started container backend
  Normal   Pulled     2s                  kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 161ms (161ms including waiting)

=== POD IP ===
10.0.102.252

=== CONTAINER STATUS ===

=== ENVIRONMENT VARS (DB/REDIS) ===
DATABASE_URL=postgresql://postgres:postgres123@gpuchile-db-dev.co7isg2qyv82.us-east-1.rds.amazonaws.com:5432/gpuchile
REDIS_URL=redis://redis-service.default.svc.cluster.local:6379/0
REDIS_SERVICE_SERVICE_PORT=6379
REDIS_SERVICE_PORT_6379_TCP_PORT=6379
REDIS_SERVICE_PORT=tcp://172.20.144.242:6379
REDIS_SERVICE_PORT_6379_TCP_ADDR=172.20.144.242
REDIS_SERVICE_PORT_6379_TCP_PROTO=tcp
REDIS_SERVICE_SERVICE_HOST=172.20.144.242
REDIS_SERVICE_PORT_6379_TCP=tcp://172.20.144.242:6379

=== PROCESSES IN POD ===


########################################
ARCHIVO: .\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "3"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"backend"},"name":"gpuchile-backend","namespace":"default"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"backend"}},"template":{"metadata":{"labels":{"app":"backend"}},"spec":{"containers":[{"env":[{"name":"AWS_REGION","value":"us-east-1"},{"name":"S3_BUCKET_NAME","value":"gpuchile-images-dev-nicolas-2026"},{"name":"REDIS_URL","value":"redis://redis-service.default.svc.cluster.local:6379/0"}],"envFrom":[{"secretRef":{"name":"db-credentials"}}],"image":"380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest","imagePullPolicy":"Always","name":"backend","ports":[{"containerPort":8000}],"resources":{"limits":{"cpu":"500m","memory":"512Mi"},"requests":{"cpu":"250m","memory":"256Mi"}}}],"serviceAccountName":"gpuchile-backend-sa"}}}}
  creationTimestamp: "2026-02-06T15:37:14Z"
  generation: 3
  labels:
    app: backend
  name: gpuchile-backend
  namespace: default
  resourceVersion: "277635"
  uid: ffc7b80d-03f5-41bf-9233-01865a887ad7
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: backend
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: "2026-02-06T13:27:40-03:00"
      creationTimestamp: null
      labels:
        app: backend
    spec:
      containers:
      - env:
        - name: AWS_REGION
          value: us-east-1
        - name: S3_BUCKET_NAME
          value: gpuchile-images-dev-nicolas-2026
        - name: REDIS_URL
          value: redis://redis-service.default.svc.cluster.local:6379/0
        envFrom:
        - secretRef:
            name: db-credentials
        image: 380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest
        imagePullPolicy: Always
        name: backend
        ports:
        - containerPort: 8000
          protocol: TCP
        resources:
          limits:
            cpu: 500m
            memory: 512Mi
          requests:
            cpu: 250m
            memory: 256Mi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: gpuchile-backend-sa
      serviceAccountName: gpuchile-backend-sa
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2026-02-06T15:50:23Z"
    lastUpdateTime: "2026-02-06T16:27:43Z"
    message: ReplicaSet "gpuchile-backend-7875db4b66" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  - lastTransitionTime: "2026-02-06T16:52:03Z"
    lastUpdateTime: "2026-02-06T16:52:03Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  observedGeneration: 3
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1


########################################
ARCHIVO: .\docker-compose.yml
########################################

version: '3.9'

services:
  # PostgreSQL Database
  db:
    image: postgres:15-alpine
    container_name: gpuchile_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres123}
      POSTGRES_DB: ${POSTGRES_DB:-gpuchile}
      PGDATA: /var/lib/postgresql/data/pgdata
    ports:
      - "5435:5432" # Mapeado al 5435 para evitar conflictos locales
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - gpuchile_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-postgres}"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: gpuchile_redis
    restart: unless-stopped
    command: redis-server --requirepass ${REDIS_PASSWORD:-redis123}
    ports:
      - "6380:6379" # Mapeado al 6380 para evitar conflictos locales
    volumes:
      - redis_data:/data
    networks:
      - gpuchile_network
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5

  # Backend API (FastAPI)
  backend:
    build:
      context: ./apps/backend
      dockerfile: Dockerfile
    container_name: gpuchile_backend
    restart: unless-stopped
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      # Database
      DATABASE_URL: postgresql://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres123}@db:5432/${POSTGRES_DB:-gpuchile}
      
      # Redis (CORRECCI√ìN IMPORTANTE: Creamos la URL completa aqu√≠)
      REDIS_URL: redis://:${REDIS_PASSWORD:-redis123}@redis:6379/0
      
      # Security
      SECRET_KEY: ${SECRET_KEY}
      ALGORITHM: HS256
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
      
      # AWS S3 (CORRECCI√ìN: Agregadas variables que faltaban)
      S3_BUCKET_NAME: ${S3_BUCKET_NAME}
      AWS_REGION: ${AWS_REGION}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      
      # CORS
      BACKEND_CORS_ORIGINS: '["http://localhost:5173","http://localhost:3000","http://frontend:5173"]'
      
      # Environment
      ENVIRONMENT: development
    ports:
      - "8000:8000"
    volumes:
      - ./apps/backend:/app
      - backend_cache:/app/.cache
    networks:
      - gpuchile_network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 40s

  # Frontend (React + Vite)
  frontend:
    build:
      context: ./apps/frontend
      dockerfile: Dockerfile
    container_name: gpuchile_frontend
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      VITE_API_URL: http://localhost:8000/api
    ports:
      - "5173:5173"
    volumes:
      - ./apps/frontend:/app
      - /app/node_modules # Prevent overwriting node_modules
    networks:
      - gpuchile_network
    stdin_open: true
    tty: true

# Networks
networks:
  gpuchile_network:
    driver: bridge
    name: gpuchile_network

# Volumes (Persistencia de datos)
volumes:
  postgres_data:
    driver: local
    name: gpuchile_postgres_data
  redis_data:
    driver: local
    name: gpuchile_redis_data
  backend_cache:
    driver: local
    name: gpuchile_backend_cache

########################################
ARCHIVO: .\Documentacion.docx
########################################

PK     ! ﬂ§lZ      [Content_Types].xml (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 n0EUbË¢™*>-R{V«ºQU
l"%33V∆É⁄öl	w%=^i7+-d&0A6l4L60#√íS
OX *V$z33%p)O^5}nH"dsXgL`|‘ü|Pr€És?PWtt4Q+"wa|T\y,NU%-D/‹öX›û(<E) ;NL?FÀº‹â<Fk	hy⁄úqi?ﬁØli 1]Hgm@m   PK     !    N   _rels/.rels (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 j0@—ΩQN/c[ILj<]aG”ìzsFu]U
	^[x 1xpf#I) ÉY*Di")c$qU~31jH[{=E~
f?3-ﬁ≤]TÍì∏2j),l0/%b
z≈â,		/|f\Z?6!Y_o]A   PK     ! w=d  B    word/document.xml}[oHﬁªR—Ö05’öF)u^JII‘Ü€Ä=b>¬è2`'8"S)eL22rzJU`ƒâ}ƒâ'~W_!i—õ=x$q7zo./Cmdu0{…ø>r@◊üm'3i7„õõ«ü{,
P-IcgyEw^–ún}&_
JSp#~=oH\!2B>o
nJ9z÷êVCWZkiZzﬁí^K‘©\G√õ8{9g;{ArHN< 'm
 ∏/>#[wqV7{4z”Æ}7pX8,7ev1 ydo«ç-]?2BmŸ£ixjsG=_"f6
.L?s‹ì>%	BF7 >k@1=q?0jhVh;`!#vfP"_h+bÕç~ÀΩ[/{Õ®F"(M8R0	M~l?1IPﬂ¶ yj-(eS ?IBYtn0y}⁄ã‘ªI|A  (21+2|_nB PJ;!Nu‹Ω?:R`&1y]bBs"&gJ.z|,oA?la/R#G~# ä…Ø>>~m"IS}B%8;9vA’ì^2o7GD›™{<@:s%BU$l\_Yj iN;z"qg‰∑ºÔÄ∑q~r#o(U? "0
N
H8iG`Àø'Œ™f)'s8;^d`kKb.O”è&*wgD7œ®"VGgvqŸªSÀ∞N?~p:pnJ$@
pUh
MÿìhbY=~b7nT}Nq?|5cgm<›ó<. Æ
(s6n7y|s=xw39l%iA("Qi4H7i
t<IL$	Q^3—Ø'*tmDNTZOT~){i@wR2|4:mrf:a»∞-"yyM L
1m5 tZ?9zIP79.f%8w:ƒ§XsRVIA3ELZ;S~C>x\}\iHX\(s>A’Ö»ú8(6#—Åq/ :6ÀÇwq)<["wdGe?txxq«åxkYUJTow[zxI6rl‡®ã#?x. i>D@…≤]$b"Z@MjGpW<1&ÿó`2(A›õK'JO$2D+[n-)cNf?l,J◊êTm	?QÃß*c*NU//SmQ%VEi,|H4B»∂T}Hq?)TIHP2%(D!{n?a?gu&{6#bz])6DPLeG6rb0c
 o!-3w_3O.	zA∆≤|bLKP!NNb&z*`0nzy6`*hQ«ΩgFUx!Ã≤ZIv!/+QUFD.XnJn	m3gJS}~!ﬂ£Kb?)P[M–ö KW÷∫Aqv fC uC wÃá,h*|G{*i<}z*d Ji0Ò≤åñwg7Õîqo◊çhdhr~
Ln!|-)d;P9FOqa3ﬁß,%ELr„ò†y0	NY,dTv\R%\l5dA~
k?OrVE"
)PAbJ»π^¬†
?O'?7$DU
f  J	5 }nFW>; p@rsjF9}8uq€èNjŒ©Ol|#`,y"1ke/x]MT!
@"(ﬁÇld!sf6M Q.z|K:R4ŸëKeFTlWJEsl(COjD	KQW/PQ!_>YO.&4qx
m1BqtG<WÏà™5&ND{ETI$voAWU>QMo7  Qe’∂5j5511Q%[y5$[>e;B[fGnn%0X!N;?&++A◊ì}pz83`,rÊ∞∞J„äÜ6—©z~T%<…≤EJL	*}~rI+]&/
g`'wxÃ∫f&L3Ap5Ãìre++H⁄π6h-C4z,ƒö@Y
VcydO '] "Gr«ïAFV}WL~|4hWZ3O‚àÜX_0›ê]^qB[qkn#mÿîb hsp^DYJtD,5R] bDNDNKyp

Rq8Iqj∆É`S5B6O^,Õ≥4Œ±y<q5T4QkGBr…µm[stJEEGdV⁄íz<m&N!*9'.b))ƒñ]*V√ó,/Vo Ür%Q6
*Bu~$*m{AXQt∆∞T,Kz-N;AW9UMA:`sR÷¨j›™C0gV$9_TnÈÜÑ⁄ë bQ1hlF,GcuQ5up.j‘ï^ éz)#*rSl$:/[∆°…°Ynaie%#Uu $$dL^CJ]4dsC9\./\lS=o^d8_H(!2y	…ïvnb +o#S1%Lf4 *:Rj8%x6^lncŒã◊°9|Tpo1r<X^qQTtm|O2q3◊è-LMi\≈Ω"8*∆Önr)Pz.
#I[ﬂëS])j?-—∏&q/v$$⁄¶cRp@r@r@i"DZn
`, S0GL^0Èã≥g3UC-!⁄¢a8*9*GeEt
QC!9tA^4f[7{MIF%yœî3<-3R9qf8;,:aÿªAj<\] ù/	f]_lnD/A r/N^P6|B+.6›§qg4YxsusY…´&L7
?^…ú)9fy 
cqs5_UM«´TN!Mk’©|CjR9^P*s”éG <\Õ´`XbX÷¢fi"Jn\p5]'3qdoppYTefxKh:vA Pﬁê_`»≤%]Q>h{]mdG◊ï-X9,z_D2I
M$IZhd√≥NbI$mA~{QyvM[,5Rmf∆ìoAgIe?^U-iGR
cH^gs«ü Y9|KJ,/<O`]xPQ>X#FrYHo
z6e[8r]RhhÀ©29N&&N3fC. ñko<m:D;#:-⁄õc]Ìä¢&H-5#52R`j?\2=+5Y27Icy{S}`u:2("H)>W~cT.Z8@?-3 ¥	R;h1Ag0[4Qty7H,kv)iZfFUx«™!rRYgg
@ixjaIu*) &h â$1Q+ [UTD`ÃõWs⁄ø{tK4KLYb2e≈∂l=|Õ®|amVlp2»¶xIk√ïJO <JW^b0|	j)@∆ª7qD`RŒé\TÿùP+%WŒ¨|I4<;?&.–±:H{0ÀΩ◊É 2 ™eÀâ'6"zA7H0>Np4Qbsp.~W=Q1X?¬íTMwv$CCh	U$·©êoKJGEucqt2
</^?)f]”™bhj`{.	j@X)«≥m98M8c¬ù>|?~=;wUx:cpy
~c01?2?~p
sq~i]\#b»ÄU5MhR|—≤Àπ` -9C:!]3A5[*" PhYK|z9$
ÓºÆ:Lv&÷æ@*\^z$e\⁄†Gw^M12I–µ-A%7Oi4 O9c⁄∂n◊ûES`pV7!;Gz&<SB@'V8X\Bnp'	YQEE	.E*\
fÂÇ∏A
:»≤m6iRs)#K”é
aXjX
r.vÀ≥8{)]{kl"t]pa8
9)JQ…Æ‹®ml
.F»ÆEIEƒ∏ 4P. HsFo+;+
U$!X]+ÂÆ©*2lRv-@@A&d)347sUÕ™:f3kb
EI
QnSa[un;dUi8"}=≈ÄPT&pvE[t_fBlIMvF*&4>Hu{wM	U/
NB[tW	oeEcp"?yz8@2,[rvq%A0Vs!9)fŒØ%tfyL
7\p 2&l^wKj"‹çROkR0@ E%;Y*E,uLb<À∞Y	p4u&»å›µ])√∂⁄äWQ6e6T5M”õJ_9C4HX/ Iz[L[a%Q58¬õg8"$NYTiÀ≠	-DBZ  J
>j/ﬁ¶i2k2h( ™i\√™ 2e&{AW*4Iﬂè€¥!Q+9 .
;^{'u'jmIjN0
MVu~B\X"v7/ntL$mÿÆ †\,{$I∆¶U<w0*(:lXi»∂%D4?.0~—§8Wq geI⁄ñ(+WZ=S%t/=+DMZuX|W}1$ﬂè+TMG%|n`}$Q,v$Z?4|T^ Q4VU]Ys1I=@X*F‘í=5/:0i=$ G⁄ëb‹£|q`65CU›ò
5~15[—Ωq{7«πrZ!>*[hs-r9O8[,:O1^@#PE[k4iB@{<6‚ª∂Q>x4Qr6q>u:b.g4¬∫~864WF|.G^5U .6}rD/?:TGh63g'cYe=F XRfF›∂L}fT'38yEM3UB9|$ ’±4»ñqs~::◊±@m x)|Hx?Pj9p&Ih,$g	
9<i÷ä{Id\D&:/G8T#M}m?Bpw%2D|/)Bt ¢ 	nY&zm~~FX'dhk–ê]=MJ1W$_rœçg2cld6O‰ãß'G04In^<)L	{„ôä*3„ã≥gJH*Y{BdEœáR—Ñ∆ª\@f.E$ .	]€ñZ!-T#,T8auaeeZMl”è8;N‚í° I|>$R~)€í^—®&brbnqt?P^
q
^¬∏,U%E)ﬁ∞w= 0!4W9Ãû;9wdgfÕØL}
GQSl17&d–†[y'8p>Vz“∂a⁄ø?7>Nc|uaEA,HEmC$YfN J}2 2&dQT;0`4D:p$4O"='HRArjﬂâ)F.Ààa…ë"W
y`SUZKiNC~jÎëçnz S1]Vl5B|yc,lU5⁄•‘ª(iPhPvr	?pDD,XvKJ(6BZj	e 5S€ël`CD8Jw4	◊æynhu&tF>&8xzr$	‘é’ç"jODYsR #Bj	ƒÖH[V5p?t-e,|`…ª'swdq8-R}–π|`t<B"H76x$XmD]"}W!-EvO$j?$u~zvÀãÔçãcX_ C[w€≤Yv9VbdS\QB—Æy’õ7
Dz &:“°G*€≥ÀçoQcR(÷∂}Mld^?	’™&ƒÆÈçªG?fqTlu'JM1j|5Df íJ’•9
B‹ö/nXZ.ÂÉ§2/–ê“öv5ueWyQvh\NT{M#=CdtPioqoUq|e&-3;W3>z@Gw^4nhUP$4K4=d+8nd%34)ih
y|YO&.{{ri4}|5UWlH,8m{8v*sQN,~8r
@Tu
]= ^OPM7/OAutwHB!Bz!Y_%0oYT(k—∫||`P$√∂^*√©`+TmcLLW3D?Õès_=WG	idad–ê5P"“ü$TH)JTY‘õTA5!HTnt}c]92&n;{Cq_ygA$*zaUVJgcFbT$»Æﬁ∂'»¢*AjQ*v{k√≤YGsFS[}W:}ÿènRQ2-J:9/l[È¶á 	n?/AjhWx8B–è;z7P …≤hG 9
^4
!o<?q	6(Hv*[	W:g,
5Z,K]Es7c''	}an:%CYj4YG*s/NpDdZc	E6U {8¬©-x1Q"y}\jNNj>TGSn1E+t~Oj¬ü*,{Yp*ÿ£*V5eX~cggŒªL!A((‚∂ß&|Ot@¬ÆœèeTBM[?,\»ØtN|u7%'b{ r dc	1R6j?	BePI(8#,!A4KO2((!!,Rÿü0A{3p(j|ts%Ix(U‘§a*qc)Z:(TJdW~
.m)8-œΩm>f](cPpq5|8Zy"+Nab8z(fm`]4C""—ê^{ÀóXz;ﬁô>;7/TicIDW-Qm^:;|H$[#EJg%'|T!”õEtﬂπ`? F,GdK$KL$MZRIœ†Õºg*5PTCr4a]WE#1'(Ÿ≥NJH$*È¶çf 	d2:Rjp=D–µÕ•+¬áhKVW]btMqc“º-Eij#Z,ui@EZm;{AD b :PpXH*A'{{{,=%\?LÃÜfPDo/ga9iBxI|sfs(K,5n]~Ïè†ÀéA`X.?
0?bÊïæbjwdF^À±
zkriFa,U)[ I# 4:D
L/	‡¶∂W=A?!+;Y?QVu(3hmHe#K=∆É|ÃïPr)cA/p-6y@Q= 7]D~Mc>1!(Ÿ¢lcpbj"R&’¨;@+ !U5E\Z 4mA|%KW,<Î∂µk $GFP,+
3ÃÑmu]?pEcOh4 rP<t
kGu a%8*&⁄öÀíe=4:;Àú8;!…´Ixeÿ≤r*
2U«ÜBFdR%0Xl◊≠g+KA^2h7;%;6Xes&[\ S{bL÷§K5iIg~$iB>='8’∞876]p	B"h émZ;op$lBYM€Æ>ocdWc %}B6<fN~9i)u$BxxkLL|pqn
!s&i?»Ç;oƒß40> Ky%9kw'ÀÖ]j6]TUfraA/25R!+ÂñÑn<y}|∆æY	J”ñzwf>hYP-{~aP 	h@#H4@
fe”ÄPff,H3_,JS] à2O◊£GU%Y*/OÏ¨†_FA>Hc@R%l‘§S<EuG≈≤tQv5%9aPYVjPfVR-ƒî]a,aZV{Un7ƒüOY>p+A0\vSRPV7xy_|>%&(uwYaa}Zryx.6eeJ%S‹•yar0~ JnBZ%}**‹õrwtY›™tpwFy0]*o‹¥`opCwŒÖs >]~r2d	Yl[,v.N9qi3ƒò#PW
tK14	$|Wb- Ÿ±5Yﬂã{⁄¢UkOnW^E,&'<3.`/+}gc+dpdrk$rAF

+xg<	r6p`FG#G9? |n/o≈†uM jf8
23g`8?g01'K76C.l!,Nc6z$ÀöeDh[l–±P;XqV„¨∂J—öh√©pœÜd[fZ23e1B*
MW{«∑tjŒí`B¬ÜG$KOv{uvy9"yU<Q%RJOQI8aFoK&L>$ÀΩ|uJFEO^JXr_HO 5
kTZF@C4"1ZXxT(P5DiH^cbÂÑµGy„Æó’ùCEnUn{*6p ◊ç	7@bOH,h#:Ab#&$iZ(~S⁄ü/pn` 'Tt84E<t*bNb/]4Ey_-b=^XM/√ù5fw>1HiiH[`v jN3^.UhKHo6[U<)%T#’ï[&rÔö®xEqy!`?dUYT+	*V*2(Uv€ëA≈ûdy ãŸ≥wkAu>$q»î4]2Yn
RW]\P-?i[u]—êÃù&/*hS5√ì
Bu?S@%Y`RS/
:oa@*GU_Ÿ∂qL'wQBR…ºR!vCcvﬂ≥(8=)e!Yy UgHuv;h)2Q1<}tXny$kÿÜxFgK;ÁÇõfQv1%b1az8;$-5WSC1X;wﬁû~VkQ
Ce!dK7mAS2
È∂¶‹üQO*]=m#Y_%h^J$H nM€ñBg)	e`gsK7—∑'Hd"TT»ñff~ n%Q√πGŒ∂n
+rŸß7i∆∂ﬂªfUfo`=ﬂº>9;;|sc"FDtKfc?9!C }[JxNJ~j6@/ÕÜnb€ßRufA	”æÂë™}gAFyoXtF>MhNBe`ﬁá7o~g;o<txv#Z +VBY:S&tlNVe‹áKidX
du8XQ*W4](@	&cz4y;]\JkÕºS'q	s*' Clﬂ´x=>C/fvO|√∏Oi>(ptSM K&
wF4K∆ΩlO'c;(“ô~4Vx&S@w #x,	#?H3Õóy-	’∏clD‡ºï]\`n^”∑S#G{s`E#	"S9dO$h>48*6a0bfﬁë+T
|+4 &,hÀï:ry÷∏>}VV/\M8-Zi
ﬁÇ1R8v”¢
_>ht]÷íW
\KI&A*JEUu-q	mH{1?0yG<n;hmQ0!YukdeJAtn @pIEYBz[0y6t‹úLG &%&/l1{^,}ﬁ®p$mBWA<Sk78N*&l¬çÀÑ"6m…≥gNIh”®gr\<MO6[zs’±
m
~MV”∑MIlb2uT~6Wy<iAe
UE{ 7GV3pgN.-:G@gtR9/YI1tYHSli&A*”°1k5!P6{‚ÇÆ8V;r%_$9h	5U≈ñ…¶eJ}∆âR’Öq<{O*>CU&[t4IkD(/	{aÃ°Œöjcm:0w2>xÿçp e[G^›∫M40CFypk.\,u#=TV3v%}0‘ä6%f}`I+|xﬂï# |V@4€áG|d;T"Qfh%q
[H%Q=&'Nv:gG5ÈÆêC{}^-YBK|jj2 U?LS
prlA!^’ÉaX12[@:ws`/^—à4BfG}EQ…¨œ≤	6soI]0
01k	BO}Oa€¢5%m)E‡Ω°\5BZMqxqLT,hthmLW x
z€ÆfaM@v,<@6VF;h+Ptwg7AHw&?Nv	
CÃ§`WWd7’∂9z7kB7hB{v^zU+6+Õá|f3uKJWa7u\-o;5]3gv cjm~4_Td} o]rxBy-'XB&Gf$JyLLC}o›µU]gI-t{
R;?4ÔÇº:p]u\T\PZ_Lk w%/PGpbvp! è\!’≤wE'
¬íU\piBy=œ™Ohz+.‘±@ŸßL*X9«û~,m|3	-hV8	tBzaf8`€µ|ÿ±+u?vFLwFDE$r∆Ω4{9Y'.84#rm	…ægK;%Oz\%\x“¶Jg@Mpx+r}B.F^SqkWW6uj}VT	#feG "”¢”ó|
5A]fVdJ;,&k9v(^Y¬ñ->a9s4h	(~
Z:uxy P+…ó_EB>eW	4/$, 8_~^0d>~4Mq”¨u%EŸ¶<Õó&D,Cl~fj\l^EYRGE~e! ~0HiNE3%[?oAil<‘í`$DoRf0RE+H~{Tÿ∞›™#J.]-X r=|Bbk#f2U*U|W)U}PœÑx5uuR5:CC4M_Q<M1fRz&!^BX	&.]g(=<X.<&^O4+O& &;0[?^<<41'>\U òIz4g›ÇI? Ã≥_Nsrv|X3B_\o	Xi[%∆í8I≈è+—∏.**7[3H.Hy!ADz1]_ÿπUd*‹àS4$5#hQ89”Ñ28_b+ÁÉø]I g]YH?f∆¶8Kb)_4_oMi	L
.X=xxŒßiHgU;(jG.3ch<<>yG
t<u30M⁄éMŒªc{+ÿ±ﬂ∫≈Øy4*b}Bbn>`*K|\4g5XH.n‚üÖncVKrec-zGIÿ£E!BH-P≈ΩE]|rY
=^L‰¶™€πmX lXVlœ∂Csjw45e??"|(127!3*ÂïÇov◊ßpo{2Ìë∂?H7E›ôd_6l‹™e3ylJZAﬁÜK-Q!M5Ok
Z)m–≠.34jh;4t{nU{J0EVA8\=7q<A$bU14l9"|Ìçì! ¥#^N< 
t.ik\d} üz|2\eqw7ba)B|Õæ2[]Wx∆¶:!ŸÆ[(
“†m K_a* T*j63B~8K6p6|Bÿß«Äj8mmi
1i(ŒõA0@ vM7}“ëza—ü04+|Sl;ÿñ>€ï
 tH<Q>&/€ô]“¨wAefJ?I<7VM0RbLv8,J]
F(e\ 2C‹ùNi<G6"K$z19\8>e%8X(8
yQOW)Ãì1)'oaV|P}√∞›ï.^>wTx%|68S,![iSB]—ãCp0d\FQ<-*}jkB4NDﬁú ]K/T::x^;m]TœÖ$‘°[ﬁ£^.k=ﬂël `>g^4nNz'J?ibe*.,\Z%?;$EÒÆ∑≥LaE5oŸ•
)(y’º
EÿΩZ$jgWy{\√É.X`F}(8mpp :N
_“ñ<$qœóa#dZ'?|B>rTlgÕ´XohsTe’πvi[~EŸë.“ì›≤^&ym?d}rl_wV#]vAtgXÀ¨
f‰Ø™gM#@$mjh3K∆£A_?*Uv%`X!tlC/ îxmlerSt<~=TRƒ£4k„ùâUeubhlvYhb8-^gqcU∆†?z~cuPQ|-|0	~ld-]M>L]"i \”†O	c
j8h_9;C∆±	DvK~NR]eY#@3ÿ∏t-ÕüyMj#x

 Sn‹é-7`zijLJ>\w_U%`=G+gz}I',Xq=|`=K7-w5~)G*+,*6C#=y0Ob. Mg|}0F[I>YA/MdUIc@BfoA?+N7ve
!O|V>Î•Æ)Rfb‚ª≠N D|`PK` Bo-HnAk:z6$nÃàpiZA’†rtC7[“∑t@;d:Nxrala Qs
V;{
aÃ°Q@O,{;UN.›ªZcB|}5Õ™D3Ÿémk&?k`;“∏y5LFbF y-<	t#>W6%~obe^c ¥Z-Àó>^Yq|AMC·∑æn27DzTCxB,m5 e,,GW0-WwaNWI<≈ßxA,u,HQVU`‘∞\–∂'}/ ao%g=Mi/5(dm5T4T{{OYÂ∑êsIwMs3($+F=sO3v?›ë7N“ò›à;(Ax8~"i[>s*r^ l'au[}:x	ﬁßA
`v=v |'+OF4{G
<X–ë{+<"v8,)S
]|s%Áó´—∏soJË≥àkGADC1$Egp"kk9e8k÷´+.k'O+ µ|W
z=[T~7fzoEm}{7w~S3NvwgB
q#s p[b^^$%a
9.7T}ksr≈ΩU/d3_b79<E€™Qm	=aÍπáqmM=Eynh.~{a√•;◊£i{/f≈à}÷é\fzl9÷ê.2?IFMg/Xv\rPSZ<$Y8~(LÕ±OUÀø$<L
-mK`_
nc:?5WNcS"?k(ÓÄñJg›èrs. 1d^*f0N\VZ[Q9Y[yrWp)lÎêßTIC33n.	“† Cb*s(*A|pv98SzOLu_wf\uE√∂4-vh0R8n?7d+21g8X 7[«µ8>y!6|MRG,6;'	—îgi<++√ó4Gœû=ajV~l3G_~ g1!{0/APHF]$M@oD.8WAgPa?e\dÿå.œæ89wŸ∫aDu.WK|SR`"8	V%W5oo3MmL3u,V9	!EdMoL«πI&Z}*jBevLJ..y MxY`ƒ†›ígT&&ÃïI<g#@QW7Q\i c’Ñ{Be:+hRr~%g. CV{^6xdI ]*]etP
}cFs^omJwH3G~‚§ü=[@c%‰§¨SNx‹ÜFP«é#q'k3QS}”¥cET*<K#<8q
n5[G”†!EB^e'Q\~i&N`s]ŒΩ@4Q
xs*?O *≈àw6NI/Z; Avq4¬ôr1h_@%n:^'p![7Cub])RQ/{Cx4(k>'BV
jfﬂô&gH—Ωd+<ÍÜ•l=‘Ñ|”òj8|Q‘âG4L/C08MO0wnG$4K6/^L41&n8H"MrZ¬ã9oe"Ium—ü›ü{@,	"$)w>_X9tU1‘°W|.<;g{g|[[2S›†*QgzQYq]9I3o€ïeA.=pcg:hC:K* :z&9jQs<z9vFm+,B@QWÕ¥Kh ûXwBvM-f_tR>1;`{,\{iRbWhn(p 
3-z$pm__hg[=Oi»∞W	a!	yXzﬂõNv=v ;Rjy$\`<%`B~G…π3r]Glc–≠HO|^$F;È∏ûqDU
Sl|chl
#≈ÆBu`%Vy~(iZ8Q=p' {O=q0WQ'"S7ÈÜæJs]CQ.–ùR|\~,D*T-U@*SX^+;eNA!=N:guAR)`o}H2^\t h {`piXHT—µ3k ~'C	T
oxyWY7x=bmu+◊≠_|L+3GNtnqbI<ee«´i›ÇomBÎëîwMsqI‚íØD"DeŸä]a,.b \aRl__)4	ajgUgUf?&jtOG
1{N@◊á=_8'g~_OGioaﬁÄQrC^X(49'
~|8DÎäÆ(LA=/3]_j…©
b|zorM e5z#◊ß$"]Ej|*XW	\WE]wd$*E__K,[K'%`F|;
8»ôwqNN3^}bjd]DvB&vm[XvYm0[*v/-#%GV%^@ 9o(	bVs.&oqR÷Å64osŸì>|?≈ö=SF”Ñh*4z—°2Y<◊ã{JXUYdS√¥K3xv( 7o{ 0b H
7f
T6[>$`nC=g .
m"EiQ((={l(	K@DSAV…µ5_>QƒÑ*	

-„ÅáLApJm2@>>)~,Y)N\U;h:2R!`L{6zut~wk(6FRZ^8$&dtd:m{	`nAU[?70ecN?ed>Sm@A9[‘Ñ^}>O»ÜLr!RBjfeG=i\@œû€û}*Õé~Y]6bDCXf"VO"vDG0(V<RDuoz(Dﬂ¶(;ŒªTWfD&E%BotB5I&kKRh[n2[C~}czf-7
-x{[uU€°\-LYaK(D710Rg~[c
^TOiZqME√™voV4+()> .ZPC~{c‹îz6_u”Ä*$‹ñ#YIour*Õ≥VBhV[l]""rÕñUp5√Åt~W!(p`#E7>}d’∫ |4u\>w{/bMggƒô}q{0tRvt-cYd{zq8:_nu46 l$((J^Dj0
mËìñA=Àµ[?h(GSuky/AOmf\a>4Mb}z4[xŸÇ¬±SMA«øÔªá-<tLTq$_~ml'?yAmXm=B|9_a∆É'wq"2[5Œ£JrT[>J61n ?VIk_ÿé}…áL2DŸΩ(9^LS<n;Qa56qFD&m
“ì `xD3..M<>ﬂå!«ôOÿ∑H&0t’çGv4N*«ôQn2 t~C5Y[Y÷Ñ73t,<x\ngyzXA"<o,*{|IAwrhd4-?Y0t4o4(z3\mlz[qcWbl`/ hr€ÜjZjWm‚°õ5«Ö-5 	ÀΩaOe]>5iI`XkBPb}>\IS1*cÃ∑982€≤94B<√ÇmGm^Z$
mrqrVG8`ÀäI6”¢O”ÜÎªãP9_6nw5?#!XV}[9&~$JV;XL<R«¢u}EOC
 c6Q:]U
B’´Kf;UPn^*‘± d(n*j#a[T;q?3Sp07re7Z$<SAuS7\’ùMP%nYg#2LrZVdX4@w7K7'$q*lZz:%jXm5Rgd<*p◊¶z:,
d!/o ó;yUfm%!H!Fmqdv‘è{A6=`^}Ft|·ëãgp=r|~|y5)V<’†%nv} v~/nLu<90ivWog9y',8Iex5NrG_hDK9A=RlDA UW0)}IR6N_<6!r;U≈Ñ5b2Wus,8œée…èUFm
$y%„âù7oT5& /S]Rxÿç"tf1H_!ÿ¶&2TI<bÓîÄ4@CF4«öYƒï>*C/ ?`w*›É!*nL1;ECpp<”ânkC]Àì5i5hh+O]gxM2.O	NMt^3yd|+&ccÂÉÆFq^W[}XÔÉì$
N 'qQQ/!|@? Yg¬ùP\ÀΩ◊ê>Si\2m0LaUDG7-6{4ha7*(J_!,^Gucw~yŒñc $aYA;wGau;"'K”†0;iE*GTfpM—§◊º>q›ÑO]IT<:ux8dnxD*&2V?≈Æ/$‡¥°1qRr
=&K@?sh3lBJ)∆¥OS_{#f6T+NA?ddo{5·òûaw,j{)?y%Q?eq8pck@…á9G?,wl( E'A7~2!~2x.u+–µf=EmIX(TO9{uh”Ñ+E1n`c^bt`Õ≠BK%VyY3U%7pfUTreP`…ã[~f\#uqq“£KmGw-=q:}F-:R5lﬂã?p00|508uCŸºRRYnV~t8ÿ¥Y0,[U<c *[&x{mc!UD6uG ≥q~@ÀüH„¶ò]o3$Jo^ÊºÑD›ñ"C Í™õ[€æi:-M2NC
't|Z+Czesi`iJG_U=uÀ¢k52}
1t7m5N>b<*#_%Yau;X<\ÿ∫/N8ccgMw&FkW„∫º5H07%a.J%r-<RT0UF5z>'<5jcUG;T=p|m]pGvNœ¥mDY*4B656H/^t~'YoL\UsN!4EK~d%œ≤KqÃπ|A5Foa!!om#I <wO1[Su:Êë´T4e&I-mA0w|≈∑77a/N"◊æZ}R(u9x"U[-7XQ$”õ√û>|<i
o}=Qzw_sw$s9<ﬂ¨uF*÷∏E9,**ds|#J[:Ãπ`6Og‘∂x2œ≤Non7N.vlNW}X%6]$9>B-pD
n"vCm49/18W?zQtŸõP-¬ÆDe<ﬂé<BÕëuH9RŒâKxOx%iVy.pHB6x
@1#0Iw[Gl"UÃì!6U7À∏1,;@:'q&ƒæ√°[~9/asyQlELM1jF-VL0JIgnm
ﬁÉe‹ÉD≈¶M`Q->uƒìe.!Yv
#Kz,h–íXl[k;uRDH}√çuﬂ±Xe'~hcM+“∞";-h6Õ†}EZIt;9|
4 °$$!”ét- @M{f54g-7"EUHA|*aIÍπã4‚∏öGEN2gA&@#._-YM\DT%DnG&‡£ö3,T
K.B;KV}f.=”µ[j&M}l_u S–Ü)Pe«∞&r	PZrRÃí
Ci1ﬂá1|]…ìwRJ6F;-EG	y∆¶,>Md
S@E,ŸÄ}~r5<=ih6c ÅAT(}Zm◊ùxl680
$
|7>qQ"f&qAbÀ≥p\*7HV?OYgJ"u:<T]5syss],ﬂóAyR⁄¨’äK./lP›±[ PKP√ã{yfFqa/8‹ü3sh @30o^%~W*oan‹ºG@t:*
8W¬ÄM3kLDb3
<wR$?)7
&u	(w)bi`^@h»¥tVE\oR√çs^/CQ0À∞}k@6h;nu~Had–Ü5HBlv9f3GSw6$⁄í
]09	ZZ:{Z+2" (	01 €ôrWZi}s
?%O+pEY:8–•S5.{j; G};a<,L;T^HUD ™
PT-;D
Y}52S;n`I6G0Ã¥WÔé≤7r;tS9ki:qfZ/?Ë≤ùP8N! } 5m
PvNh?k
a!AS"nN(-7
V5D	s&N^Qoj
0	N:^Yxgj 05“é^i0@j:"Ó®ã`TnRzY*/4bx).i@ŸºuxI<<T&M]!"Œè")cD &2—∞\	
4bA)>«Ö$O96-eyd%mS√∞	=qko;?5l _/Ã≤»æ8&\4<1'L:P‹≠MM?esptxfoAﬁú	tut≈ø}<_w0_7~twrw   PK     ! dQ   1   word/_rels/document.xml.rels (                                                                                                                                                                                                                                                                 j0E}-;}PBlJ! E?,	·øØHI`rsœÄ6w{rËåØ{*xAkWk*`[^^ljNKD8R1d:4e>K/4Vm^urw2NP0≈ÆVw5jo7o:>S!?p8JX[d0KDEVKc2P,≈©a].Ô∞òsY“°+(!O>z   PK     ! (=        word/theme/theme1.xmlYO7^
m,Y'%GŸñg÷åIﬁç	z)KJi^aCTÿû-wgCC5G=”≥'qLS: #:qt3G‹π'WQl:NG+4APA!,(<z#R\/Fa$#p{2#.:F)h!√é%C8»ôt»Öh:sW+!"o!O=-«ÇJyJi_“ßp4+M‰±•÷Ω6J-R77W1>V6oUAcurvl5(}7^M_zPg7|ﬂ≠uUEW*mc'hGJÂ†ãyB	)›ÆW*-wI]#—• >b8M /_8{ogO= =y?~_~ox«øWoAg?{Wo188BB-!{;Aq^PX=[sHF1.lcQf[7 PJ⁄îYtSÕï,Ïì≥Yw‹ù5/f{lS	AH H 5FYcl t"}[M2C#2=Im
mJlD ΩM%"√ô1HEh#y4g#\HOP#m2‹†{ ºeuG&	<!!ydN;!+gyg|*CC*$CT[[}#2
DÃòmK j9@dSbb[[=GS8FÃÜaPf=d
h∆™j«à#c17BtZ8l[S3dzC&7-^hjR‘¶#c}[+x3o«§;»†m3ƒò `ﬂñnLDm'-6MMVD8>o*<vT;z
^t(„èøY|Yb^5uŸ∂/jÊ≤ö|j&+`5GkL0!GbN>◊•{‹óVMI(Ac0”î_8H(VdOYnS
@U,D◊≤–ïz
eÎíÄ}Le⁄≤ze¬¢aaQWÍ∑≤_	@u1^d…ê+?K^\gY^CqO$rf»Öa(u#sAObF!|Zn rœïR&Mg"6(Tq%$.a
C#,G2n q∆≠?Rr
„≥ú;M&h$dM9*'X5L>
«ß`HfJ Äc öcrYq-]-(€¢$!\(dNnb1@9O@.in9@‘©iœ±*MÎπÆuN?r‘≤jZkR 7*4}G: unm‹¶c]YŒà`gZ2w]0c<tJ«´v
n+TP ÖVZ.%I0*U”π>/7—≤‘æ2Q:gOd0P2}(7~Qnn^htvwj~S7pVS{_t
UByJUUZ+_~/Õ´y   PK     ! B7  
     word/settings.xmlWﬂè6~\6$$«ûX =-ÿ™Rﬂúk8Xc'&-=-[qflœèrw.3r3~O*TO,>X)P=(eÃ≤iT;Ã∂!y+\XpWqu58")Do8-
kQ-≈ÄLpMb^$ZmL<.L!^-ecoepkIv?ƒéQwÓûãhA%xbHŒ±
|[4T`4e OqD-<$'8`mE∆°K*^Fg—∂H-«ålz$)'GPLV7=IMhSe›¶¬ÅAvLt.Y??>vQPs5h k0∆≤¬îQ }AkcT=txJ;Qo
7nl
emK%8z99QUZ⁄≠M18gMws#yj›µAua}#ku8+Z*f# 
?C=*`j8wrfn"Z!+s»ùwsFp@ W^D9[r‰∑ñ/P=@Z>p8r~M9_#/0hDqodECCm=>G7!AYdB/dCf2:;,(Cn<w",sry
s<yÎØô?]bX*5RxCJ6>Euj$C&H0Gj+$6o!J~:rﬁçoU*Ô∑ñTY”µ*aÃú@u	sNcin=2bt,m9Q÷•WJ7Of\]
r,6/k1`^ÈùÅvdËç¨l|+;∆ù,@`Ra.=o;9E^4“ã7v@.O0mqN€®H–ì)V3]i9i€ôÿ§w9Hx		IÿØs8Ÿù8	h
<6\n	7H≈¨1ÃΩ0dhxh6?m?^   PK     ! 5  I     word/styles.xml]r8}ﬂ™v[,9L≈∑uj'rv!0H-I~ HQndm'X Nyo{I*do`";z{xK3,#~”Ω~_~x|fO!O=	"VS,}x$…íekrdz∆è+Exp030Ix>>?GOx((]UZ=vA{`>OSy0[20 Z
?xcz@Z#! `K*p8GT 5
pXCQ4»Çh_Ÿ≤-XF8Q1w0Ô´ò7hG%RqB$“ìi`G7]
09j?Jlf$\QzYq++]
’á({C*X?*OE U<La)Pn9S7jWi&:c…õm8÷âcF]ﬂ≤5f`Z={b–ùbÀ®6B√£w≈ó/k%[giDK}v2M,Ox0'{-«õDƒâ'{tr/≈ïUv".x5f/⁄ë?^Gp2^7T‹ïFLqYj4]
mu
C EZ9zc{Ó™°—Æ:UC]54UC«ªjH√ºdC"
< 68q,ZBX∆±(cqt4≈è87Edo¬ä-ﬁå>GO	n3n{wmn
=zk<n>JEYo8{jEKg4xj	ALƒΩ|{|—ã\‹©wyx=02)O'|“±@U&E7WG$Ath?/HS/3IJx0DXi\Lc
4L@4Lƒ†42hDf–à-Oq3hDf–àÕ†[:WWÓµª0VPzc*"]dj
K]VOUa«åm4[9DZkQlJ<"yxD+KZ.&gYh5R'NY∆≤HR2xgUtRDM/wl_Vœ£i$A/	W0|L{#]a?q%qkUjJ:IbZT\iT_\}]U	hxxd"VW◊üxL504qK2LS	€Ø|w~IpDtCLL29R!e…üf1K◊£dq ñ|A-e!X
iDnI*et=C#tQ/u5\e\%fSN	vnQYTXO:QnG}?q2_tX `H6q^F)k<xK2$
F≈ÑAQqH	Ne:`DK
NDgy*`T~LQsb*T>Wh/Wq¬í'"»ã1ivsu'Lq@uHH»∫(EPeaDÕÑ-]k3wM|√Ä'c|yﬂñ û"Û¶ã≤_Z	Y{uc>.n~3X/¬õ)⁄£G∆õƒñQGKrJﬁ≤tmw:›≤l9Kka?egqI∆µ69RiYÁÇì&/⁄íN7nQ#';Jg]!?5cnz}9Yy~S> ÖSrgVcpcwS$BslCtRvt3.ZA{\.
D ;D-Tj%T`$T*@B
`8B{PP!P!
Z-T*@BÍ∏∂;	
!BhbB{PP!P!
Z-T*@B
!PBNB(hBP!ZB8B{BBP!Z-T*@B
Ãù
QBhBPB8B{BBP!Z-T*@B
Ãù
QBhB&4(mUOO]N}]v*ze~/i{7u
DBzW_:Y>U]2Bs |TFM._Iﬁ®”´`9jUK0
eqQqS,M—∫b)FW7E!x\1<Tp~n}q +;B[Bp—ï4;BW]i#CCQ
e]v,j N5rBQ
#j=80TC(g!p*R
TC,='d+; ôjF5\aX!jD5qB9S
‹®Y2j"`NTw!3j]EŸ¢p&!.8WcTApÃñ WlJ+{v4P|Za⁄°€°‹®eKuT’é-YeKT„≤•FqŸíj\TG5.[=8eKT„≤•FqŸíj\TG5.[-QsB¬∏SÀñeKvqR’∏lj\TG5.[RÀñeKT%;’∏lj\TG5.[-YeKT„≤•Fq“µ4.Yytœãb"cN5Jx<h(^3JAXwR∆™'y{Ÿ¨;lN-j√ñJl y∆ü1yL? MGÍ±à5€ï;FXba<OR?e>6ERSmJz<aN3c#8`”ßl…∞fh|rM-+sxŸØdB«¥7(2Gÿº8\}#]8Z
9l¬ûeﬁñYE<<khzVg
eYh[<v%fFL^b.„™ìq:nIDYﬁª.`–¢p:^_E:MJAu?oe_a{6p+z?hz9@~0SÍè≠‘õ«Ø6TN(Á§æ›ó9=Bg[Jck_%	«´D~T]j%w5S5ŸÜn-xyY[+9H÷£y}À°g<YwÚπíáupY}$X;mvÀòOE4c5;_rpjeUyo7 Ä,|Y>lmY('N]yHCuv QÍÇ°!
zvT: )]15a_S.∆°—ï3#G4BbtSmS8CltLh05W*? ] ±pLCzx$]^3T;-÷èbjYCl`1T-]%G./y/_ ø:Yh+csDrœìr7KbÀëb|H"6xYzJN7mSHhIÕ¶Rs^D/2?p L¬±HD
-›´Wd|ay&j
 (4xh2k3o~aRW4eYo1Pœ©P{DBA8v:lz3KMj/QsWÃìz√¶\G_):TB?Œ†YvX?$;J9zs,6%Xo~S'Œº7wuq LE-?=Óéµt`-»é«∫7\mM75OG]WO$F'-N_'f
J7O,3z`95Udq”†^O".yKkj.x\<=ÿåRd<9>wVGlur=ZyL√ãtknlp7>88:3ÿã9c@U_"^/œªb}u{IZCD…ùDr/9VhhH`m.z\L?XW*o∆ökJmt3mxkI;zfO/ﬂµVA8n[#
O   PK     ! [x  ;     word/webSettings.xmlj0 {`|OI(!R]<E$:w,u%≈ö<Vhq4i∆ë‹§\i\I9.a”ü."≈∏83D.`h0C‘Æv):u\J%}I2D,Ql4_3D4.;h%Z6-,
p÷£\#AZ
3ﬂ•gTSTKH?`#v`Ttd6MVD0–ÑRP=œπOL
qwu”Ñv6<gqe"neD+	M¬∂€≤2⁄µ_,h,,WTg\),^(a'O~   PK     ! wc  !
     word/fontTable.xml‹ïN0#;XC*
BG, `KdXHm ŒÖ–åXM4'O>9'?\rnTqŸÖ ÀÑ81)8X|R
~GÃò|g#+s"b*G>Y»ë;XzM50p
E)D9'"uE[lC[HJbÕô5 q256Dew8{
 e;F\2B…°I;Œ†–§4 …º"Vp7“âIvF€ã ê^S÷ékc4i‚ÆÜfB*t,v%<}Œñ2HkH nAG8CJrl5‚î≠*U/BN
*)NV,i:s}
«Å(xJ«ë[*QRTﬁ¥T9aFz
|	h‘§S'a {l+m9uN}&##{;RpwP3?7+~l++ﬂ≥ZUÀÑJ%I^74V|_/i2s+W'~z~~we^o86Qo:cQ”±d8=6'$vD8fcd&	:\~o6{UÀæ4Z4PY*O]MKƒèW=9![Rf1    PK     ! ›Ωx     docProps/core.xml (                                                                                                                                                                                                                                                                 Qo0ﬂó?CYb6%eo]{j'+ 8{}q\YAi!
<9 hŒ∏Xr#G"IsCtFMLeDs*XC1FFkhW àZcIËñ¨?¬à!5V)w*bH!a4 Y*W2(*[yE
c6]TrQJbF#M
Iœ°T1Jq;?÷î •oXi+dcÿ´KDx%Q6)u$hz:`]QT/O	JB?~epAÂÄù0;
Oc?wQ&    PK     ! {     docProps/app.xml (                                                                                                                                                                                                                                                                 Sn0?Nb
EmcJrfM"	rm~EKVÈ∂ß4;w5BŒÆh\`›≠ ßMYDYX'xoPC,HUGK∆¢C+“ñ2D
√é
:`MW[C}W\Ek\<	^AD”üCi*›Ç&~F 	g=/.Q81_e
}br{=s1F+ZIkxIAIT&39g=${A(drVIkjho?LH,qy.QN‚ãå⁄∂*2hiGq60sÁ©ó=,KF?Nrlf'wv>’µkd6 +wvW/l/[/e:ŒØ5r|K,4a._\w"-sdi#FcM:s[?   PK-      ! ﬂ§lZ                      [Content_Types].xmlPK-      !    N                 _rels/.relsPK-      ! w=d  B                word/document.xmlPK-      ! dQ   1               k  word/_rels/document.xml.relsPK-      ! (=                  Um  word/theme/theme1.xmlPK-      ! B7  
               ^t  word/settings.xmlPK-      ! 5  I               )y  word/styles.xmlPK-      ! [x  ;               T  word/webSettings.xmlPK-      ! wc  !
                 word/fontTable.xmlPK-      ! ›Ωx                   docProps/core.xmlPK-      ! {                   docProps/app.xmlPK            

########################################
ARCHIVO: .\Makefile
########################################

.PHONY: help build up down logs clean seed test

# Variables
COMPOSE=docker-compose
BACKEND_CONTAINER=gpuchile_backend
FRONTEND_CONTAINER=gpuchile_frontend
DB_CONTAINER=gpuchile_postgres

help: ## Muestra esta ayuda
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

build: ## Construye las im√°genes
	$(COMPOSE) build

up: ## Levanta todos los servicios
	$(COMPOSE) up -d

down: ## Detiene todos los servicios
	$(COMPOSE) down

logs: ## Muestra logs de todos los servicios
	$(COMPOSE) logs -f

logs-backend: ## Logs del backend
	$(COMPOSE) logs -f backend

logs-frontend: ## Logs del frontend
	$(COMPOSE) logs -f frontend

restart: down up ## Reinicia todos los servicios

clean: ## Limpia containers, volumes y cache
	$(COMPOSE) down -v
	docker system prune -f

seed: ## Ejecuta el seed de datos (solo si backend est√° corriendo)
	$(COMPOSE) exec backend python -m app.seed_data

shell-backend: ## Shell interactivo en el backend
	$(COMPOSE) exec backend /bin/bash

shell-db: ## Accede a psql
	$(COMPOSE) exec db psql -U postgres -d gpuchile

shell-redis: ## Accede a redis-cli
	$(COMPOSE) exec redis redis-cli -a redis123

test-backend: ## Ejecuta tests del backend
	$(COMPOSE) exec backend pytest

ps: ## Muestra estado de los servicios
	$(COMPOSE) ps

health: ## Verifica salud de los servicios
	@echo "üîç Verificando servicios..."
	@curl -s http://localhost:8000/health | jq || echo "‚ùå Backend no responde"
	@curl -s http://localhost:5173 > /dev/null && echo "‚úÖ Frontend OK" || echo "‚ùå Frontend no responde"

rebuild: clean build up ## Reconstruye todo desde cero


########################################
ARCHIVO: .\pod-describe.txt
########################################

Name:             gpuchile-backend-7875db4b66-4rhbv
Namespace:        default
Priority:         0
Service Account:  gpuchile-backend-sa
Node:             ip-10-0-102-77.ec2.internal/10.0.102.77
Start Time:       Fri, 06 Feb 2026 13:47:19 -0300
Labels:           app=backend
                  pod-template-hash=7875db4b66
Annotations:      kubectl.kubernetes.io/restartedAt: 2026-02-06T13:27:40-03:00
Status:           Running
IP:               10.0.102.252
IPs:
  IP:           10.0.102.252
Controlled By:  ReplicaSet/gpuchile-backend-7875db4b66
Containers:
  backend:
    Container ID:   containerd://eeff1cb3dd8119c2f2309693f266628e3596324ef93a837cf41b4617d9e56bc2
    Image:          380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest
    Image ID:       380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend@sha256:547a5a0939e724240099b98eb4c556f273f72750c54cf23e230c80c04795e5fd
    Port:           8000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Fri, 06 Feb 2026 13:52:03 -0300
    Last State:     Terminated
      Reason:       Error
      Exit Code:    1
      Started:      Fri, 06 Feb 2026 13:49:33 -0300
      Finished:     Fri, 06 Feb 2026 13:51:48 -0300
    Ready:          True
    Restart Count:  2
    Limits:
      cpu:     500m
      memory:  512Mi
    Requests:
      cpu:     250m
      memory:  256Mi
    Environment Variables from:
      db-credentials  Secret  Optional: false
    Environment:
      AWS_REGION:                   us-east-1
      S3_BUCKET_NAME:               gpuchile-images-dev-nicolas-2026
      REDIS_URL:                    redis://redis-service.default.svc.cluster.local:6379/0
      AWS_STS_REGIONAL_ENDPOINTS:   regional
      AWS_ROLE_ARN:                 arn:aws:iam::380002980493:role/gpuchile-cluster-gpuchile-backend-sa-role
      AWS_WEB_IDENTITY_TOKEN_FILE:  /var/run/secrets/eks.amazonaws.com/serviceaccount/token
    Mounts:
      /var/run/secrets/eks.amazonaws.com/serviceaccount from aws-iam-token (ro)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-n44kt (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  aws-iam-token:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  86400
  kube-api-access-n44kt:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    Optional:                false
    DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age                 From               Message
  ----     ------     ----                ----               -------
  Normal   Scheduled  4m44s               default-scheduler  Successfully assigned default/gpuchile-backend-7875db4b66-4rhbv to ip-10-0-102-77.ec2.internal
  Normal   Pulled     4m44s               kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 137ms (137ms including waiting)
  Normal   Pulled     2m30s               kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 135ms (135ms including waiting)
  Warning  BackOff    15s                 kubelet            spec.containers{backend}: Back-off restarting failed container backend in pod gpuchile-backend-7875db4b66-4rhbv_default(822eb9c2-8017-4d02-b9be-291accbcadf8)
  Normal   Pulling    1s (x3 over 4m44s)  kubelet            spec.containers{backend}: Pulling image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest"
  Normal   Pulled     1s                  kubelet            spec.containers{backend}: Successfully pulled image "380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest" in 141ms (141ms including waiting)
  Normal   Created    0s (x3 over 4m44s)  kubelet            spec.containers{backend}: Created container: backend
  Normal   Started    0s (x3 over 4m44s)  kubelet            spec.containers{backend}: Started container backend


########################################
ARCHIVO: .\producto.json
########################################

{
  "name": "NVIDIA RTX 4090",
  "brand": "NVIDIA",
  "model": "RTX 4090",
  "price": 1599.99,
  "vram": 24,
  "cuda_cores": 16384,
  "image_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Nvidia_GeForce_RTX_4090_Founders_Edition.jpg/640px-Nvidia_GeForce_RTX_4090_Founders_Edition.jpg",
  "stock": 10,
  "description": "La tarjeta gr√°fica m√°s potente del mundo.",
  "is_featured": true
}

########################################
ARCHIVO: .\README.md
########################################

<div align="center">

![Terraform](https://img.shields.io/badge/Terraform-7B42BC?style=for-the-badge&logo=terraform&logoColor=white)
![Kubernetes](https://img.shields.io/badge/Kubernetes-326CE5?style=for-the-badge&logo=kubernetes&logoColor=white)
![AWS](https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazon-aws&logoColor=white)
![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB)
![FastAPI](https://img.shields.io/badge/FastAPI-005571?style=for-the-badge&logo=fastapi)

</div>

# GPUCHILE - Production-Grade EKS Project

## Descripci√≥n

E-commerce de GPUs high-performance desplegado en AWS EKS con arquitectura production-ready. Proyecto portfolio que demuestra:

- Infrastructure as Code (Terraform)
- Container Orchestration (Kubernetes/EKS)
- CI/CD Pipeline (GitHub Actions)
- Microservicios (FastAPI + React)
- Observability (Prometheus + Grafana)
- Security-first (IRSA, Secrets Manager, Network Policies)

---

## Arquitectura

### Stack T√©cnico

FRONTEND BACKEND DATA INFRA
graph TD
    User((Usuario)) --> ALB(AWS Load Balancer)
    subgraph AWS Cloud
        ALB --> Ingress[Nginx Ingress]
        subgraph EKS Cluster
            Ingress --> Frontend[Frontend Pods <br/> React + Nginx]
            Frontend --> Backend[Backend Pods <br/> FastAPI]
            Backend --> Redis[(Redis Cache)]
        end
        Backend --> RDS[(RDS PostgreSQL)]
        Backend --> S3[S3 Bucket <br/> Images]
        GitHub[GitHub Actions] --> ECR[AWS ECR]
        ECR --> EKS
    end


### Flujo de Datos

Usuario ‚Üí ALB ‚Üí Ingress ‚Üí Frontend (Nginx) ‚Üí Backend (FastAPI) ‚Üí RDS
‚Üì ‚Üì
S3 Images Redis Cache


### Componentes AWS

- **Compute:** EKS Cluster (1-3 nodos Spot t3.medium)
- **Networking:** VPC Multi-AZ, Subnets p√∫blicas/privadas, ALB
- **Data:** RDS PostgreSQL, Redis en K8s, S3 para im√°genes
- **Security:** IRSA roles, Secrets Manager, Security Groups
- **Observability:** Prometheus + Grafana (Helm)
- **CI/CD:** GitHub Actions con OIDC, ECR

---

## Quick Start

### Requisitos Previos

```bash
# Verificar herramientas instaladas
terraform --version  # >= 1.6.0
kubectl version --client
helm version
aws --version
docker --version

Setup Inicial

# 1. Clonar repositorio
git clone https://github.com/NicolasNunez05/proyecto-kubernetes-escalable-eks.git
cd proyecto-kubernetes-escalable-eks

# 2. Configurar AWS CLI
aws configure
# Ingresar: Access Key, Secret Key, Region (us-east-1)

# 3. Crear infraestructura AWS
cd terraform
terraform init
terraform plan
terraform apply  # Toma 15-20 min

# 4. Configurar kubectl
aws eks update-kubeconfig --name gpuchile-cluster --region us-east-1

# 5. Instalar External Secrets Operator
helm repo add external-secrets https://charts.external-secrets.io
helm repo update  
helm install external-secrets external-secrets/external-secrets \
  --namespace external-secrets --create-namespace

# 6. Aplicar manifiestos K8s
kubectl apply -f kubernetes/external-secrets/
kubectl apply -f kubernetes/redis/

# 7. Build y push im√°genes a ECR
./scripts/docker/build_and_push.sh

# 8. Desplegar aplicaciones con Helm
helm install gpuchile-backend ./helm/backend --namespace default
helm install gpuchile-frontend ./helm/frontend --namespace default

# 9. Obtener URL del LoadBalancer
kubectl get svc gpuchile-frontend -n default
# EXTERNAL-IP es la URL de la app

Estructura del Proyecto

.
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ backend/           # FastAPI + PostgreSQL + Redis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ frontend/          # React + Nginx
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ terraform/             # Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpc/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rds/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ s3/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lambda/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecr/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ irsa/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ secrets/
‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
‚îú‚îÄ‚îÄ helm/                  # Kubernetes Helm Charts
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îú‚îÄ‚îÄ kubernetes/            # Raw K8s manifests
‚îÇ   ‚îú‚îÄ‚îÄ external-secrets/
‚îÇ   ‚îî‚îÄ‚îÄ redis/
‚îú‚îÄ‚îÄ .github/workflows/     # CI/CD Pipelines
‚îÇ   ‚îú‚îÄ‚îÄ backend-ci.yml
‚îÇ   ‚îî‚îÄ‚îÄ frontend-ci.yml
‚îú‚îÄ‚îÄ lambda/                # Serverless Image Resizer
‚îÇ   ‚îî‚îÄ‚îÄ image-resizer/
‚îú‚îÄ‚îÄ scripts/               # Automation
‚îÇ   ‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ ops/
‚îî‚îÄ‚îÄ docs/                  # Documentation

Desarrollo Local
Backend

cd apps/backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python -m app.main
# API en http://localhost:8000
# Docs en http://localhost:8000/docs

Frontend
cd apps/frontend
npm install
npm run dev
# App en http://localhost:5173

Docker Compose (Fullstack Local)
cd apps/backend
docker-compose up
# Backend: http://localhost:8000
# Frontend: http://localhost:5173
# Adminer (DB GUI): http://localhost:8080

Secrets Management

Las credenciales se gestionan con AWS Secrets Manager y se inyectan en pods v√≠a External Secrets Operator.
Secretos almacenados:

    gpuchile/dev/db ‚Üí PostgreSQL URL

    gpuchile/dev/jwt ‚Üí JWT secret

    gpuchile/dev/redis ‚Üí Redis URL

Observability
Prometheus + Grafana

# Acceder a Grafana
kubectl port-forward -n monitoring svc/prometheus-stack-grafana 3000:80
# Usuario: admin
# Password: admin123

# Dashboards disponibles:
# - Kubernetes Cluster Monitoring
# - Node Exporter Full
# - FastAPI Custom Metrics

Gesti√≥n de Costos
Costo por hora: aproximadamente $0.12 USD

    EKS Control Plane: $0.10/h

    EC2 Spot t3.medium (1 nodo): aproximadamente $0.015/h

    RDS t3.micro: Free Tier

    S3/Lambda: Pay-per-use (aproximadamente $0.01/d√≠a)

Destroy despu√©s de usar

cd terraform
terraform destroy  # Libera TODOS los recursos

Roadmap

    Iteraci√≥n 1: Walking Skeleton (App en EKS)

    Iteraci√≥n 2: Helm Charts

    Iteraci√≥n 3: CI/CD Pipeline

    Iteraci√≥n 4: Observability (Prometheus/Grafana)

    Iteraci√≥n 5: Autoscaling (HPA + Cluster Autoscaler)

    Iteraci√≥n 6: Networking (ExternalDNS + Ingress)

    Iteraci√≥n 7: Logging (Fluent Bit + OpenSearch)

Contribuciones
Este es un proyecto portfolio personal. Si encuentras bugs o mejoras, abre un issue.

Licencia
MIT License - Ver LICENSE

Autor

Nicol√°s N√∫√±ez

    GitHub: @NicolasNunez05

    LinkedIn: https://www.linkedin.com/in/nicol%C3%A1s-n%C3%BA%C3%B1ez-%C3%A1lvarez-35ba661ba/

    Email: nicolasnunezalvarez05@gmail.com

Aprendizajes Clave

Este proyecto me ense√±√≥:

    Dise√±o de arquitecturas multi-tier en AWS

    Orquestaci√≥n de contenedores con Kubernetes

    Automatizaci√≥n de despliegues con GitOps

    Gesti√≥n de secretos y seguridad en cloud

    Observability con m√©tricas y dashboards

    Trade-offs entre costos y disponibilidad

Objetivo: Demostrar competencias para posiciones Cloud/DevOps Engineer.


########################################
ARCHIVO: .\URLS.txt
########################################

# GpuChile Stack - Endpoints

Backend API:
http://ad519c89537e8443d8b899e35db9d1cd-361311791.us-east-1.elb.amazonaws.com:8000

Health Check:
http://ad519c89537e8443d8b899e35db9d1cd-361311791.us-east-1.elb.amazonaws.com:8000/health

API GPUs:
http://ad519c89537e8443d8b899e35db9d1cd-361311791.us-east-1.elb.amazonaws.com:8000/api/gpus

Swagger UI:
http://ad519c89537e8443d8b899e35db9d1cd-361311791.us-east-1.elb.amazonaws.com:8000/docs

Frontend:
(pending)


########################################
ARCHIVO: .\apps\backend\.dockerignore
########################################

__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
.env
.env.local
*.db
*.sqlite3
.pytest_cache/
.coverage
htmlcov/
.mypy_cache/
.DS_Store


########################################
ARCHIVO: .\apps\backend\.env.example
########################################

# Database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/gpuchile

# Redis
REDIS_URL=redis://localhost:6379/0

# JWT
SECRET_KEY=your-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# AWS S3
AWS_REGION=us-east-1
S3_BUCKET_NAME=gpuchile-images-dev-nicolas-2026
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key

# App
ENVIRONMENT=development
DEBUG=True


########################################
ARCHIVO: .\apps\backend\docker-compose.yml
########################################

version: '3.8'

services:
  # üß† TU API
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      # Override para que Docker vea a los otros servicios por nombre
      - DATABASE_URL=postgresql://gpuchile:password@db:5432/gpuchile_dev
      - REDIS_URL=redis://redis:6379/0
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} # Pasamos credenciales AWS locales
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=us-east-1
    volumes:
      - ./app:/app/app # Hot-reload: cambios en local se reflejan dentro
    depends_on:
      db:
        condition: service_healthy
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # üêò BASE DE DATOS
  db:
    image: postgres:15-alpine
    restart: always
    environment:
      - POSTGRES_USER=gpuchile
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=gpuchile_dev
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U gpuchile -d gpuchile_dev"]
      interval: 5s
      timeout: 5s
      retries: 5

  # ‚ö° CACHE & RATE LIMITING
  redis:
    image: redis:7-alpine
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # üõ†Ô∏è DB VIEWER (Opcional, para ver tus tablas f√°cil)
  adminer:
    image: adminer
    restart: always
    ports:
      - "8080:8080"

volumes:
  postgres_data:
  redis_data:


########################################
ARCHIVO: .\apps\backend\Dockerfile
########################################

# Base stage con Python 3.11
FROM python:3.11-slim AS base

# Variables de entorno para Python
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Copiar requirements
COPY requirements.txt .

# Instalar dependencias Python
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo fuente
COPY . .

# Exponer puerto
EXPOSE 8000

# Script de inicio (espera DB + corre migraciones + inicia server)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]


########################################
ARCHIVO: .\apps\backend\requirements.txt
########################################

fastapi==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
pydantic==2.5.3
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
redis==5.0.1
boto3==1.34.34
prometheus-client==0.19.0
python-dotenv==1.0.0
email-validator>=2.0.0



########################################
ARCHIVO: .\apps\backend\app\main.py
########################################

from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import Response
from prometheus_client import Counter, Histogram, generate_latest
from sqlalchemy import text
from datetime import datetime
import time
import logging


from app.core.config import settings
from app.db.database import engine, Base, SessionLocal
from app.api.routes import gpus, auth, cart
# Importamos el cliente de redis que ya inicializaste en cart.py para chequear su salud
from app.api.routes.cart import redis_client 

# Crear tablas autom√°ticamente al inicio (Para MVP/Portfolio)
# Configurar logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Crear tablas con retry logic
def create_tables_with_retry(max_retries=3, delay=2):
    for attempt in range(max_retries):
        try:
            logger.info(f"Attempt {attempt + 1}/{max_retries}: Creating database tables...")
            Base.metadata.create_all(bind=engine)
            logger.info("‚úÖ Database tables created successfully")
            return True
        except Exception as e:
            logger.error(f"‚ùå Error: {e}")
            if attempt < max_retries - 1:
                time.sleep(delay)
    return False

create_tables_with_retry()
# Inicializar FastAPI
app = FastAPI(
    title="GpuChile API",
    description="Production-grade GPU e-commerce API with EKS architecture",
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)

# Configuraci√≥n CORS (Crucial para que el Frontend hable con el Backend)
origins = [
    "http://localhost:5173",    # Frontend local (Vite)
    "http://127.0.0.1:5173",    # Frontend local alternativo
    "http://frontend:5173",     # Comunicaci√≥n interna Docker
    "*"                         # Permitir todo (solo para dev/portfolio)
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# --- PROMETHEUS METRICS ---
request_count = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status']
)
request_duration = Histogram(
    'http_request_duration_seconds',
    'HTTP request duration',
    ['method', 'endpoint']
)

@app.middleware("http")
async def track_metrics(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    duration = time.time() - start_time
    
    # Ignorar m√©tricas para healthchecks y metrics para no ensuciar grafana
    if request.url.path not in ["/health", "/metrics", "/healthz", "/readyz"]:
        request_count.labels(
            method=request.method,
            endpoint=request.url.path,
            status=response.status_code
        ).inc()
        
        request_duration.labels(
            method=request.method,
            endpoint=request.url.path
        ).observe(duration)
    
    return response

# --- RUTAS ---
app.include_router(gpus.router, prefix="/api/gpus", tags=["GPUs"])
app.include_router(auth.router, prefix="/api/auth", tags=["Authentication"])
app.include_router(cart.router, prefix="/api/cart", tags=["Cart"])

# --- SYSTEM ENDPOINTS ---

@app.get("/")
def root():
    return {
        "message": "Welcome to GpuChile API üöÄ",
        "version": "1.0.0",
        "docs": "/docs",
        "environment": settings.ENVIRONMENT
    }

@app.get("/health", tags=["System"])
def health_check():
    """
    Health Check completo para Docker/Kubernetes.
    Verifica conectividad real con PostgreSQL y Redis.
    """
    # 1. Verificar PostgreSQL
    try:
        db = SessionLocal()
        db.execute(text("SELECT 1"))
        db.close()
        db_status = "healthy"
    except Exception as e:
        db_status = f"unhealthy: {str(e)}"
    
    # 2. Verificar Redis
    try:
        if redis_client:
            redis_client.ping()
            redis_status = "healthy"
        else:
            redis_status = "not configured"
    except Exception as e:
        redis_status = f"unhealthy: {str(e)}"
    
    status_code = 200 if db_status == "healthy" and redis_status == "healthy" else 503

    return {
        "status": "ok" if status_code == 200 else "error",
        "services": {
            "database": db_status,
            "redis": redis_status
        },
        "timestamp": datetime.utcnow().isoformat()
    }

@app.get("/metrics", tags=["System"])
def metrics():
    """Endpoint para que Prometheus haga scraping"""
    return Response(content=generate_latest(), media_type="text/plain")

@app.get("/healthz", tags=["System"])
def liveness():
    """K8s Liveness Probe (¬øEstoy vivo?)"""
    return {"status": "alive"}

@app.get("/readyz", tags=["System"])
def readiness():
    """K8s Readiness Probe (¬øPuedo recibir tr√°fico?)"""
    return {"status": "ready"}

########################################
ARCHIVO: .\apps\backend\app\main.py.backup
########################################

from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import Response
from prometheus_client import Counter, Histogram, generate_latest
from sqlalchemy import text
from datetime import datetime
import time

from app.core.config import settings
from app.db.database import engine, Base, SessionLocal
from app.api.routes import gpus, auth, cart
# Importamos el cliente de redis que ya inicializaste en cart.py para chequear su salud
from app.api.routes.cart import redis_client 

# Crear tablas autom√°ticamente al inicio (Para MVP/Portfolio)
Base.metadata.create_all(bind=engine)

# Inicializar FastAPI
app = FastAPI(
    title="GpuChile API",
    description="Production-grade GPU e-commerce API with EKS architecture",
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)

# Configuraci√≥n CORS (Crucial para que el Frontend hable con el Backend)
origins = [
    "http://localhost:5173",    # Frontend local (Vite)
    "http://127.0.0.1:5173",    # Frontend local alternativo
    "http://frontend:5173",     # Comunicaci√≥n interna Docker
    "*"                         # Permitir todo (solo para dev/portfolio)
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# --- PROMETHEUS METRICS ---
request_count = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status']
)
request_duration = Histogram(
    'http_request_duration_seconds',
    'HTTP request duration',
    ['method', 'endpoint']
)

@app.middleware("http")
async def track_metrics(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    duration = time.time() - start_time
    
    # Ignorar m√©tricas para healthchecks y metrics para no ensuciar grafana
    if request.url.path not in ["/health", "/metrics", "/healthz", "/readyz"]:
        request_count.labels(
            method=request.method,
            endpoint=request.url.path,
            status=response.status_code
        ).inc()
        
        request_duration.labels(
            method=request.method,
            endpoint=request.url.path
        ).observe(duration)
    
    return response

# --- RUTAS ---
app.include_router(gpus.router, prefix="/api/gpus", tags=["GPUs"])
app.include_router(auth.router, prefix="/api/auth", tags=["Authentication"])
app.include_router(cart.router, prefix="/api/cart", tags=["Cart"])

# --- SYSTEM ENDPOINTS ---

@app.get("/")
def root():
    return {
        "message": "Welcome to GpuChile API üöÄ",
        "version": "1.0.0",
        "docs": "/docs",
        "environment": settings.ENVIRONMENT
    }

@app.get("/health", tags=["System"])
def health_check():
    """
    Health Check completo para Docker/Kubernetes.
    Verifica conectividad real con PostgreSQL y Redis.
    """
    # 1. Verificar PostgreSQL
    try:
        db = SessionLocal()
        db.execute(text("SELECT 1"))
        db.close()
        db_status = "healthy"
    except Exception as e:
        db_status = f"unhealthy: {str(e)}"
    
    # 2. Verificar Redis
    try:
        if redis_client:
            redis_client.ping()
            redis_status = "healthy"
        else:
            redis_status = "not configured"
    except Exception as e:
        redis_status = f"unhealthy: {str(e)}"
    
    status_code = 200 if db_status == "healthy" and redis_status == "healthy" else 503

    return {
        "status": "ok" if status_code == 200 else "error",
        "services": {
            "database": db_status,
            "redis": redis_status
        },
        "timestamp": datetime.utcnow().isoformat()
    }

@app.get("/metrics", tags=["System"])
def metrics():
    """Endpoint para que Prometheus haga scraping"""
    return Response(content=generate_latest(), media_type="text/plain")

@app.get("/healthz", tags=["System"])
def liveness():
    """K8s Liveness Probe (¬øEstoy vivo?)"""
    return {"status": "alive"}

@app.get("/readyz", tags=["System"])
def readiness():
    """K8s Readiness Probe (¬øPuedo recibir tr√°fico?)"""
    return {"status": "ready"}

########################################
ARCHIVO: .\apps\backend\app\api\routes\__pycache__\admin.cpython-311.pyc
########################################



    *|ni                        d dl mZmZmZmZmZmZmZ d dlm	Z	 d dl
mZ d dlm
Z d dlmZm
Z d dlmZ d dlZd dlmZ  e            Ze                    d	eej        
           ed           ed           ed           ed           ed            ed           ed           ee          fd
ededededededede	fd            ZdS )    )	APIRouterDepends
HTTPException
UploadFileFileFormstatus)Session)get_db)GPU)	GPUCreater   )upload_imageN)Optionalz/gpus)response_modelstatus_code.z{}modelbrandpricevramstockfilespecsdbc           	        K   	 |                                  d{V }t          ||j                  }	n3# t          $ r&}
t	          ddt          |
                     d}
~
ww xY w	 t
          j        |          }n# t          j        $ r i }Y nw xY wt          | ||||||	          }|
                    |           |                                 |                    |           |S )z@
    Crea una GPU y sube su imagen a S3 (carpeta /original)
    Ni  zError subiendo imagen: )r   detail)r   r   r   r   r   r   	image_key)
readr   filename	Exceptionr   strjsonloadsJSONDecodeErrorGPUModeladdcommitrefresh)
r   r   r   r   r   r   r   r   file_contentr   e
specs_dictnew_gpus
                /app/app/api/routes/admin.py
create_gpur-      s!     "X!YY[[(((((( t}==		 X X X4VcRSff4V4VWWWWXZ&&

   


 
  G FF7OOOIIKKKJJwNs&   /4 
A$!AA$(A= =BB)fastapir   r   r   r   r   r   r	   sqlalchemy.ormr
   app.db.sessionr   
app.db.modelsr   r$   app.models.gpur
   	GPUSchemaapp.services.s3_servicer   r!   typingr   routerpostHTTP_201_CREATEDr    floatintr-        r,   <module>r=      s   U U U U U U U U U U U U U U U U U U " " " " " " ! ! ! ! ! ! ) ) ) ) ) ) 6 6 6 6 6 6 6 6 0 0 0 0 0 0       	
 WYF<STT cc499S		atCyyd'&//+ ++ + 	+
 + 
+ + + 	+ + + UT+ + +r<   

########################################
ARCHIVO: .\apps\backend\app\api\routes\__pycache__\auth.cpython-311.pyc
########################################



    ›∑ki                      b    d dl mZ  e            Ze                    d          d             ZdS )    )	APIRouterz/loginc                  
    ddiS )NmsgzLogin endpoint pendiente r       /app/app/api/routes/auth.pyloginr	      s    -..r   N)fastapir   routerpostr	   r   r   r   <module>r
      sR         	X/ / / / /r   

########################################
ARCHIVO: .\apps\backend\app\api\routes\__pycache__\favorites.cpython-311.pyc
########################################



    ki                      b    d dl mZ  e            Ze                    d          d             ZdS )    )	APIRouter/c                  
    ddiS )NmsgzFavoritos endpoint pendiente r        /app/app/api/routes/favorites.py
get_favoritesr
      s    122r   N)fastapir   routergetr
   r   r   r	   <module>r      sO         	C3 3 3 3 3r   

########################################
ARCHIVO: .\apps\backend\app\api\routes\__pycache__\gpus.cpython-311.pyc
########################################



    “∑ki                         d dl mZmZ d dlmZ d dlmZ d dlmZ d dl	m
Z d dlm
Z
  e            Ze                    dee
                   d d ee          fd	ed
edefd            Zd
S )    )	APIRouterDepends)Session)List)get_db)GPU/)response_modeld   skiplimitdbc                     |                     t                                        |                               |                                          S )N)queryGPUModeloffsetr
   all)r   r
   r   s      /app/app/api/routes/gpus.py	read_gpusr   
   s<    
88H$$T**0077;;===    N)fastapir   r   sqlalchemy.ormr   typingr   app.db.sessionr   
app.db.modelsr   r   app.models.gpu	GPUSchemaroutergetintr    r   r   <module>r"      s    & & & & & & & & " " " " " "       ! ! ! ! ! ! ) ) ) ) ) ) + + + + + +	CY00#WWV__ > >C >C >7 > > > 10> > >r   

########################################
ARCHIVO: .\apps\backend\app\db\__pycache__\base.cpython-311.pyc
########################################



    ki                      &    d dl mZ  e            ZdS )    )declarative_baseN)sqlalchemy.ormr   Base     /app/app/db/base.py<module>r	      s)    + + + + + +r   

########################################
ARCHIVO: .\apps\backend\app\db\__pycache__\models.cpython-311.pyc
########################################



    ki                     n    d dl mZmZmZmZmZmZmZmZ d dl	m
Z
 d dlmZ d dl
mZ  G d de          ZdS )    )ColumnIntegerStringBooleanNumericDateTimeTextDate)JSONB)func)Basec                   ,   e Zd ZdZ eedd          Z e ed          d          Z e ed          dd          Z	 e ed                    Z
 eedd          Z e ed	                    Z e e
d
d          dd          Z eedd
          Z e ed                    Z eei           Z eed          Z e ed           ej                              Z e ed           ej                              ZdS )GPUgpusT)primary_keyindexd   F)nullable2   )r   r      
      r   )defaultr      )r   )timezone)server_default)onupdateN)__name__
__module____qualname__
__tablename__r   r   idr   modelbrandseriesvrammemory_typer   pricestock	image_keyr   specsr   is_featuredr   r   now
created_at
updated_at     /app/app/db/models.pyr   r      st       M	T	6	6	6BF66#;;///EF66"::T:::E
VFF2JJ

F 6'E666D&$$KF772q>>E>>>EF7A666E vvc{{##I 
F5"%%%E&%000K$///

KKKJ$///($(**EEEJJJr1   r   N)
sqlalchemyr   r   r   r   r   r   r	   r
   sqlalchemy.dialects.postgresqlr   sqlalchemy.sqlr   app.db.baser
   r   r0   r1   r2   <module>r7      s    V V V V V V V V V V V V V V V V V V V V 0 0 0 0 0 0            F F F F F$ F F F F Fr1   

########################################
ARCHIVO: .\apps\backend\app\db\__pycache__\session.cpython-311.pyc
########################################



    kip                     t    d dl mZ d dlmZ d dlmZ  eej        ddd          Z edde	          Zd
 Z	dS )    )
create_engine)sessionmaker)settingsT
      )
pool_pre_ping	pool_sizemax_overflowF)
autocommit	autoflushbindc               #      K   t                      } 	 | V  |                                  d S # |                                  w xY w)N)SessionLocalclose)dbs    /app/app/db/session.pyget_dbr      s@      	B









s	   , AN)

sqlalchemyr   sqlalchemy.ormr   
app.configr   DATABASE_URLenginer   r        r   <module>r      s    $ $ $ $ $ $ ' ' ' ' ' '       
	
 
 
 |uFKKK    r   

########################################
ARCHIVO: .\apps\backend\app\models\__pycache__\gpu.cpython-311.pyc
########################################



    Vki                         d dl mZmZmZ d dlmZmZmZ d dlmZ d dl	m
Z
  G d de          Z G d de          Z G d	 d
e          Z
dS )    )	BaseModelFieldcomputed_field)OptionalDictAny)datetime)settingsc                      e Zd ZU eed<   eed<   dZee         ed<    eddd          Ze	ed	<   dZ
ee         ed
<    edd          Zeed<    edd
          Z
e	ed<    ee          Zeeef         ed<   dZeed<   dS )GPUBasemodelbrandNseries.r   z
VRAM in GB)gtdescriptionvrammemory_type)r   price)defaultgestock)default_factoryspecsFis_featured)__name__
__module____qualname__str__annotations__r   r   r   r   intr   r   floatr   dictr   r   r   r   bool     /app/app/models/gpu.pyr   r      s         JJJJJJ FHSM   ca\:::D#:::!%K#%%%5###E5###qQ'''E3'''!E$777E4S>777Kr%   r   c                   *    e Zd ZU dZee         ed<   dS )	GPUCreateN	image_key)r   r   r   r)   r   r   r   r$   r%   r&   r(   r(      s&         #Ix}#####r%   r(   c                       e Zd ZU eed<   dZee         ed<   eed<    G d d          Z	e
edee         fd                        Ze
edee         fd	                        Z
dS )
GPUidNr)   
created_atc                       e Zd ZdZdS )
GPU.ConfigTN)r   r   r   from_attributesr$   r%   r&   Configr/      s        r%   r1   returnc                 \    | j         sd S dt          j         dt          j         d| j          S )Nhttps://.s3.z.amazonaws.com/original/r)   r
   	S3_BUCKET	S3_REGIONselfs    r&   	image_urlz
GPU.image_url    s;     ~ 	4n(,nn(2Dnn^b^lnnnr%   c                 \    | j         sd S dt          j         dt          j         d| j          S )Nr4   r5   z.amazonaws.com/thumbnails/r6   r9   s    r&   
thumbnail_urlzGPU.thumbnail_url'   s;     ~ 	4p(,pp(2Dpp`d`npppr%   )r   r   r   r    r   r)   r   r   r	   r1   r   propertyr;   r=   r$   r%   r&   r+   r+      s         GGG#Ix}###        
o8C= o o o X ^o
 
qx} q q q X ^q q qr%   r+   N)pydanticr   r   r   typingr   r   r   r	   
app.configr
   r   r(   r+   r$   r%   r&   <module>rB      s    5 5 5 5 5 5 5 5 5 5 & & & & & & & & & &            	 	 	 	 	i 	 	 	$ $ $ $ $ $ $ $q q q q q' q q q q qr%   

########################################
ARCHIVO: .\apps\backend\app\services\__pycache__\s3_service.cpython-311.pyc
########################################



    nil                         d dl Z d dlZd dlZd dlmZ d dlmZ  e j        d ej        d           ej        d          ej	                  Z
ded	ed
efdZ
dS )    N)settings)NoCredentialsErrors3AWS_ACCESS_KEY_IDAWS_SECRET_ACCESS_KEY)aws_access_key_idaws_secret_access_keyregion_name
file_bytesoriginal_filenamereturnc                 T   |                     d          d         }t          j                     d| }d| }	 t                              t
          j        || d|            nB# t          $ r t          d           |cY S t          $ r}t          d|            |d}~ww xY w|S )	uK   
    Sube bytes a S3 en la carpeta /original/ y retorna el Key √∫nico.
    .z	original/zimage/)BucketKeyBodyContentTypeu8   ‚ö†Ô∏è [MOCK] No AWS Credentials. Simulando subida a S3.u   ‚ùå Error S3: N)
splituuiduuid4	s3_client
put_objectr   	S3_BUCKETr   print	Exception)r   r   extunique_filenames3_keyes         /app/app/services/s3_service.pyupload_imager"      s    
 
!
!#
&
&r
*C----O +
*
*F
%&	 	 	
 	
 	
 	
    
HIII   
"q""### s   +A& &B%	B%B  B%)boto3r   os
app.configr   botocore.exceptionsr   clientgetenv	S3_REGIONr   bytesstrr"        r!   <module>r.      s      				       2 2 2 2 2 2 
ELbi 344#")$;<<"	
 
 
	U s s      r-   

########################################
ARCHIVO: .\apps\backend\app\__pycache__\config.cpython-311.pyc
########################################



    Uji                     N    d Z ddlZddlmZ  G d de          Z e            ZdS )uj   
üéØ QU√â HACE: Centraliza todas las variables ENV
üìç CU√ÅNDO SE USA: Importado por main.py y services
    N)BaseSettingsc                   0   e Zd ZU  ej        dd          Zeed<    ej        dd          Zeed<    ej        dd          Z	eed<    ej        dd          Z
eed	<    ej        d
d          Zeed
<   dZeed
<   dZ
eed<   dZeed<    G d d          ZdS )SettingsDATABASE_URLz#postgresql://localhost/gpuchile_dev	REDIS_URLzredis://localhost:6379	S3_BUCKETzgpuchile-images-prod
AWS_REGIONz	us-east-1	S3_REGION
JWT_SECRETzdev-secret-change-in-prodHS256
JWT_ALGORITHMi`'  JWT_EXPIRATIONTRATE_LIMIT_ENABLEDc                       e Zd ZdZdS )Settings.Configz.envN)__name__
__module____qualname__env_file     /app/app/config.pyConfigr      s        r   r   N)r   r   r   osgetenvr   str__annotations__r   r   r
   r   r
   r   intr   boolr   r   r   r   r   r      s        !	.2WXXL#XXX RY{,DEEIsEEE RY{,BCCIsCCCRY|[99Is999  bi.IJJJJJJ M3   %NC%%%  $###         r   r   )__doc__r   pydantic_settingsr   r   settingsr   r   r   <module>r#      sg     
			 * * * * * *    |   , 8::r   

########################################
ARCHIVO: .\apps\backend\app\__pycache__\main.cpython-311.pyc
########################################



    riy
                     f   d Z ddlmZmZmZ ddlmZ ddlmZ ddl	m
Z
 ddlmZ ddl
mZ ddlmZmZ dd	lmZmZmZmZ ej                            e
            eddd
dd          Zg dZe                    eeddgdg           e                    ej        ddg           e                    ej        ddg           e                    ej        ddg           e                    ej        ddg           e                    ddg            ee          fd!e
fd"            Zd#S )$ug   
üéØ QU√â HACE: Inicia la aplicaci√≥n FastAPI
üìç CU√ÅNDO SE USA: Primer archivo que ejecuta uvicorn
    )FastAPIDepends
HTTPException)CORSMiddleware)text)Session)settings)Base)engineget_db)gpusauth	favoritesadmin)bindzGpuChile APIz,API para e-commerce de GPUs High-Performance1.0.0z/docsz/redoc)titledescriptionversiondocs_url	redoc_url)zhttp://localhost:3000zhttp://localhost:5173zhttp://localhost:8080zhttps://gpuchile.comzhttps://www.gpuchile.comT*)
allow_originsallow_credentials
allow_methods
allow_headersz	/api/gpusGPUs)prefixtagsz	/api/authAuthz/api/favorites	Favoritesz
/api/adminAdminz/healthHealth)r   dbc                    K   	 |                      t          d                     d}n5# t          $ r(}dt          |           }t	          dd          d}~ww xY wd|d	t          t          d
d          dS )
ur   
    Health check endpoint con verificaci√≥n de DB.
    Kubernetes usa esto para liveness y readiness probes.
    zSELECT 1	connectedzerror: i  zDatabase unavailable)status_codedetailNhealthyr   ENVIRONMENTdev)statusdatabaser   environment)executer   	Exceptionstrr   getattrr	   )r$   	db_statuses      /app/app/main.pyhealthr6   9   s      L


4
##$$$		 L L L&c!ff&&	4JKKKKL x>>	  s   $) 
A#AAN) __doc__fastapir   r   r   fastapi.middleware.corsr   
sqlalchemyr   sqlalchemy.ormr   
app.configr	   app.db.baser
   app.db.sessionr   r   app.api.routesr
   r   r   r   metadata
create_allapporiginsadd_middlewareinclude_routerroutergetr6        r5   <module>rJ      s"    4 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2       " " " " " "              ) ) ) ) ) ) ) ) 8 7 7 7 7 7 7 7 7 7 7 7 
  f  % % % g
>
       %%       4;{&  B B B   4;{&  B B B   9#,<K=  Q Q Q   5<G9  E E E ($$&wv  W    %$  rI   

########################################
ARCHIVO: .\apps\frontend\.env
########################################

# Para dev local (docker-compose), sigue usando localhost
VITE_API_URL=http://localhost:8000/api


########################################
ARCHIVO: .\apps\frontend\.env.example
########################################

# Backend API URL
VITE_API_URL=http://localhost:8000/api

# Otros configs opcionales
# VITE_APP_NAME=GpuChile
# VITE_ENABLE_DEVTOOLS=true


########################################
ARCHIVO: .\apps\frontend\.gitignore
########################################

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Env files
.env
.env.local
.env.production


########################################
ARCHIVO: .\apps\frontend\Dockerfile
########################################

# CAMBIO: Usamos 'slim' (Debian) en lugar de 'alpine' para evitar errores de binarios (musl vs glibc)
FROM node:20-slim AS base

# No necesitamos apk add libc6-compat porque Debian ya usa glibc
WORKDIR /app

# Copiar package files
COPY package*.json ./

# Instalar dependencias ignorando conflictos de versiones
RUN npm install --legacy-peer-deps

# Copiar c√≥digo fuente
COPY . .

# Exponer puerto de desarrollo
EXPOSE 5173

# Comando para desarrollo con hot reload
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]

########################################
ARCHIVO: .\apps\frontend\eslint.config.js
########################################

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])


########################################
ARCHIVO: .\apps\frontend\index.html
########################################

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="E-commerce de GPUs high-performance" />
    <title>GpuChile - GPU Marketplace</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>


########################################
ARCHIVO: .\apps\frontend\package.json
########################################

{
  "name": "gpuchile-frontend",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite --host 0.0.0.0",
    "build": "tsc && vite build",
    "preview": "vite preview --host 0.0.0.0",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.22.0",
    "@tanstack/react-query": "^5.17.19",
    "@tanstack/react-query-devtools": "^5.17.19",
    "axios": "^1.6.5",
    "lucide-react": "^0.309.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "typescript": "^5.5.3",
    "vite": "^5.4.1",
    "eslint": "^8.57.0",
    "@typescript-eslint/eslint-plugin": "^7.13.1",
    "@typescript-eslint/parser": "^7.13.1",
    "eslint-plugin-react-hooks": "^4.6.2",
    "eslint-plugin-react-refresh": "^0.4.7",
    "tailwindcss": "^3.4.1",
    "postcss": "^8.4.33",
    "autoprefixer": "^10.4.17"
  }
}


########################################
ARCHIVO: .\apps\frontend\postcss.config.js
########################################

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


########################################
ARCHIVO: .\apps\frontend\README.md
########################################

# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```


########################################
ARCHIVO: .\apps\frontend\tailwind.config.js
########################################

/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        // Dark Background Palette
        background: '#0f172a', // Slate 900 - Base oscuro
        surface: '#1e293b',    // Slate 800 - Cards
        'surface-hover': '#334155', // Slate 700 - Hover state
        
        // Purple Neon Palette (Primary)
        primary: {
          50: '#faf5ff',
          100: '#f3e8ff',
          200: '#e9d5ff',
          300: '#d8b4fe',
          400: '#c084fc',
          500: '#a855f7',
          600: '#9333ea',
          700: '#7e22ce',
          800: '#6b21a8',
          900: '#581c87',
          DEFAULT: '#7B2CBF', // Violeta principal
        },
        secondary: {
          DEFAULT: '#C77DFF', // Lila brillante
          light: '#E0AAFF',
        },
        
        // Text Colors
        'text-primary': '#f1f5f9',   // Slate 100 - Texto principal
        'text-secondary': '#94a3b8', // Slate 400 - Texto secundario
        'text-muted': '#64748b',     // Slate 500 - Texto terciario
        
        // Accent Colors
        accent: {
          purple: '#9D4EDD',
          cyan: '#06B6D4',
          green: '#10B981',
          red: '#EF4444',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      boxShadow: {
        'neon': '0 0 20px rgba(123, 44, 191, 0.5)',
        'neon-sm': '0 0 10px rgba(123, 44, 191, 0.3)',
        'neon-lg': '0 0 30px rgba(123, 44, 191, 0.6)',
      },
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'glow': 'glow 2s ease-in-out infinite alternate',
      },
      keyframes: {
        glow: {
          '0%': { boxShadow: '0 0 5px rgba(123, 44, 191, 0.2)' },
          '100%': { boxShadow: '0 0 20px rgba(123, 44, 191, 0.5)' },
        },
      },
    },
  },
  plugins: [],
}


########################################
ARCHIVO: .\apps\frontend\tsconfig.app.json
########################################

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}


########################################
ARCHIVO: .\apps\frontend\tsconfig.json
########################################

{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Path alias */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}


########################################
ARCHIVO: .\apps\frontend\tsconfig.node.json
########################################

{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "strict": true
  },
  "include": ["vite.config.ts"]
}


########################################
ARCHIVO: .\apps\frontend\vite.config.ts
########################################

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    host: '0.0.0.0', // Crucial para Docker
    port: 5173,
    watch: {
      usePolling: true, // Necesario para hot reload en Docker
    },
  },
})


########################################
ARCHIVO: .\apps\frontend\public\vite.svg
########################################

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>

########################################
ARCHIVO: .\apps\frontend\src\App.css
########################################

#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


########################################
ARCHIVO: .\apps\frontend\src\App.tsx
########################################

import { Routes, Route } from 'react-router-dom';
// üëá CORRECCI√ìN: Apuntar a la carpeta layout
import Navbar from './components/layout/Navbar'; 
import HomePage from './pages/HomePage';
import GPUDetail from './pages/GPUDetail';
import CartPage from './pages/CartPage';
import LoginPage from './pages/LoginPage';
import RegisterPage from './pages/RegisterPage';

function App() {
  return (
    <div className="bg-gray-900 min-h-screen text-white font-sans">
      <Navbar />
      
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/gpus/:id" element={<GPUDetail />} />
        <Route path="/cart" element={<CartPage />} />
        <Route path="/login" element={<LoginPage />} />
        <Route path="/register" element={<RegisterPage />} />
      </Routes>
    </div>
  );
}

export default App;

########################################
ARCHIVO: .\apps\frontend\src\index.css
########################################

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Variables CSS para tema oscuro */
@layer base {
  * {
    @apply border-slate-700;
  }
  
  body {
    @apply bg-background text-text-primary antialiased;
    font-feature-settings: "rlig" 1, "calt" 1;
  }

  /* Scrollbar oscuro custom */
  ::-webkit-scrollbar {
    width: 10px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-slate-900;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-slate-700 rounded-full;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-primary;
  }
}

/* Utilidades custom */
@layer utilities {
  .text-gradient {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary;
  }

  .glass {
    @apply bg-slate-900/80 backdrop-blur-md border border-white/10;
  }

  .card-dark {
    @apply bg-surface border border-slate-700/50 rounded-lg;
  }

  .glow-border {
    @apply border-2 border-primary/50 shadow-neon-sm;
  }
}

/* Animaciones de entrada */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeIn 0.5s ease-out;
}


########################################
ARCHIVO: .\apps\frontend\src\main.tsx
########################################

import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { CartProvider } from '@/context/CartContext';
import App from './App';
import './index.css';

// Configuraci√≥n de React Query
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 1,
      staleTime: 5 * 60 * 1000, // 5 minutos
    },
  },
});

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <CartProvider>
          <App />
        </CartProvider>
      </BrowserRouter>
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  </React.StrictMode>
);


########################################
ARCHIVO: .\apps\frontend\src\api\client.ts
########################################

import axios from 'axios';

const client = axios.create({
  // En producci√≥n (K8s), usa el proxy de Nginx (/api)
  // En local (docker-compose), usa variable de entorno
  baseURL: import.meta.env.VITE_API_URL || '/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

export default client;


########################################
ARCHIVO: .\apps\frontend\src\assets\react.svg
########################################

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>

########################################
ARCHIVO: .\apps\frontend\src\components\GPUCard.tsx
########################################

import { useQuery } from '@tanstack/react-query';
import { Link } from 'react-router-dom';
import { AlertCircle, Loader2, TrendingUp, Zap, Cpu } from 'lucide-react';
import gpuService from '@/services/gpu.service';
import Card, { CardContent, CardFooter } from '@/components/ui/Card';
import Button from '@/components/ui/Button';
import type { GPU } from '@/types/gpu';

const HomePage = () => {
  // Fetch GPUs con React Query
  const {
    data: gpus,
    isLoading,
    isError,
    error,
  } = useQuery({
    queryKey: ['gpus'],
    queryFn: () => gpuService.getGpus(),
    staleTime: 5 * 60 * 1000,
  });

  // Loading state
  if (isLoading) {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <Loader2 className="mx-auto h-12 w-12 animate-spin text-primary" />
          <p className="mt-4 text-lg text-text-secondary">Cargando GPUs...</p>
        </div>
      </div>
    );
  }

  // Error state
  if (isError) {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="max-w-md text-center">
          <AlertCircle className="mx-auto h-12 w-12 text-red-500" />
          <h2 className="mt-4 text-2xl font-bold text-text-primary">Error al cargar GPUs</h2>
          <p className="mt-2 text-text-secondary">
            {error instanceof Error ? error.message : 'Ocurri√≥ un error inesperado'}
          </p>
          <Button
            variant="primary"
            className="mt-6"
            onClick={() => window.location.reload()}
          >
            Reintentar
          </Button>
        </div>
      </div>
    );
  }

  // Empty state
  if (!gpus || gpus.length === 0) {
    return (
      <div className="flex min-h-[60vh] items-center justify-center">
        <div className="text-center">
          <Zap className="mx-auto h-12 w-12 text-text-muted" />
          <h2 className="mt-4 text-2xl font-bold text-text-primary">No hay GPUs disponibles</h2>
          <p className="mt-2 text-text-secondary">Vuelve m√°s tarde para ver nuestro cat√°logo.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-8 animate-fade-in">
      {/* Hero Section con gradiente morado */}
      <div className="relative overflow-hidden rounded-2xl bg-gradient-to-r from-slate-900 via-purple-900 to-slate-900 px-8 py-16 md:py-20">
        {/* Glow effect background */}
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(123,44,191,0.1),transparent_50%)]" />
        
        <div className="relative z-10">
          <h1 className="text-4xl font-bold text-text-primary md:text-5xl lg:text-6xl">
            Las Mejores GPUs
            <br />
            <span className="text-gradient">del Mercado</span>
          </h1>
          <p className="mt-6 max-w-2xl text-lg text-text-secondary md:text-xl">
            Encuentra la GPU perfecta para gaming, renderizado y AI. 
            <span className="text-primary font-semibold"> Stock actualizado</span> en tiempo real.
          </p>
          
          <div className="mt-8 flex flex-wrap gap-4">
            <Button variant="primary" size="lg" className="shadow-neon">
              Explorar Cat√°logo
            </Button>
            <Button variant="outline" size="lg" className="border-primary/50 text-primary hover:bg-primary/10">
              Ver Ofertas
            </Button>
          </div>
        </div>

        {/* Decorative lines */}
        <div className="absolute right-0 top-0 h-full w-1/3 opacity-20">
          <div className="absolute right-0 top-1/4 h-px w-full bg-gradient-to-l from-primary to-transparent" />
          <div className="absolute right-0 top-1/2 h-px w-full bg-gradient-to-l from-secondary to-transparent" />
          <div className="absolute right-0 top-3/4 h-px w-full bg-gradient-to-l from-primary to-transparent" />
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 gap-6 sm:grid-cols-3">
        <Card className="p-6 hover:border-primary/50 transition-all">
          <div className="flex items-center space-x-4">
            <div className="rounded-full bg-primary/20 p-3 ring-2 ring-primary/50">
              <TrendingUp className="h-6 w-6 text-primary" />
            </div>
            <div>
              <p className="text-3xl font-bold text-text-primary">{gpus.length}</p>
              <p className="text-sm text-text-secondary">GPUs Disponibles</p>
            </div>
          </div>
        </Card>

        <Card className="p-6 hover:border-accent-green/50 transition-all">
          <div className="flex items-center space-x-4">
            <div className="rounded-full bg-accent-green/20 p-3 ring-2 ring-accent-green/50">
              <Zap className="h-6 w-6 text-accent-green" />
            </div>
            <div>
              <p className="text-3xl font-bold text-text-primary">
                {gpus.filter((gpu) => gpu.stock > 0).length}
              </p>
              <p className="text-sm text-text-secondary">En Stock</p>
            </div>
          </div>
        </Card>

        <Card className="p-6 hover:border-accent-cyan/50 transition-all">
          <div className="flex items-center space-x-4">
            <div className="rounded-full bg-accent-cyan/20 p-3 ring-2 ring-accent-cyan/50">
              <Cpu className="h-6 w-6 text-accent-cyan" />
            </div>
            <div>
              <p className="text-3xl font-bold text-text-primary">
                {new Set(gpus.map((gpu) => gpu.brand)).size}
              </p>
              <p className="text-sm text-text-secondary">Marcas</p>
            </div>
          </div>
        </Card>
      </div>

      {/* GPU Grid */}
      <div>
        <div className="mb-6 flex items-center justify-between">
          <h2 className="text-3xl font-bold text-text-primary">
            Cat√°logo de <span className="text-gradient">GPUs</span>
          </h2>
          <div className="flex gap-2">
            <Button variant="ghost" size="sm" className="text-text-secondary hover:text-primary">
              Filtros
            </Button>
          </div>
        </div>
        
        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
          {gpus.map((gpu, index) => (
            <GPUCard key={gpu.id} gpu={gpu} index={index} />
          ))}
        </div>
      </div>
    </div>
  );
};

// GPU Card Component con efecto neon
interface GPUCardProps {
  gpu: GPU;
  index: number;
}

const GPUCard = ({ gpu, index }: GPUCardProps) => {
  const isOutOfStock = gpu.stock === 0;

  return (
    <Card 
      hoverable 
      className="flex flex-col overflow-hidden group"
      style={{ animationDelay: `${index * 50}ms` }}
    >
      {/* Image Container con overlay gradient */}
      <div className="relative aspect-square w-full overflow-hidden bg-slate-800">
        {gpu.image_url ? (
          <img
            src={gpu.image_url}
            alt={gpu.name}
            className="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
        ) : (
          <div className="flex h-full items-center justify-center bg-gradient-to-br from-slate-800 to-slate-900">
            <Cpu className="h-20 w-20 text-primary/30" />
          </div>
        )}
        
        {/* Gradient overlay */}
        <div className="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent opacity-60" />
        
        {isOutOfStock && (
          <div className="absolute inset-0 flex items-center justify-center bg-black/70 backdrop-blur-sm">
            <span className="rounded-full bg-red-600 px-4 py-2 text-sm font-bold text-white shadow-neon">
              Sin Stock
            </span>
          </div>
        )}

        {/* Brand badge */}
        <div className="absolute left-3 top-3">
          <span className="rounded-full bg-primary/80 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-white backdrop-blur-sm">
            {gpu.brand}
          </span>
        </div>
      </div>

      {/* Content */}
      <CardContent className="flex-1 space-y-3 p-4">
        {/* Name */}
        <h3 className="line-clamp-2 text-lg font-semibold text-text-primary group-hover:text-primary transition-colors">
          {gpu.name}
        </h3>

        {/* Specs */}
        <div className="flex items-center gap-4 text-sm">
          <div className="flex items-center gap-1.5">
            <div className="h-2 w-2 rounded-full bg-primary animate-pulse" />
            <span className="font-bold text-primary">{gpu.vram}GB</span>
            <span className="text-text-muted">VRAM</span>
          </div>
          {gpu.cuda_cores && (
            <div className="flex items-center gap-1.5">
              <div className="h-2 w-2 rounded-full bg-accent-cyan" />
              <span className="font-bold text-accent-cyan">{gpu.cuda_cores.toLocaleString()}</span>
              <span className="text-text-muted">Cores</span>
            </div>
          )}
        </div>

        {/* Price */}
        <div className="pt-2 border-t border-slate-700/50">
          <span className="text-2xl font-bold text-gradient">
            ${gpu.price.toLocaleString('es-CL')}
          </span>
        </div>
      </CardContent>

      {/* Footer */}
      <CardFooter className="flex items-center justify-between border-t border-slate-700/50 p-4 pt-4 bg-slate-800/50">
        <span className="text-sm">
          {isOutOfStock ? (
            <span className="text-red-500 font-medium">Agotado</span>
          ) : (
            <span className="text-text-secondary">
              <span className="font-semibold text-accent-green">{gpu.stock}</span> disponibles
            </span>
          )}
        </span>
        <Link to={`/gpu/${gpu.id}`}>
          <Button 
            variant="primary" 
            size="sm" 
            disabled={isOutOfStock}
            className="shadow-neon-sm hover:shadow-neon transition-all"
          >
            Ver detalles
          </Button>
        </Link>
      </CardFooter>
    </Card>
  );
};

export default HomePage;


########################################
ARCHIVO: .\apps\frontend\src\components\layout\Layout.tsx
########################################

import { Outlet } from 'react-router-dom';
import Navbar from './Navbar';

interface LayoutProps {
  children?: React.ReactNode;
}

const Layout = ({ children }: LayoutProps) => {
  return (
    <div className="min-h-screen bg-background">
      <Navbar /> {/* ‚úÖ Ahora obtiene itemCount desde el contexto */}
      
      <main className="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
        {children || <Outlet />}
      </main>

      {/* Footer oscuro */}
      <footer className="mt-auto border-t border-slate-800 bg-slate-900/50 py-8">
        <div className="mx-auto max-w-7xl px-4 text-center">
          <p className="text-sm text-text-secondary">
            ¬© {new Date().getFullYear()} <span className="text-gradient font-semibold">GpuChile</span>
            {' '}- Proyecto Portfolio EKS Production-Grade
          </p>
        </div>
      </footer>
    </div>
  );
};

export default Layout;


########################################
ARCHIVO: .\apps\frontend\src\components\layout\Navbar.tsx
########################################

import React from 'react';
import { Link } from 'react-router-dom';
// üëá Usamos Iconos SVG directos para evitar errores si no tienes lucide-react instalado
// Si tienes lucide instalado, puedes descomentar la siguiente linea y borrar el objeto Icons:
// import { ShoppingCart, User, Cpu } from 'lucide-react';

// üëá CONEXI√ìN REAL: Importamos desde el contexto que s√≠ existe
import { useCart } from '../../context/CartContext';

// Iconos SVG (Respaldos por si acaso)
const Icons = {
  Cpu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-8 w-8 text-purple-500 transition-all group-hover:drop-shadow-[0_0_8px_rgba(123,44,191,0.8)]"><rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></svg>,
  Cart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5 text-gray-300 group-hover:text-purple-400 transition-colors"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
  User: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2 h-4 w-4"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
};

const Navbar = () => {
  // üëá Usamos 'cartCount' que es la variable que definimos en CartContext.tsx
  const { cartCount } = useCart(); 

  return (
    <nav className="sticky top-0 z-50 w-full bg-gray-900/80 backdrop-blur-md border-b border-white/10">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div className="flex h-16 items-center justify-between">
          
          {/* Logo con efecto neon */}
          <Link to="/" className="flex items-center space-x-2 group">
            <Icons.Cpu />
            <span className="text-2xl font-bold">
              <span className="text-white">Gpu</span>
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">Chile</span>
            </span>
          </Link>

          {/* Navigation Links */}
          <div className="hidden md:flex md:items-center md:space-x-8">
            {['GPUs', 'Nosotros', 'Contacto'].map((item) => (
              <Link
                key={item}
                to="/"
                className="text-base font-medium text-gray-300 hover:text-purple-400 transition-colors relative group"
              >
                {item}
                <span className="absolute -bottom-1 left-0 h-0.5 w-0 bg-purple-500 transition-all group-hover:w-full" />
              </Link>
            ))}
          </div>

          {/* Right Side Actions */}
          <div className="flex items-center space-x-4">
            
            {/* Cart Button con glow */}
            <Link to="/cart" className="relative group p-2 hover:bg-gray-800 rounded-full transition-colors">
              <Icons.Cart />
              {cartCount > 0 && (
                <span className="absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full bg-purple-600 text-xs font-bold text-white shadow-[0_0_10px_rgba(168,85,247,0.5)] animate-pulse">
                  {cartCount > 9 ? '9+' : cartCount}
                </span>
              )}
            </Link>

            {/* User Button */}
            <Link to="/login">
              <button 
                className="flex items-center border border-purple-500/50 text-purple-400 hover:bg-purple-500/10 hover:shadow-[0_0_15px_rgba(168,85,247,0.3)] transition-all px-4 py-2 rounded-lg font-medium text-sm"
              >
                <Icons.User />
                Ingresar
              </button>
            </Link>
          </div>
        </div>
      </div>
    </nav>
  );
};

export default Navbar;

########################################
ARCHIVO: .\apps\frontend\src\components\ui\Button.tsx
########################################

import React from 'react';
import { cn } from '@/lib/utils';
import { Loader2 } from 'lucide-react';

export interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'outline' | 'danger' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  isLoading?: boolean;
  children: React.ReactNode;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant = 'primary', size = 'md', isLoading, children, disabled, ...props }, ref) => {
    const baseStyles = 'inline-flex items-center justify-center rounded-lg font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50';
    
    const variants = {
      primary: 'bg-primary text-white hover:bg-primary/90 hover:shadow-neon-sm focus-visible:ring-primary',
      secondary: 'bg-surface text-text-primary hover:bg-surface-hover focus-visible:ring-slate-600',
      outline: 'border-2 border-primary/50 text-primary hover:bg-primary/10 hover:border-primary focus-visible:ring-primary',
      danger: 'bg-accent-red text-white hover:bg-accent-red/90 focus-visible:ring-accent-red',
      ghost: 'hover:bg-surface text-text-secondary hover:text-text-primary focus-visible:ring-slate-600',
    };
    
    const sizes = {
      sm: 'h-9 px-3 text-sm',
      md: 'h-10 px-4 text-base',
      lg: 'h-12 px-6 text-lg',
    };

    return (
      <button
        ref={ref}
        className={cn(baseStyles, variants[variant], sizes[size], className)}
        disabled={disabled || isLoading}
        {...props}
      >
        {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
        {children}
      </button>
    );
  }
);

Button.displayName = 'Button';

export default Button;


########################################
ARCHIVO: .\apps\frontend\src\components\ui\Card.tsx
########################################

import React from 'react';
import { cn } from '@/lib/utils';

export interface CardProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  hoverable?: boolean;
}

const Card = React.forwardRef<HTMLDivElement, CardProps>(
  ({ className, children, hoverable = false, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(
          'card-dark overflow-hidden',
          hoverable && 'transition-all duration-300 hover:border-primary/50 hover:shadow-[0_0_20px_rgba(123,44,191,0.5)] hover:-translate-y-1',
          className
        )}
        {...props}
      >
        {children}
      </div>
    );
  }
);

Card.displayName = 'Card';

export const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('flex flex-col space-y-1.5 p-6', className)} {...props} />
  )
);

CardHeader.displayName = 'CardHeader';

export const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, children, ...props }, ref) => (
    <h3 ref={ref} className={cn('text-2xl font-semibold leading-none tracking-tight text-text-primary', className)} {...props}>
      {children}
    </h3>
  )
);

CardTitle.displayName = 'CardTitle';

export const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p ref={ref} className={cn('text-sm text-text-secondary', className)} {...props} />
  )
);

CardDescription.displayName = 'CardDescription';

export const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />
  )
);

CardContent.displayName = 'CardContent';

export const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('flex items-center p-6 pt-0', className)} {...props} />
  )
);

CardFooter.displayName = 'CardFooter';

export default Card;


########################################
ARCHIVO: .\apps\frontend\src\context\CartContext.tsx
########################################

import { createContext, useContext, useState, useEffect, ReactNode } from 'react';

// --- DEFINICI√ìN DE TIPOS (Interfaces) ---

export interface GPU {
  id: number;
  name: string;
  brand: string;
  model: string;
  price: number;
  vram: number;
  cuda_cores: number;
  stock: number;
  image_url: string;
  description?: string;
}

export interface CartItem {
  id: number;
  gpu_id: number;
  quantity: number;
  gpu: GPU; // La GPU anidada que viene del backend
}

interface CartResponse {
  items: CartItem[];
  total: number;
}

interface CartContextType {
  cartItems: CartItem[];
  cartCount: number;
  addToCart: (gpuId: number, quantity?: number) => Promise<boolean>;
  removeFromCart: (itemId: number) => Promise<void>;
  isLoading: boolean;
}

// --- CONTEXTO ---

const CartContext = createContext<CartContextType | undefined>(undefined);

export const useCart = () => {
  const context = useContext(CartContext);
  if (!context) throw new Error('useCart debe usarse dentro de CartProvider');
  return context;
};

// --- PROVIDER ---

interface CartProviderProps {
  children: ReactNode;
}

export const CartProvider = ({ children }: CartProviderProps) => {
  const [cartItems, setCartItems] = useState<CartItem[]>([]);
  const [cartCount, setCartCount] = useState<number>(0);
  const [sessionId, setSessionId] = useState<string>('');
  const [isLoading, setIsLoading] = useState<boolean>(false);
  
  // Usamos import.meta.env para Vite
  const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

  // 1. Generar o Recuperar Session ID
  useEffect(() => {
    let storedSession = localStorage.getItem('gpu_chile_session_id');
    if (!storedSession) {
      storedSession = crypto.randomUUID();
      localStorage.setItem('gpu_chile_session_id', storedSession);
    }
    setSessionId(storedSession);
    fetchCart(storedSession);
  }, []);

  // 2. Obtener Carrito
  const fetchCart = async (sid: string) => {
    if (!sid) return;
    try {
      const response = await fetch(`${API_URL}/cart/`, {
        headers: { 'session-id': sid }
      });
      
      if (response.ok) {
        const data: any = await response.json(); // Usamos any temporalmente para flexibilidad si la respuesta var√≠a
        // El backend devuelve una lista directa o un objeto { items: [] } dependiendo de tu implementaci√≥n final.
        // Asumimos que el backend devuelve una lista de items o un objeto { items: ... }
        // Ajuste defensivo:
        const items = Array.isArray(data) ? data : (data.items || []);
        
        setCartItems(items);
        const count = items.reduce((acc: number, item: CartItem) => acc + item.quantity, 0);
        setCartCount(count);
      }
    } catch (error) {
      console.error("Error cargando carrito:", error);
    }
  };

  // 3. Agregar al Carrito
  const addToCart = async (gpuId: number, quantity: number = 1): Promise<boolean> => {
    setIsLoading(true);
    try {
      const response = await fetch(`${API_URL}/cart/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'session-id': sessionId
        },
        body: JSON.stringify({ gpu_id: gpuId, quantity })
      });

      if (response.ok) {
        await fetchCart(sessionId);
        return true;
      } else {
        const err = await response.json();
        alert(`Error: ${err.detail}`);
        return false;
      }
    } catch (error) {
      console.error("Error agregando al carrito:", error);
      return false;
    } finally {
      setIsLoading(false);
    }
  };

  // 4. Eliminar del Carrito
  const removeFromCart = async (itemId: number) => {
    try {
      await fetch(`${API_URL}/cart/${itemId}`, {
        method: 'DELETE',
        headers: { 'session-id': sessionId }
      });
      await fetchCart(sessionId);
    } catch (error) {
      console.error("Error eliminando item:", error);
    }
  };

  const value: CartContextType = {
    cartItems,
    cartCount,
    addToCart,
    removeFromCart,
    isLoading
  };

  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;
};

########################################
ARCHIVO: .\apps\frontend\src\hooks\useCart.ts
########################################

/**
 * Hook simplificado para consumir el carrito
 * Re-exporta desde el contexto para mantener compatibilidad
 */
export { useCart } from '@/context/CartContext';


########################################
ARCHIVO: .\apps\frontend\src\lib\axios.ts
########################################

import axios from 'axios';

// Base URL desde variable de entorno
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

// Instancia de axios configurada
export const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000, // 10 segundos
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor (agregar token JWT cuando lo implementes)
api.interceptors.request.use(
  (config) => {
    // Obtener token de localStorage si existe
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor (manejo de errores global)
api.interceptors.response.use(
  (response) => response,
  (error) => {
    // Manejo de errores comunes
    if (error.response?.status === 401) {
      // Unauthorized - limpiar token y redirigir a login
      localStorage.removeItem('accessToken');
      window.location.href = '/login';
    }
    
    if (error.response?.status === 403) {
      // Forbidden
      console.error('No tienes permisos para esta acci√≥n');
    }
    
    if (error.response?.status >= 500) {
      // Server error
      console.error('Error del servidor. Intenta m√°s tarde.');
    }
    
    return Promise.reject(error);
  }
);

export default api;


########################################
ARCHIVO: .\apps\frontend\src\lib\utils.ts
########################################

import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

/**
 * Utility para combinar clases de Tailwind condicionalmente
 * Ejemplo: cn('bg-red-500', condition && 'text-white', 'p-4')
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}


########################################
ARCHIVO: .\apps\frontend\src\pages\CartPage.tsx
########################################

import React from 'react';
import { Link } from 'react-router-dom';
import { useCart } from '../context/CartContext';

const Icons = {
  Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
  Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
  Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
  ArrowRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
};

const CartPage = () => {
  const { cartItems, removeFromCart, addToCart, isLoading } = useCart();

  // Calcular total din√°micamente con Tipado seguro
  const total = cartItems.reduce((acc, item) => acc + (item.gpu.price * item.quantity), 0);

  if (cartItems.length === 0) {
    return (
      <div className="min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center p-4">
        <div className="bg-gray-800 p-8 rounded-2xl border border-gray-700 text-center shadow-2xl max-w-md w-full">
          <div className="bg-gray-700/50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg className="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
          </div>
          <h2 className="text-2xl font-bold mb-2">Tu carrito est√° vac√≠o</h2>
          <p className="text-gray-400 mb-8">Parece que a√∫n no has elegido tu pr√≥xima GPU.</p>
          <Link to="/" className="block w-full bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-xl font-bold transition-colors text-center">
            Volver al Cat√°logo
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-900 text-white p-4 md:p-8">
      <div className="max-w-7xl mx-auto">
        <h1 className="text-3xl font-bold mb-8 flex items-center gap-3">
          Tu Carrito <span className="text-purple-400">Gamer</span>
          <span className="text-sm bg-gray-800 text-gray-300 px-3 py-1 rounded-full font-normal">
            {cartItems.length} items
          </span>
        </h1>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          <div className="lg:col-span-2 space-y-4">
            {cartItems.map((item) => (
              <div key={item.id} className="bg-gray-800 border border-gray-700 rounded-xl p-4 flex flex-col sm:flex-row gap-4 items-center shadow-lg transition-all hover:border-purple-500/30">
                
                <div className="w-24 h-24 bg-gray-900 rounded-lg p-2 flex-shrink-0">
                  <img src={item.gpu.image_url} alt={item.gpu.name} className="w-full h-full object-contain" />
                </div>

                <div className="flex-1 text-center sm:text-left">
                  <h3 className="font-bold text-lg text-white">{item.gpu.name}</h3>
                  <p className="text-purple-400 text-sm">{item.gpu.brand}</p>
                  <p className="text-gray-400 text-xs mt-1">VRAM: {item.gpu.vram}GB</p>
                </div>

                <div className="flex items-center gap-3 bg-gray-900 rounded-lg p-1">
                  <button 
                    disabled={isLoading || item.quantity <= 1}
                    onClick={() => addToCart(item.gpu.id, -1)}
                    className="p-2 hover:bg-gray-700 rounded text-gray-300 disabled:opacity-30"
                  >
                    <Icons.Minus />
                  </button>
                  <span className="font-mono w-8 text-center">{item.quantity}</span>
                  <button 
                    disabled={isLoading}
                    onClick={() => addToCart(item.gpu.id, 1)}
                    className="p-2 hover:bg-gray-700 rounded text-white disabled:opacity-30"
                  >
                    <Icons.Plus />
                  </button>
                </div>

                <div className="text-right min-w-[100px]">
                  <div className="font-bold text-xl">${(item.gpu.price * item.quantity).toLocaleString()}</div>
                  {item.quantity > 1 && (
                    <div className="text-xs text-gray-500">${item.gpu.price.toLocaleString()} c/u</div>
                  )}
                </div>

                <button 
                  onClick={() => removeFromCart(item.id)}
                  className="p-2 text-red-400 hover:bg-red-400/10 rounded-full transition-colors"
                  title="Eliminar"
                >
                  <Icons.Trash />
                </button>
              </div>
            ))}
          </div>

          <div className="lg:col-span-1">
            <div className="bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-2xl sticky top-4">
              <h3 className="text-xl font-bold mb-6 text-white">Resumen del Pedido</h3>
              
              <div className="space-y-3 mb-6">
                <div className="flex justify-between text-gray-400">
                  <span>Subtotal</span>
                  <span>${total.toLocaleString()}</span>
                </div>
                <div className="flex justify-between text-gray-400">
                  <span>Env√≠o</span>
                  <span className="text-green-400">Gratis</span>
                </div>
                <div className="h-px bg-gray-700 my-4" />
                <div className="flex justify-between items-end">
                  <span className="text-lg font-bold">Total</span>
                  <span className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                    ${total.toLocaleString()}
                  </span>
                </div>
              </div>

              <button className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-4 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2">
                Proceder al Pago <Icons.ArrowRight />
              </button>
              
              <p className="text-xs text-center text-gray-500 mt-4">
                üîí Transacci√≥n segura encriptada con tecnolog√≠a EKS.
              </p>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
};

export default CartPage;

########################################
ARCHIVO: .\apps\frontend\src\pages\GPUDetail.jsx
########################################

import { useEffect, useState } from 'react';
import { useParams, Link } from 'react-router-dom';
import { useCart } from '../context/CartContext';

const GPUDetail = () => {
  const { id } = useParams();
  const [gpu, setGpu] = useState(null);
  const [loading, setLoading] = useState(true);
  const { addToCart } = useCart();
  const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

  useEffect(() => {
    // Buscar la GPU espec√≠fica por ID
    fetch(`${API_URL}/gpus/${id}`)
      .then((res) => {
        if (!res.ok) throw new Error("GPU no encontrada");
        return res.json();
      })
      .then((data) => {
        setGpu(data);
        setLoading(false);
      })
      .catch((err) => {
        console.error(err);
        setLoading(false);
      });
  }, [id]);

  if (loading) return <div className="text-white text-center mt-20">Cargando detalles...</div>;
  if (!gpu) return <div className="text-white text-center mt-20">GPU no encontrada üò¢</div>;

  return (
    <div className="container mx-auto p-6 mt-10">
      <div className="bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-700 flex flex-col md:flex-row">
        
        {/* Imagen Gigante */}
        <div className="md:w-1/2 p-8 bg-gray-900 flex items-center justify-center">
          <img 
            src={gpu.image_url} 
            alt={gpu.name} 
            className="max-h-[400px] object-contain hover:scale-110 transition-transform duration-500" 
          />
        </div>

        {/* Informaci√≥n */}
        <div className="md:w-1/2 p-8 flex flex-col justify-center">
          <div className="uppercase tracking-wide text-sm text-purple-400 font-semibold">{gpu.brand} ‚Ä¢ {gpu.model}</div>
          <h1 className="mt-2 text-4xl font-bold text-white leading-tight">{gpu.name}</h1>
          <p className="mt-4 text-gray-300 text-lg">{gpu.description || "Sin descripci√≥n disponible."}</p>
          
          <div className="mt-6 grid grid-cols-2 gap-4">
            <div className="bg-gray-700 p-3 rounded text-center">
              <span className="block text-gray-400 text-xs">VRAM</span>
              <span className="text-white font-bold">{gpu.vram} GB</span>
            </div>
            <div className="bg-gray-700 p-3 rounded text-center">
              <span className="block text-gray-400 text-xs">CUDA Cores</span>
              <span className="text-white font-bold">{gpu.cuda_cores}</span>
            </div>
          </div>

          <div className="mt-8 flex items-center justify-between">
            <span className="text-4xl font-bold text-white">${gpu.price.toLocaleString()}</span>
            <button 
              onClick={() => addToCart(gpu.id)}
              className="bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:-translate-y-1"
            >
              Agregar al Carrito üõí
            </button>
          </div>
          
          <Link to="/" className="mt-6 text-gray-400 hover:text-white text-sm">
            ‚Üê Volver al cat√°logo
          </Link>
        </div>
      </div>
    </div>
  );
};

export default GPUDetail;

########################################
ARCHIVO: .\apps\frontend\src\pages\HomePage.tsx
########################################

import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { useCart, GPU } from '../context/CartContext'; // Importamos la interfaz GPU tambi√©n

// Iconos (Tipados como Functional Components)
const Icons = {
  Cpu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></svg>,
  Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
  Cart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
  Trending: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
};

const HomePage = () => {
  const [gpus, setGpus] = useState<GPU[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

  useEffect(() => {
    fetch(`${API_URL}/gpus/`)
      .then(res => res.json())
      .then((data: GPU[]) => {
        setGpus(data);
        setLoading(false);
      })
      .catch(err => {
        console.error(err);
        setLoading(false);
      });
  }, []);

  if (loading) return (
    <div className="flex h-screen items-center justify-center bg-gray-900">
      <div className="text-purple-500 animate-pulse text-xl font-bold">Cargando Sistema...</div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-900 text-white p-4 md:p-8 space-y-12">
      
      {/* Hero Section */}
      <div className="relative overflow-hidden rounded-3xl bg-gradient-to-r from-indigo-900 via-purple-900 to-slate-900 px-8 py-16 shadow-2xl border border-purple-500/20">
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(123,44,191,0.3),transparent_70%)]" />
        <div className="relative z-10 max-w-3xl">
          <h1 className="text-5xl md:text-7xl font-extrabold tracking-tight mb-6 drop-shadow-lg">
            Las Mejores GPUs <br />
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">del Mercado</span>
          </h1>
          <p className="text-xl text-gray-300 mb-8 max-w-xl">
            Potencia tu setup con tecnolog√≠a de punta. Renderizado, IA y Gaming al m√°ximo nivel.
          </p>
          <button className="bg-purple-600 hover:bg-purple-500 text-white px-8 py-3 rounded-full font-bold shadow-[0_0_20px_rgba(168,85,247,0.5)] transition-all hover:scale-105">
            Explorar Cat√°logo
          </button>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {[
          { icon: Icons.Trending, val: gpus.length, label: "Modelos Disponibles", color: "text-blue-400", bg: "bg-blue-400/10" },
          { icon: Icons.Zap, val: gpus.filter(g => g.stock > 0).length, label: "En Stock Inmediato", color: "text-green-400", bg: "bg-green-400/10" },
          { icon: Icons.Cpu, val: new Set(gpus.map(g => g.brand)).size, label: "Marcas Premium", color: "text-pink-400", bg: "bg-pink-400/10" }
        ].map((stat, i) => (
          <div key={i} className="bg-gray-800/50 border border-gray-700 p-6 rounded-2xl flex items-center gap-4 hover:border-purple-500/30 transition-colors">
            <div className={`p-3 rounded-full ${stat.bg} ${stat.color}`}>
              <stat.icon />
            </div>
            <div>
              <div className="text-3xl font-bold">{stat.val}</div>
              <div className="text-gray-400 text-sm">{stat.label}</div>
            </div>
          </div>
        ))}
      </div>

      {/* Grid de Productos */}
      <div>
        <h2 className="text-3xl font-bold mb-8 flex items-center gap-2">
          Cat√°logo <span className="text-purple-400">Gamer</span>
        </h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {gpus.map((gpu) => (
            <GPUCard key={gpu.id} gpu={gpu} />
          ))}
        </div>
      </div>
    </div>
  );
};

// Componente Tarjeta Individual
interface GPUCardProps {
  gpu: GPU;
}

const GPUCard = ({ gpu }: GPUCardProps) => {
  const { addToCart } = useCart();
  const [isAdding, setIsAdding] = useState(false);

  const handleAdd = async () => {
    setIsAdding(true);
    await addToCart(gpu.id);
    setTimeout(() => setIsAdding(false), 500);
  };

  return (
    <div className="group bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-purple-500/50 transition-all duration-300 hover:shadow-[0_0_30px_rgba(168,85,247,0.15)] flex flex-col">
      <div className="relative h-64 bg-gray-900 p-6 flex items-center justify-center overflow-hidden">
        <img 
          src={gpu.image_url} 
          alt={gpu.name} 
          className="max-h-full object-contain transition-transform duration-500 group-hover:scale-110 group-hover:rotate-2"
        />
        <div className="absolute top-3 left-3 bg-gray-900/80 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-white border border-gray-600">
          {gpu.brand}
        </div>
        {gpu.stock === 0 && (
          <div className="absolute inset-0 bg-black/70 flex items-center justify-center font-bold text-red-500 text-xl backdrop-blur-sm">
            AGOTADO
          </div>
        )}
      </div>

      <div className="p-5 flex-1 flex flex-col">
        <Link to={`/gpus/${gpu.id}`}>
          <h3 className="text-lg font-bold text-white mb-2 line-clamp-2 hover:text-purple-400 transition-colors">
            {gpu.name}
          </h3>
        </Link>
        
        <div className="flex gap-2 mb-4 text-xs font-mono">
          <span className="bg-purple-500/20 text-purple-300 px-2 py-1 rounded">{gpu.vram}GB VRAM</span>
          <span className="bg-blue-500/20 text-blue-300 px-2 py-1 rounded">{gpu.cuda_cores} Cores</span>
        </div>

        <div className="mt-auto pt-4 border-t border-gray-700 flex items-center justify-between">
          <span className="text-2xl font-bold text-white">
            ${gpu.price.toLocaleString()}
          </span>
          
          <button
            onClick={handleAdd}
            disabled={gpu.stock === 0 || isAdding}
            className={`p-3 rounded-lg transition-all ${
              isAdding 
                ? 'bg-green-600 text-white' 
                : 'bg-white text-black hover:bg-purple-400 hover:text-white'
            } disabled:opacity-50 disabled:cursor-not-allowed`}
          >
            {isAdding ? (
              <span className="text-xs font-bold">AGREGADO</span>
            ) : (
              <Icons.Cart />
            )}
          </button>
        </div>
      </div>
    </div>
  );
};

export default HomePage;

########################################
ARCHIVO: .\apps\frontend\src\pages\LoginPage.tsx
########################################

import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';

const LoginPage = () => {
  const navigate = useNavigate();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleLogin = (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    
    // Simulaci√≥n de Login por ahora (MVP)
    setTimeout(() => {
      setLoading(false);
      alert("Login simulado exitoso. (La l√≥gica real de Auth se implementar√° en la fase Cloud)");
      navigate('/'); // Redirigir al Home
    }, 1500);
  };

  return (
    <div className="min-h-screen bg-gray-900 flex items-center justify-center p-4 relative overflow-hidden">
      {/* Background Decor */}
      <div className="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-purple-600/20 rounded-full blur-[100px]" />
      <div className="absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[100px]" />

      <div className="bg-gray-800 border border-gray-700 p-8 rounded-2xl shadow-2xl w-full max-w-md relative z-10">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-white mb-2">Bienvenido de vuelta</h1>
          <p className="text-gray-400">Ingresa a tu cuenta GpuChile</p>
        </div>

        <form onSubmit={handleLogin} className="space-y-6">
          <div>
            <label className="block text-sm font-medium text-gray-300 mb-2">Email</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
              placeholder="ejemplo@gpuchile.com"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-300 mb-2">Contrase√±a</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white font-bold py-3 rounded-lg shadow-lg transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {loading ? 'Ingresando...' : 'Iniciar Sesi√≥n'}
          </button>
        </form>

        <div className="mt-6 text-center text-sm text-gray-400">
          ¬øNo tienes cuenta?{' '}
          <Link to="/register" className="text-purple-400 hover:text-purple-300 font-semibold">
            Reg√≠strate aqu√≠
          </Link>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;

########################################
ARCHIVO: .\apps\frontend\src\pages\RegisterPage.tsx
########################################

import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';

const RegisterPage = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleRegister = (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      alert("Registro simulado. ¬°Bienvenido!");
      navigate('/login');
    }, 1500);
  };

  return (
    <div className="min-h-screen bg-gray-900 flex items-center justify-center p-4 relative overflow-hidden">
      <div className="absolute top-[20%] right-[30%] w-[400px] h-[400px] bg-pink-600/10 rounded-full blur-[100px]" />

      <div className="bg-gray-800 border border-gray-700 p-8 rounded-2xl shadow-2xl w-full max-w-md relative z-10">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-white mb-2">Crear Cuenta</h1>
          <p className="text-gray-400">√önete a la comunidad Gamer</p>
        </div>

        <form onSubmit={handleRegister} className="space-y-5">
          <div className="grid grid-cols-2 gap-4">
            <input type="text" placeholder="Nombre" className="bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-purple-500 outline-none" required />
            <input type="text" placeholder="Apellido" className="bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-purple-500 outline-none" required />
          </div>
          
          <input type="email" placeholder="Email" className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-purple-500 outline-none" required />
          <input type="password" placeholder="Contrase√±a" className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-purple-500 outline-none" required />
          <input type="password" placeholder="Confirmar Contrase√±a" className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-purple-500 outline-none" required />

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3 rounded-lg shadow-lg transform transition active:scale-95 disabled:opacity-50"
          >
            {loading ? 'Creando cuenta...' : 'Registrarse'}
          </button>
        </form>

        <div className="mt-6 text-center text-sm text-gray-400">
          ¬øYa tienes cuenta?{' '}
          <Link to="/login" className="text-pink-400 hover:text-pink-300 font-semibold">
            Ingresa aqu√≠
          </Link>
        </div>
      </div>
    </div>
  );
};

export default RegisterPage;

########################################
ARCHIVO: .\apps\frontend\src\services\cart.service.ts
########################################

import { api } from '@/lib/axios';
import type { AxiosResponse } from 'axios';

/**
 * Tipos para el carrito
 */
export interface CartItemResponse {
  id: number;
  gpu_id: number;
  quantity: number;
  gpu: {
    id: number;
    name: string;
    brand: string;
    model: string;
    price: number;
    image_url: string | null;
    stock: number;
  };
}

export interface CartResponse {
  items: CartItemResponse[];
  total: number;
}

export interface AddToCartRequest {
  gpu_id: number;
  quantity: number;
}

/**
 * Servicio para operaciones del carrito
 * IMPORTANTE: Todas las requests deben incluir el header session_id
 */
export const cartService = {
  /**
   * Obtener el carrito actual
   */
  async getCart(sessionId: string): Promise<CartResponse> {
    const response: AxiosResponse<CartResponse> = await api.get('/cart', {
      headers: { session_id: sessionId },
    });
    return response.data;
  },

  /**
   * Agregar item al carrito
   */
  async addToCart(sessionId: string, data: AddToCartRequest): Promise<CartItemResponse> {
    const response: AxiosResponse<CartItemResponse> = await api.post('/cart', data, {
      headers: { session_id: sessionId },
    });
    return response.data;
  },

  /**
   * Actualizar cantidad de un item
   */
  async updateCartItem(
    sessionId: string,
    itemId: number,
    quantity: number
  ): Promise<CartItemResponse> {
    const response: AxiosResponse<CartItemResponse> = await api.put(
      `/cart/${itemId}`,
      { quantity },
      { headers: { session_id: sessionId } }
    );
    return response.data;
  },

  /**
   * Eliminar item del carrito
   */
  async removeFromCart(sessionId: string, itemId: number): Promise<void> {
    await api.delete(`/cart/${itemId}`, {
      headers: { session_id: sessionId },
    });
  },

  /**
   * Limpiar carrito completo
   */
  async clearCart(sessionId: string): Promise<void> {
    await api.delete('/cart', {
      headers: { session_id: sessionId },
    });
  },
};

export default cartService;


########################################
ARCHIVO: .\apps\frontend\src\services\gpu.service.ts
########################################

import { api } from '@/lib/axios';
import type { GPU, GPUQueryParams } from '@/types/gpu';
import type { AxiosResponse } from 'axios';

/**
 * Servicio para operaciones CRUD de GPUs
 */
export const gpuService = {
  /**
   * Obtener lista de GPUs con filtros opcionales
   */
  async getGpus(params?: GPUQueryParams): Promise<GPU[]> {
    const response: AxiosResponse<GPU[]> = await api.get('/gpus', { params });
    return response.data;
  },

  /**
   * Obtener GPU por ID
   */
  async getGpuById(id: number): Promise<GPU> {
    const response: AxiosResponse<GPU> = await api.get(`/gpus/${id}`);
    return response.data;
  },

  /**
   * Buscar GPUs por brand
   */
  async getGpusByBrand(brand: string): Promise<GPU[]> {
    const response: AxiosResponse<GPU[]> = await api.get('/gpus', {
      params: { brand },
    });
    return response.data;
  },
};

export default gpuService;


########################################
ARCHIVO: .\apps\frontend\src\types\api.ts
########################################

/**
 * Respuestas gen√©ricas de API
 */

export interface ApiResponse<T> {
  data: T;
  message?: string;
}

export interface ApiError {
  detail: string;
  status?: number;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  skip: number;
  limit: number;
}

/**
 * Auth types
 */
export interface User {
  id: number;
  email: string;
  username: string;
  role: 'admin' | 'customer';
  created_at: string;
}

export interface LoginCredentials {
  username: string;
  password: string;
}

export interface AuthResponse {
  access_token: string;
  token_type: string;
  user: User;
}

/**
 * Cart types
 */
export interface CartItem {
  id: number;
  gpu_id: number;
  quantity: number;
  gpu: {
    id: number;
    name: string;
    brand: string;
    model: string;
    price: number;
    image_url: string | null;
  };
}

export interface CartResponse {
  items: CartItem[];
  total: number;
}


########################################
ARCHIVO: .\apps\frontend\src\types\gpu.ts
########################################

/**
 * Interfaz GPU basada en el modelo del backend
 * Debe coincidir con la respuesta de FastAPI
 */
export interface GPU {
  id: number;
  name: string;
  brand: string;
  model: string;
  price: number;
  stock: number;
  vram: number;
  cuda_cores: number | null;
  image_url: string | null;
  description: string | null;
  created_at: string; // ISO 8601 datetime
}

/**
 * Filtros para b√∫squeda de GPUs
 */
export interface GPUFilters {
  brand?: string;
  minPrice?: number;
  maxPrice?: number;
  minVram?: number;
}

/**
 * Query params para paginaci√≥n
 */
export interface GPUQueryParams {
  skip?: number;
  limit?: number;
  brand?: string;
}


########################################
ARCHIVO: .\apps\frontend\src\types\types.ts
########################################

export interface GPU {
  id: number;
  model: string;
  brand: string;
  series?: string;
  vram: number;
  price: number;
  stock: number;
  image_url?: string;
  thumbnail_url?: string;
  is_featured: boolean;
}


########################################
ARCHIVO: .\docs\decisions\adr-002-lambda-convention.md
########################################

# ADR-002: Convention Over Configuration para Im√°genes

**Status**: ACCEPTED

**Context**:
Lambda necesita escribir URL de thumbnail en RDS. Esto requiere:
- Lambda en VPC (sin internet)
- NAT Gateway ($32 USD/mes)
- Total: Presupuesto reventado

**Decision**:
Lambda NO escribe en DB. Backend construye URLs por convenci√≥n:
- Original: `s3://.../original/{image_key}`
- Thumbnail: `s3://.../thumbnails/{image_key}` (mismo nombre)

**Consequences**:
**Pros**:
- Costo $0 (Lambda sin VPC)
- Desacoplamiento (Lambda stateless)
- Idempotente (regenerar thumbnails sin DB)

**Contras**:
- Requiere convenci√≥n documentada
- No puedes tener m√∫ltiples thumbnails con nombres diferentes

**References**:
- [12-Factor App: Build, Release, Run](https://12factor.net/build-release-run)
- AWS Lambda Best Practices


########################################
ARCHIVO: .\helm\backend\Chart.yaml
########################################

apiVersion: v2
name: gpuchile-backend
description: FastAPI Backend for GpuChile E-commerce
type: application
version: 1.0.0
appVersion: "1.0.0"
maintainers:
  - name: Nicolas Nunez
    email: nicolasnunezalvarez@gmail.com

########################################
ARCHIVO: .\helm\backend\values.yaml
########################################

# ============================================
# CONFIGURACI√ìN DEL BACKEND - GPUCHILE
# ============================================

replicaCount: 1  # HPA controlar√° esto

image:
  repository: 380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend
  pullPolicy: IfNotPresent
  tag: "latest"

# Recursos Minimal (Optimizado para costos)
resources:
  limits:
    cpu: 500m
    memory: 768Mi
  requests:
    cpu: 250m
    memory: 512Mi

# Autoscaling (1-3 r√©plicas seg√∫n carga)
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70

# Health Checks
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 2

# Service Account (para IRSA - Acceso a S3/Secrets Manager)
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "PLACEHOLDER_ROLE_ARN"  # Se reemplaza despu√©s
  name: gpuchile-backend-sa

# Networking
service:
  type: LoadBalancer  # Opci√≥n simple, cambia a ClusterIP si usas Ingress
  port: 80
  targetPort: 8000
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

# Ingress (Descomentado cuando tengas dominio + cert-manager)
ingress:
  enabled: false  # Cambia a true cuando uses dominio custom
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.gpuchile.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: api-gpuchile-tls
      hosts:
        - api.gpuchile.com

# External Secrets (Sincroniza credenciales de AWS Secrets Manager)
externalSecrets:
  enabled: true
  secretStoreName: aws-secrets-store
  refreshInterval: 1h
  target:
    name: backend-secrets
  data:
    - secretKey: DATABASE_URL
      remoteRef:
        key: gpuchile/dev/db
        property: url
    - secretKey: REDIS_URL
      remoteRef:
        key: gpuchile/dev/redis
        property: url
    - secretKey: JWT_SECRET
      remoteRef:
        key: gpuchile/dev/jwt
        property: secret

# Variables de Entorno (No sensibles)
env:
  - name: ENVIRONMENT
    value: "production"
  - name: AWS_REGION
    value: "us-east-1"
  - name: S3_BUCKET
    value: "gpuchile-images-dev-nicolas-2026"
  - name: LOG_LEVEL
    value: "INFO"

########################################
ARCHIVO: .\helm\backend\templates\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "backend.fullname" . }}
  labels:
    {{- include "backend.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  
  selector:
    matchLabels:
      {{- include "backend.selectorLabels" . | nindent 6 }}
  
  template:
    metadata:
      annotations:
        # Forzar restart cuando cambian secrets
        checksum/secret: {{ include (print $.Template.BasePath "/externalsecret.yaml") . | sha256sum }}
      labels:
        {{- include "backend.selectorLabels" . | nindent 8 }}
    
    spec:
      serviceAccountName: {{ include "backend.serviceAccountName" . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      
      # ‚úÖ InitContainer: SOLO health check, SIN migrations
      initContainers:
      - name: wait-for-db
        image: postgres:15-alpine
        command:
        - sh
        - -c
        - |
          echo "‚è≥ Esperando PostgreSQL..."
          until pg_isready -h {{ .Values.database.host }} -p {{ .Values.database.port }}; do
            sleep 2
          done
          echo "‚úÖ PostgreSQL listo para conexiones"
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 100m
            memory: 128Mi
      
      containers:
      - name: {{ .Chart.Name }}
        securityContext:
          {{- toYaml .Values.securityContext | nindent 12 }}
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        
        ports:
        - name: http
          containerPort: 8000
          protocol: TCP
        
        # Health probes
        livenessProbe:
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        
        readinessProbe:
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        
        startupProbe:
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 30  # 150s para startup
        
        env:
        # Database
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: database_url
        
        # Redis
        - name: REDIS_HOST
          value: {{ .Values.redis.host | quote }}
        
        - name: REDIS_PORT
          value: {{ .Values.redis.port | quote }}
        
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: {{ .Values.redis.passwordKey }}
        
        # App config
        - name: SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: secret_key
        
        - name: ENVIRONMENT
          value: {{ .Values.environment | quote }}
        
        - name: BACKEND_CORS_ORIGINS
          value: {{ .Values.corsOrigins | toJson | quote }}
        
        resources:
          {{- toYaml .Values.resources | nindent 12 }}
      
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}


########################################
ARCHIVO: .\helm\backend\templates\external-secret.yaml
########################################

{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "gpuchile-backend.fullname" . }}-external-secret
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: SecretStore
  target:
    name: {{ .Values.externalSecrets.target.name }}
    creationPolicy: Owner
  data:
  {{- range .Values.externalSecrets.data }}
  - secretKey: {{ .secretKey }}
    remoteRef:
      key: {{ .remoteRef.key }}
      {{- if .remoteRef.property }}
      property: {{ .remoteRef.property }}
      {{- end }}
  {{- end }}
{{- end }}


########################################
ARCHIVO: .\helm\backend\templates\hpa.yaml
########################################

{{- if .Values.autoscaling.enabled }}
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: {{ include "gpuchile-backend.fullname" . }}
  labels:
    app: {{ include "gpuchile-backend.name" . }}
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: {{ include "gpuchile-backend.fullname" . }}
  minReplicas: {{ .Values.autoscaling.minReplicas }}
  maxReplicas: {{ .Values.autoscaling.maxReplicas }}
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: {{ .Values.autoscaling.targetCPUUtilizationPercentage }}
{{- end }}


########################################
ARCHIVO: .\helm\backend\templates\ingress.yaml
########################################

{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "gpuchile-backend.fullname" . }}
  annotations:
    {{- toYaml .Values.ingress.annotations | nindent 4 }}
spec:
  ingressClassName: {{ .Values.ingress.className }}
  {{- if .Values.ingress.tls }}
  tls:
    {{- range .Values.ingress.tls }}
    - hosts:
        {{- range .hosts }}
        - {{ . | quote }}
        {{- end }}
      secretName: {{ .secretName }}
    {{- end }}
  {{- end }}
  rules:
    {{- range .Values.ingress.hosts }}
    - host: {{ .host | quote }}
      http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "gpuchile-backend.fullname" $ }}
                port:
                  number: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}


########################################
ARCHIVO: .\helm\backend\templates\migration-job.yaml
########################################

{{- if .Values.migration.enabled }}
apiVersion: batch/v1
kind: Job
metadata:
  name: {{ include "backend.fullname" . }}-migration-{{ now | date "20060102-150405" }}
  labels:
    {{- include "backend.labels" . | nindent 4 }}
    app.kubernetes.io/component: migration
  annotations:
    # Helm hook: ejecutar ANTES del deployment
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-5"
    helm.sh/hook-delete-policy: before-hook-creation
spec:
  # Solo 1 pod ejecutando migrations
  completions: 1
  parallelism: 1
  backoffLimit: 3
  activeDeadlineSeconds: 600  # 10 minutos timeout
  
  template:
    metadata:
      labels:
        {{- include "backend.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: migration
      annotations:
        # Forzar pull de imagen fresca
        timestamp: {{ now | date "20060102150405" | quote }}
    
    spec:
      restartPolicy: Never
      serviceAccountName: {{ include "backend.serviceAccountName" . }}
      
      # InitContainer: Solo health check de DB
      initContainers:
      - name: wait-for-db
        image: postgres:15-alpine
        command:
        - sh
        - -c
        - |
          echo "‚è≥ Esperando PostgreSQL..."
          until pg_isready -h {{ .Values.database.host }} -p {{ .Values.database.port }} -U {{ .Values.database.user }}; do
            sleep 2
          done
          echo "‚úÖ PostgreSQL est√° listo"
        env:
        - name: PGPASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: {{ .Values.database.passwordKey }}
      
      containers:
      - name: migration
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        
        # ‚úÖ Ejecutar script de migraciones
        command:
        - python
        - migrate.py
        
        env:
        # Database
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: database_url
        
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: {{ .Values.database.usernameKey }}
        
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: {{ .Values.database.passwordKey }}
        
        - name: POSTGRES_DB
          value: {{ .Values.database.name | quote }}
        
        - name: POSTGRES_HOST
          value: {{ .Values.database.host | quote }}
        
        - name: POSTGRES_PORT
          value: {{ .Values.database.port | quote }}
        
        # Redis (para compatibilidad con app.main imports)
        - name: REDIS_HOST
          value: {{ .Values.redis.host | quote }}
        
        - name: REDIS_PORT
          value: {{ .Values.redis.port | quote }}
        
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: {{ .Values.redis.passwordKey }}
        
        # App config
        - name: SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: {{ .Values.externalSecret.name }}
              key: secret_key
        
        - name: ENVIRONMENT
          value: {{ .Values.environment | quote }}
        
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 500m
            memory: 512Mi
        
        # Security context
        securityContext:
          allowPrivilegeEscalation: false
          runAsNonRoot: true
          runAsUser: 1000
          capabilities:
            drop:
            - ALL
{{- end }}


########################################
ARCHIVO: .\helm\backend\templates\service.yaml
########################################

apiVersion: v1
kind: Service
metadata:
  name: {{ include "gpuchile-backend.fullname" . }}
  labels:
    app: {{ include "gpuchile-backend.name" . }}
  {{- with .Values.service.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: {{ .Values.service.targetPort }}
      protocol: TCP
      name: http
  selector:
    app: {{ include "gpuchile-backend.name" . }}


########################################
ARCHIVO: .\helm\backend\templates\_helpers.tpl
########################################

{{/*
Expand the name of the chart.
*/}}
{{- define "gpuchile-backend.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}
{{- end }}

{{/*
Create a default fully qualified app name.
We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
*/}}
{{- define "gpuchile-backend.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- $name := default .Chart.Name .Values.nameOverride }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
{{- end }}

{{/*
Create chart name and version as used by the chart label.
*/}}
{{- define "gpuchile-backend.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
{{- end }}

########################################
ARCHIVO: .\helm\frontend\Chart.yaml
########################################

apiVersion: v2
name: gpuchile-frontend
description: React Frontend for GpuChile E-commerce
type: application
version: 1.0.0
appVersion: "1.0.0"
maintainers:
  - name: Nicolas Nunez
    email: nicolasnunezalvarez05@gmail.com

########################################
ARCHIVO: .\helm\frontend\nginx.conf
########################################

server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression (Performance boost)
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/css text/javascript application/javascript application/json image/svg+xml;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Cache static assets aggressively
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ‚úÖ PROXY REVERSO AL BACKEND (La magia est√° aqu√≠)
    # K8s DNS: http://<service-name>.<namespace>.svc.cluster.local:<port>
    location /api/ {
        # ‚ö†Ô∏è FIX: Quita el /api/ del final del proxy_pass
        # Si pones /api/, Nginx concatena y queda /api/api/gpus
        proxy_pass http://gpuchile-backend.default.svc.cluster.local:8000;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts (para requests lentos)
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # React Router: Todas las rutas apuntan a index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Health check endpoint (para K8s probes)
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}


########################################
ARCHIVO: .\helm\frontend\values.yaml
########################################

# ============================================
# CONFIGURACI√ìN DEL FRONTEND - GPUCHILE
# ============================================

replicaCount: 2  # Dos r√©plicas para alta disponibilidad

image:
  repository: 380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-frontend
  pullPolicy: IfNotPresent
  tag: "latest"

# Recursos (Frontend est√°tico en Nginx es super ligero)
resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Health Checks (Nginx responde en /)
livenessProbe:
  httpGet:
    path: /healt
    port: 80
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /healt
    port: 80
  initialDelaySeconds: 5
  periodSeconds: 5

# Networking
service:
  type: LoadBalancer  # Cambia a ClusterIP si usas Ingress
  port: 80
  targetPort: 80
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

# Ingress (Descomentado cuando tengas dominio)
ingress:
  enabled: false  # Cambia a true cuando uses dominio custom
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: gpuchile.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: gpuchile-tls
      hosts:
        - gpuchile.com

# Variables de entorno inyectadas en el build (para Vite)
#env:
  #VITE_API_URL: "http://BACKEND_LOAD_BALANCER_URL/api"  # ‚ö†Ô∏è Actualizar despu√©s del deploy del backend


########################################
ARCHIVO: .\helm\frontend\templates\configmap.yaml
########################################

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gpuchile-frontend.fullname" . }}-nginx-config
  labels:
    app: {{ include "gpuchile-frontend.name" . }}
data:
  default.conf: |
{{ .Files.Get "nginx.conf" | indent 4 }}


########################################
ARCHIVO: .\helm\frontend\templates\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "gpuchile-frontend.fullname" . }}
  labels:
    app: {{ include "gpuchile-frontend.name" . }}
    version: {{ .Chart.AppVersion }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "gpuchile-frontend.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "gpuchile-frontend.name" . }}
        version: {{ .Chart.AppVersion }}
    spec:
      containers:
      - name: frontend
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        ports:
        - name: http
          containerPort: 80
          protocol: TCP
        
        # Mount custom nginx.conf
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/conf.d
          readOnly: true
        
        # Health Checks
        livenessProbe:
          {{- toYaml .Values.livenessProbe | nindent 10 }}
        readinessProbe:
          {{- toYaml .Values.readinessProbe | nindent 10 }}
        
        # Resources
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      
      volumes:
      - name: nginx-config
        configMap:
          name: {{ include "gpuchile-frontend.fullname" . }}-nginx-config


########################################
ARCHIVO: .\helm\frontend\templates\ingress.yaml
########################################

{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "gpuchile-frontend.fullname" . }}
  annotations:
    {{- toYaml .Values.ingress.annotations | nindent 4 }}
spec:
  ingressClassName: {{ .Values.ingress.className }}
  {{- if .Values.ingress.tls }}
  tls:
    {{- range .Values.ingress.tls }}
    - hosts:
        {{- range .hosts }}
        - {{ . | quote }}
        {{- end }}
      secretName: {{ .secretName }}
    {{- end }}
  {{- end }}
  rules:
    {{- range .Values.ingress.hosts }}
    - host: {{ .host | quote }}
      http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "gpuchile-frontend.fullname" $ }}
                port:
                  number: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}


########################################
ARCHIVO: .\helm\frontend\templates\service.yaml
########################################

apiVersion: v1
kind: Service
metadata:
  name: {{ include "gpuchile-frontend.fullname" . }}
  labels:
    app: {{ include "gpuchile-frontend.name" . }}
  {{- with .Values.service.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: {{ .Values.service.targetPort }}
      protocol: TCP
      name: http
  selector:
    app: {{ include "gpuchile-frontend.name" . }}


########################################
ARCHIVO: .\helm\frontend\templates\_helpers.tpl
########################################

{{/*
Expand the name of the chart.
*/}}
{{- define "gpuchile-frontend.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}
{{- end }}

{{/*
Create a default fully qualified app name.
*/}}
{{- define "gpuchile-frontend.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- $name := default .Chart.Name .Values.nameOverride }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
{{- end }}

{{/*
Create chart name and version as used by the chart label.
*/}}
{{- define "gpuchile-frontend.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
{{- end }}


########################################
ARCHIVO: .\kubernetes\providers.tf
########################################

terraform {
  required_version = ">= 1.13.4"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "us-east-1"
}

########################################
ARCHIVO: .\kubernetes\secrets.yaml
########################################

apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
type: Opaque
stringData:
  # Esta es la contrase√±a real que ser√° encriptada por Kubernetes
  db-password: "GpuChile2024!"

########################################
ARCHIVO: .\kubernetes\backend\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: gpuchile-backend
  namespace: default
  labels:
    app: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      serviceAccountName: gpuchile-backend-sa
      containers:
        - name: backend
          image: 380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8000
          
          # üëáüëáüëá SECCI√ìN CR√çTICA CORREGIDA üëáüëáüëá
          env:
            # 1. EL DATO QUE FALTABA (Para que no crashee al inicio)
            - name: SECRET_KEY
              value: "supersecretkey123"

            # 2. BOMBARDEO DE CREDENCIALES (Cubrimos todos los nombres posibles)
            
            # Formato est√°ndar de Docker/Postgres
            - name: POSTGRES_USER
              value: "gpuchile_admin"
            - name: POSTGRES_PASSWORD
              value: "GpuChile2024!"
            - name: POSTGRES_SERVER
              value: "gpuchile-db-dev.co7isg2qyv82.us-east-1.rds.amazonaws.com"
            - name: POSTGRES_PORT
              value: "5432"
            - name: POSTGRES_DB
              value: "gpuchile"

            # Formato gen√©rico DB_*
            - name: DB_USER
              value: "gpuchile_admin"
            - name: DB_PASSWORD
              value: "GpuChile2024!"
            - name: DB_HOST
              value: "gpuchile-db-dev.co7isg2qyv82.us-east-1.rds.amazonaws.com"
            - name: DB_PORT
              value: "5432"
            - name: DB_NAME
              value: "gpuchile"

            # 3. Forzar SSL y URL completa (Por si acaso)
            - name: PGSSLMODE
              value: "require"
            - name: DATABASE_URL
              value: "postgresql://gpuchile_admin:GpuChile2024!@gpuchile-db-dev.co7isg2qyv82.us-east-1.rds.amazonaws.com:5432/gpuchile?sslmode=require"

            # 4. Tus otras variables
            - name: AWS_REGION
              value: "us-east-1"
            - name: S3_BUCKET_NAME
              value: "gpuchile-images-dev-nicolas-2026"
            - name: REDIS_URL
              value: "redis://redis-service.default.svc.cluster.local:6379/0"

          resources:
            limits:
              memory: "512Mi"
              cpu: "500m"
            requests:
              memory: "256Mi"
              cpu: "250m"
          
          readinessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 15
            periodSeconds: 10
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 30
            periodSeconds: 15

########################################
ARCHIVO: .\kubernetes\backend\service-account.yaml
########################################

apiVersion: v1
kind: ServiceAccount
metadata:
  name: gpuchile-backend-sa
  namespace: default
  annotations:
    # Este es el rol que cre√≥ Terraform para permitir acceso a S3 y Secrets
    eks.amazonaws.com/role-arn: "arn:aws:iam::380002980493:role/gpuchile-cluster-gpuchile-backend-sa-role"


########################################
ARCHIVO: .\kubernetes\backend\service.yaml
########################################

apiVersion: v1
kind: Service
metadata:
  name: gpuchile-backend
  namespace: default
spec:
  selector:
    app: backend
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000
  type: ClusterIP

########################################
ARCHIVO: .\kubernetes\external-secrets\external-secret.yaml
########################################

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gpuchile-db-credentials
  namespace: default
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: db-credentials
    creationPolicy: Owner
  data:
    - secretKey: DATABASE_URL
      remoteRef:
        key: gpuchile/dev/db
        property: url
    - secretKey: SECRET_KEY
      remoteRef:
        key: gpuchile/dev/db
        property: jwt_secret


########################################
ARCHIVO: .\kubernetes\external-secrets\namespace.yaml
########################################

apiVersion: v1
kind: Namespace
metadata:
  name: external-secrets


########################################
ARCHIVO: .\kubernetes\external-secrets\secret-store.yaml
########################################

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: default
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: gpuchile-backend-sa  # üëà Usamos la cuenta que creamos hace un momento

########################################
ARCHIVO: .\kubernetes\frontend\configmap.yaml
########################################

apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: default
data:
  default.conf: |
    server {
        listen 80;
        server_name _;
        root /usr/share/nginx/html;
        index index.html;

        # Compresi√≥n Gzip para velocidad
        gzip on;
        gzip_types text/css text/javascript application/javascript application/json image/svg+xml;

        # Cach√© de archivos est√°ticos
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }

        # ‚ö° MAGIA: Redirige /api hacia el Backend interno
        location /api/ {
            # Apunta al servicio 'gpuchile-backend' que creamos antes
            proxy_pass http://gpuchile-backend.default.svc.cluster.local:8000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # React Router (cualquier otra ruta va a index.html)
        location / {
            try_files $uri $uri/ /index.html;
        }
        
        location /health {
            return 200 "healthy\n";
        }
    }

########################################
ARCHIVO: .\kubernetes\frontend\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: gpuchile-frontend
  namespace: default
  labels:
    app: frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
        - name: frontend
          image: 380002980493.dkr.ecr.us-east-1.amazonaws.com/gpuchile-frontend:latest
          imagePullPolicy: Always
          
          env:
            - name: VITE_API_URL
              value: "http://ad519c89537e8443d8b899e35db9d1cd-361311791.us-east-1.elb.amazonaws.com:8000/api"

          # üëá AQU√ç EST√Å LA MAGIA üëá
          command: ["/bin/sh", "-c"]
          args:
            - |
              echo "üîß Iniciando parches..."
              
              # 1. Arreglar el error de UUID (lo que ya ten√≠as)
              find src -name "*.tsx" -o -name "*.ts" | xargs sed -i 's/crypto.randomUUID()/Math.random().toString(36).substring(7)/g'
              
              # 2. NUEVO: Arreglar las Im√°genes (Object Fit)
              # Buscamos el archivo ProductCard.tsx y cambiamos el estilo de la imagen
              # Cambiamos 'object-cover' por 'object-contain' (ajustar), 'h-64' (altura fija) y 'p-4' (relleno)
              find src -name "ProductCard.tsx" -exec sed -i 's/object-cover/object-contain h-64 w-full bg-white p-4/g' {} +
              
              echo "‚úÖ Estilos de imagen corregidos."
              
              # Iniciar la app
              npm run dev -- --host 0.0.0.0 --port 5173

          ports:
            - containerPort: 5173
          
          resources:
            limits:
              memory: "256Mi"
              cpu: "200m"
            requests:
              memory: "128Mi"
              cpu: "100m"
          
          volumeMounts:
            - name: nginx-config-vol
              mountPath: /etc/nginx/conf.d
              readOnly: true
            - name: vite-config-vol
              mountPath: /app/vite.config.js
              subPath: vite.config.js

      volumes:
        - name: nginx-config-vol
          configMap:
            name: nginx-config
        - name: vite-config-vol
          configMap:
            name: vite-extra-config

########################################
ARCHIVO: .\kubernetes\frontend\service.yaml
########################################

apiVersion: v1
kind: Service
metadata:
  name: gpuchile-frontend
  namespace: default
spec:
  selector:
    app: frontend
  ports:
    - protocol: TCP
      port: 80
      targetPort: 5173
  type: LoadBalancer 

########################################
ARCHIVO: .\kubernetes\frontend\vite-config.yaml
########################################

apiVersion: v1
kind: ConfigMap
metadata:
  name: vite-extra-config
  namespace: default
data:
  vite.config.js: |
    import { defineConfig } from 'vite'
    import react from '@vitejs/plugin-react'
    import path from 'path'

    export default defineConfig({
      plugins: [react()],
      // üëá ESTO ES LO QUE FALTABA: Definir que "@" es la carpeta "src"
      resolve: {
        alias: {
          "@": path.resolve(__dirname, "./src"),
        },
      },
      // üëá Mantenemos la configuraci√≥n de red que ya funcion√≥
      server: {
        host: '0.0.0.0',
        port: 5173,
        allowedHosts: true
      }
    })

########################################
ARCHIVO: .\kubernetes\redis\deployment.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis:7-alpine
        ports:
        - containerPort: 6379
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: default
spec:
  type: ClusterIP
  ports:
  - port: 6379
    targetPort: 6379
  selector:
    app: redis


########################################
ARCHIVO: .\kubernetes\redis\redis.yaml
########################################

apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis:7-alpine
        ports:
        - containerPort: 6379
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          tcpSocket:
            port: 6379
          initialDelaySeconds: 10
          periodSeconds: 10
        readinessProbe:
          exec:
            command:
            - redis-cli
            - ping
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: default
spec:
  type: ClusterIP
  ports:
  - port: 6379
    targetPort: 6379
  selector:
    app: redis


########################################
ARCHIVO: .\lambda\image-resizer\Dockerfile
########################################

# Usamos la imagen base de AWS para Python 3.11
FROM public.ecr.aws/lambda/python:3.11

# Copiamos requirements
COPY requirements.txt ${LAMBDA_TASK_ROOT}

# Instalamos dependencias en la carpeta del sistema
RUN pip install -r requirements.txt

# Copiamos el c√≥digo de la funci√≥n
COPY lambda_function.py ${LAMBDA_TASK_ROOT}

# El comando CMD se define en el Terraform o aqu√≠
CMD [ "lambda_function.lambda_handler" ]

########################################
ARCHIVO: .\lambda\image-resizer\requirements.txt
########################################

Pillow>=10.0.0
boto3>=1.26.0


########################################
ARCHIVO: .\scripts\auto_destroy.ps1
########################################

<#
.SYNOPSIS
    Script de seguridad para destruir infraestructura en AWS tras X horas.
    Evita costos accidentales por dejar el laboratorio encendido.
#>

# ‚ö†Ô∏è CONFIGURACI√ìN: Cambia esto seg√∫n tus horas de estudio
$Horas = 4
$Segundos = $Horas * 3600

# Calcular tiempos
$FechaInicio = Get-Date
$FechaFin = $FechaInicio.AddHours($Horas)
$CostoEstimado = $Horas * 0.12 # Costo aprox por hora de EKS + Nodos Spot

Clear-Host
Write-Host "============================================" -ForegroundColor Cyan
Write-Host "   ‚è∞ AUTO-DESTROY DE INFRAESTRUCTURA   " -ForegroundColor Cyan
Write-Host "============================================"
Write-Host "üìç Inicio: $FechaInicio"
Write-Host "üî• DESTRUCCI√ìN PROGRAMADA: $FechaFin"
Write-Host "üí∞ Costo m√°x. estimado sesi√≥n: `$$CostoEstimado USD"
Write-Host ""
Write-Host "‚ö†Ô∏è  IMPORTANTE:" -ForegroundColor Yellow
Write-Host "1. NO cierres esta terminal de VS Code."
Write-Host "2. Si tu PC se suspende, el contador se pausa."
Write-Host "3. Para cancelar, presiona Ctrl+C en esta ventana."
Write-Host "============================================"

# Esperar el tiempo definido
Start-Sleep -Seconds $Segundos

# --- COMIENZA LA DESTRUCCI√ìN ---
Write-Host ""
Write-Host "‚è∞ Tiempo expirado. Iniciando destrucci√≥n..." -ForegroundColor Red

# Navegar a la carpeta terraform relativa a este script
$ScriptPath = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location "$ScriptPath\..\..\terraform"

# Ejecutar Terraform
terraform destroy -auto-approve

if ($LASTEXITCODE -eq 0) {
    Write-Host "‚úÖ Infraestructura destruida exitosamente." -ForegroundColor Green
    Write-Host "üí∞ Ahorro asegurado." -ForegroundColor Green
} else {
    Write-Host "‚ùå Error al destruir. Revisa la consola." -ForegroundColor Red
}

########################################
ARCHIVO: .\scripts\docker\build_and_push.sh
########################################

#!/bin/bash
set -e

# Colores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}üöÄ Build and Push Script para ECR${NC}"

# Variables (ajustar seg√∫n tu cuenta)
AWS_REGION="us-east-1"
AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
BACKEND_REPO="gpuchile-backend"
FRONTEND_REPO="gpuchile-frontend"

# Login a ECR
echo -e "${YELLOW}üìù Login a ECR...${NC}"
aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com

# Build y push Backend
echo -e "${YELLOW}üî® Building backend...${NC}"
cd ../../apps/backend
docker build -t $BACKEND_REPO:latest .
docker tag $BACKEND_REPO:latest $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$BACKEND_REPO:latest
echo -e "${YELLOW}üì§ Pushing backend...${NC}"
docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$BACKEND_REPO:latest

# Build y push Frontend
echo -e "${YELLOW}üî® Building frontend...${NC}"
cd ../frontend
docker build -t $FRONTEND_REPO:latest .
docker tag $FRONTEND_REPO:latest $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$FRONTEND_REPO:latest
echo -e "${YELLOW}üì§ Pushing frontend...${NC}"
docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$FRONTEND_REPO:latest

echo -e "${GREEN}‚úÖ Build and push completed successfully!${NC}"
echo -e "${GREEN}Backend: $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$BACKEND_REPO:latest${NC}"
echo -e "${GREEN}Frontend: $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$FRONTEND_REPO:latest${NC}"


########################################
ARCHIVO: .\terraform\.terraform.lock.hcl
########################################

# This file is maintained automatically by "terraform init".
# Manual edits may be lost in future updates.

provider "registry.terraform.io/hashicorp/archive" {
  version = "2.7.1"
  hashes = [
    "h1:RzToQiFwVaxcV0QmgbyaKgNOhqc6oLKiFyZTrQSGcog=",
    "zh:19881bb356a4a656a865f48aee70c0b8a03c35951b7799b6113883f67f196e8e",
    "zh:2fcfbf6318dd514863268b09bbe19bfc958339c636bcbcc3664b45f2b8bf5cc6",
    "zh:3323ab9a504ce0a115c28e64d0739369fe85151291a2ce480d51ccbb0c381ac5",
    "zh:362674746fb3da3ab9bd4e70c75a3cdd9801a6cf258991102e2c46669cf68e19",
    "zh:7140a46d748fdd12212161445c46bbbf30a3f4586c6ac97dd497f0c2565fe949",
    "zh:78d5eefdd9e494defcb3c68d282b8f96630502cac21d1ea161f53cfe9bb483b3",
    "zh:875e6ce78b10f73b1efc849bfcc7af3a28c83a52f878f503bb22776f71d79521",
    "zh:b872c6ed24e38428d817ebfb214da69ea7eefc2c38e5a774db2ccd58e54d3a22",
    "zh:cd6a44f731c1633ae5d37662af86e7b01ae4c96eb8b04144255824c3f350392d",
    "zh:e0600f5e8da12710b0c52d6df0ba147a5486427c1a2cc78f31eea37a47ee1b07",
    "zh:f21b2e2563bbb1e44e73557bcd6cdbc1ceb369d471049c40eb56cb84b6317a60",
    "zh:f752829eba1cc04a479cf7ae7271526b402e206d5bcf1fcce9f535de5ff9e4e6",
  ]
}

provider "registry.terraform.io/hashicorp/aws" {
  version     = "5.100.0"
  constraints = ">= 4.33.0, >= 4.57.0, >= 5.0.0, ~> 5.0"
  hashes = [
    "h1:H3mU/7URhP0uCRGK8jeQRKxx2XFzEqLiOq/L2Bbiaxs=",
    "zh:054b8dd49f0549c9a7cc27d159e45327b7b65cf404da5e5a20da154b90b8a644",
    "zh:0b97bf8d5e03d15d83cc40b0530a1f84b459354939ba6f135a0086c20ebbe6b2",
    "zh:1589a2266af699cbd5d80737a0fe02e54ec9cf2ca54e7e00ac51c7359056f274",
    "zh:6330766f1d85f01ae6ea90d1b214b8b74cc8c1badc4696b165b36ddd4cc15f7b",
    "zh:7c8c2e30d8e55291b86fcb64bdf6c25489d538688545eb48fd74ad622e5d3862",
    "zh:99b1003bd9bd32ee323544da897148f46a527f622dc3971af63ea3e251596342",
    "zh:9b12af85486a96aedd8d7984b0ff811a4b42e3d88dad1a3fb4c0b580d04fa425",
    "zh:9f8b909d3ec50ade83c8062290378b1ec553edef6a447c56dadc01a99f4eaa93",
    "zh:aaef921ff9aabaf8b1869a86d692ebd24fbd4e12c21205034bb679b9caf883a2",
    "zh:ac882313207aba00dd5a76dbd572a0ddc818bb9cbf5c9d61b28fe30efaec951e",
    "zh:bb64e8aff37becab373a1a0cc1080990785304141af42ed6aa3dd4913b000421",
    "zh:dfe495f6621df5540d9c92ad40b8067376350b005c637ea6efac5dc15028add4",
    "zh:f0ddf0eaf052766cfe09dea8200a946519f653c384ab4336e2a4a64fdd6310e9",
    "zh:f1b7e684f4c7ae1eed272b6de7d2049bb87a0275cb04dbb7cda6636f600699c9",
    "zh:ff461571e3f233699bf690db319dfe46aec75e58726636a0d97dd9ac6e32fb70",
  ]
}

provider "registry.terraform.io/hashicorp/cloudinit" {
  version     = "2.3.7"
  constraints = ">= 2.0.0"
  hashes = [
    "h1:h1Pr6uNwq+iDEGrnQJEHzOTz+yVTW0AJgZrGXuoO4Qs=",
    "zh:06f1c54e919425c3139f8aeb8fcf9bceca7e560d48c9f0c1e3bb0a8ad9d9da1e",
    "zh:0e1e4cf6fd98b019e764c28586a386dc136129fef50af8c7165a067e7e4a31d5",
    "zh:1871f4337c7c57287d4d67396f633d224b8938708b772abfc664d1f80bd67edd",
    "zh:2b9269d91b742a71b2248439d5e9824f0447e6d261bfb86a8a88528609b136d1",
    "zh:3d8ae039af21426072c66d6a59a467d51f2d9189b8198616888c1b7fc42addc7",
    "zh:3ef4e2db5bcf3e2d915921adced43929214e0946a6fb11793085d9a48995ae01",
    "zh:42ae54381147437c83cbb8790cc68935d71b6357728a154109d3220b1beb4dc9",
    "zh:4496b362605ae4cbc9ef7995d102351e2fe311897586ffc7a4a262ccca0c782a",
    "zh:652a2401257a12706d32842f66dac05a735693abcb3e6517d6b5e2573729ba13",
    "zh:7406c30806f5979eaed5f50c548eced2ea18ea121e01801d2f0d4d87a04f6a14",
    "zh:7848429fd5a5bcf35f6fee8487df0fb64b09ec071330f3ff240c0343fe2a5224",
    "zh:78d5eefdd9e494defcb3c68d282b8f96630502cac21d1ea161f53cfe9bb483b3",
  ]
}

provider "registry.terraform.io/hashicorp/helm" {
  version     = "2.17.0"
  constraints = ">= 2.11.0, ~> 2.12"
  hashes = [
    "h1:rsqAO9oKyDMLiysQqrWEzf9CNtU9NJtwEGk7bSItC9g=",
    "zh:06fb4e9932f0afc1904d2279e6e99353c2ddac0d765305ce90519af410706bd4",
    "zh:104eccfc781fc868da3c7fec4385ad14ed183eb985c96331a1a937ac79c2d1a7",
    "zh:129345c82359837bb3f0070ce4891ec232697052f7d5ccf61d43d818912cf5f3",
    "zh:3956187ec239f4045975b35e8c30741f701aa494c386aaa04ebabffe7749f81c",
    "zh:66a9686d92a6b3ec43de3ca3fde60ef3d89fb76259ed3313ca4eb9bb8c13b7dd",
    "zh:88644260090aa621e7e8083585c468c8dd5e09a3c01a432fb05da5c4623af940",
    "zh:a248f650d174a883b32c5b94f9e725f4057e623b00f171936dcdcc840fad0b3e",
    "zh:aa498c1f1ab93be5c8fbf6d48af51dc6ef0f10b2ea88d67bcb9f02d1d80d3930",
    "zh:bf01e0f2ec2468c53596e027d376532a2d30feb72b0b5b810334d043109ae32f",
    "zh:c46fa84cc8388e5ca87eb575a534ebcf68819c5a5724142998b487cb11246654",
    "zh:d0c0f15ffc115c0965cbfe5c81f18c2e114113e7a1e6829f6bfd879ce5744fbb",
    "zh:f569b65999264a9416862bca5cd2a6177d94ccb0424f3a4ef424428912b9cb3c",
  ]
}

provider "registry.terraform.io/hashicorp/kubernetes" {
  version     = "2.38.0"
  constraints = ">= 2.10.0, >= 2.23.0, ~> 2.25"
  hashes = [
    "h1:1OF0rDUteVdoX04BrtmTc0T4NOo6+D0utmK6hM0EzZw=",
    "zh:0af928d776eb269b192dc0ea0f8a3f0f5ec117224cd644bdacdc682300f84ba0",
    "zh:1be998e67206f7cfc4ffe77c01a09ac91ce725de0abaec9030b22c0a832af44f",
    "zh:326803fe5946023687d603f6f1bab24de7af3d426b01d20e51d4e6fbe4e7ec1b",
    "zh:4a99ec8d91193af961de1abb1f824be73df07489301d62e6141a656b3ebfff12",
    "zh:5136e51765d6a0b9e4dbcc3b38821e9736bd2136cf15e9aac11668f22db117d2",
    "zh:63fab47349852d7802fb032e4f2b6a101ee1ce34b62557a9ad0f0f0f5b6ecfdc",
    "zh:924fb0257e2d03e03e2bfe9c7b99aa73c195b1f19412ca09960001bee3c50d15",
    "zh:b63a0be5e233f8f6727c56bed3b61eb9456ca7a8bb29539fba0837f1badf1396",
    "zh:d39861aa21077f1bc899bc53e7233262e530ba8a3a2d737449b100daeb303e4d",
    "zh:de0805e10ebe4c83ce3b728a67f6b0f9d18be32b25146aa89116634df5145ad4",
    "zh:f569b65999264a9416862bca5cd2a6177d94ccb0424f3a4ef424428912b9cb3c",
    "zh:faf23e45f0090eef8ba28a8aac7ec5d4fdf11a36c40a8d286304567d71c1e7db",
  ]
}

provider "registry.terraform.io/hashicorp/random" {
  version     = "3.8.1"
  constraints = "~> 3.5"
  hashes = [
    "h1:osH3aBqEARwOz3VBJKdpFKJJCNIdgRC6k8vPojkLmlY=",
    "zh:08dd03b918c7b55713026037c5400c48af5b9f468f483463321bd18e17b907b4",
    "zh:0eee654a5542dc1d41920bbf2419032d6f0d5625b03bd81339e5b33394a3e0ae",
    "zh:229665ddf060aa0ed315597908483eee5b818a17d09b6417a0f52fd9405c4f57",
    "zh:2469d2e48f28076254a2a3fc327f184914566d9e40c5780b8d96ebf7205f8bc0",
    "zh:37d7eb334d9561f335e748280f5535a384a88675af9a9eac439d4cfd663bcb66",
    "zh:741101426a2f2c52dee37122f0f4a2f2d6af6d852cb1db634480a86398fa3511",
    "zh:78d5eefdd9e494defcb3c68d282b8f96630502cac21d1ea161f53cfe9bb483b3",
    "zh:a902473f08ef8df62cfe6116bd6c157070a93f66622384300de235a533e9d4a9",
    "zh:b85c511a23e57a2147355932b3b6dce2a11e856b941165793a0c3d7578d94d05",
    "zh:c5172226d18eaac95b1daac80172287b69d4ce32750c82ad77fa0768be4ea4b8",
    "zh:dab4434dba34aad569b0bc243c2d3f3ff86dd7740def373f2a49816bd2ff819b",
    "zh:f49fd62aa8c5525a5c17abd51e27ca5e213881d58882fd42fec4a545b53c9699",
  ]
}

provider "registry.terraform.io/hashicorp/time" {
  version     = "0.13.1"
  constraints = ">= 0.9.0"
  hashes = [
    "h1:5l8PAnxPdoUPqNPuv1dAr3efcCCtSCnY+Vj2nSGkQmw=",
    "zh:02cb9aab1002f0f2a94a4f85acec8893297dc75915f7404c165983f720a54b74",
    "zh:04429b2b31a492d19e5ecf999b116d396dac0b24bba0d0fb19ecaefe193fdb8f",
    "zh:26f8e51bb7c275c404ba6028c1b530312066009194db721a8427a7bc5cdbc83a",
    "zh:772ff8dbdbef968651ab3ae76d04afd355c32f8a868d03244db3f8496e462690",
    "zh:78d5eefdd9e494defcb3c68d282b8f96630502cac21d1ea161f53cfe9bb483b3",
    "zh:898db5d2b6bd6ca5457dccb52eedbc7c5b1a71e4a4658381bcbb38cedbbda328",
    "zh:8de913bf09a3fa7bedc29fec18c47c571d0c7a3d0644322c46f3aa648cf30cd8",
    "zh:9402102c86a87bdfe7e501ffbb9c685c32bbcefcfcf897fd7d53df414c36877b",
    "zh:b18b9bb1726bb8cfbefc0a29cf3657c82578001f514bcf4c079839b6776c47f0",
    "zh:b9d31fdc4faecb909d7c5ce41d2479dd0536862a963df434be4b16e8e4edc94d",
    "zh:c951e9f39cca3446c060bd63933ebb89cedde9523904813973fbc3d11863ba75",
    "zh:e5b773c0d07e962291be0e9b413c7a22c044b8c7b58c76e8aa91d1659990dfb5",
  ]
}

provider "registry.terraform.io/hashicorp/tls" {
  version     = "4.2.1"
  constraints = ">= 3.0.0"
  hashes = [
    "h1:4RrYf1s+LL8tozFP2uqJDAakrVqJF4sqZTM5EPQ+Nhg=",
    "zh:0d1e7d07ac973b97fa228f46596c800de830820506ee145626f079dd6bbf8d8a",
    "zh:5c7e3d4348cb4861ab812973ef493814a4b224bdd3e9d534a7c8a7c992382b86",
    "zh:7c6d4a86cd7a4e9c1025c6b3a3a6a45dea202af85d870cddbab455fb1bd568ad",
    "zh:7d0864755ba093664c4b2c07c045d3f5e3d7c799dda1a3ef33d17ed1ac563191",
    "zh:83734f57950ab67c0d6a87babdb3f13c908cbe0a48949333f489698532e1391b",
    "zh:951e3c285218ebca0cf20eaa4265020b4ef042fea9c6ade115ad1558cfe459e5",
    "zh:b9543955b4297e1d93b85900854891c0e645d936d8285a190030475379c5c635",
    "zh:bb1bd9e86c003d08c30c1b00d44118ed5bbbf6b1d2d6f7eaac4fa5c6ebea5933",
    "zh:c9477bfe00653629cd77ddac3968475f7ad93ac3ca8bc45b56d1d9efb25e4a6e",
    "zh:d4cfda8687f736d0cba664c22ec49dae1188289e214ef57f5afe6a7217854fed",
    "zh:dc77ee066cf96532a48f0578c35b1eaf6dc4d8ddd0e3ae8e029a3b10676dd5d3",
    "zh:f569b65999264a9416862bca5cd2a6177d94ccb0424f3a4ef424428912b9cb3c",
  ]
}


########################################
ARCHIVO: .\terraform\backend.tf
########################################

# terraform/backend.tf
terraform {
  backend "s3" {
    # üëá AQU√ç PONES EL NOMBRE EXACTO QUE ACABAS DE CREAR
    bucket         = "gpuchile-terraform-state-nicolas-2026"
    key            = "eks-cluster/terraform.tfstate"
    region         = "us-east-1"
    encrypt        = true
    dynamodb_table = "gpuchile-terraform-locks"
  }
}



########################################
ARCHIVO: .\terraform\main.tf
########################################

# terraform/main.tf

terraform {
  required_version = ">= 1.3.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    random = {
      source  = "hashicorp/random"
      version = "~> 3.5"
    }
    kubernetes = {
      source  = "hashicorp/kubernetes"
      version = ">= 2.23"
    }
    helm = {
      source  = "hashicorp/helm"
      version = ">= 2.11"
    }
  }

  # ‚ùå ELIMINADO: El backend "s3" ya est√° en backend.tf
}

provider "aws" {
  region = var.region
  default_tags {
    tags = {
      Project     = "GpuChile"
      Environment = var.environment
      ManagedBy   = "Terraform"
      Owner       = "NicolasNunez"
    }
  }
}

# Provider Kubernetes
# üõ†Ô∏è CORREGIDO PARA WINDOWS
provider "kubernetes" {
  host                   = module.eks.cluster_endpoint
  cluster_ca_certificate = base64decode(module.eks.cluster_certificate_authority_data)
  
  exec {
    api_version = "client.authentication.k8s.io/v1beta1"
    # üëá RUTA ABSOLUTA A AWS CLI (Esto no puede fallar)
    command     = "C:\\Program Files\\Amazon\\AWSCLIV2\\aws.exe"
    args = [
      "eks",
      "get-token",
      "--cluster-name",
      module.eks.cluster_name
    ]
  }
}

# Provider Helm
# üõ†Ô∏è CORREGIDO: Apuntando directo al ejecutable de AWS
provider "helm" {
  kubernetes {
    host                   = module.eks.cluster_endpoint
    cluster_ca_certificate = base64decode(module.eks.cluster_certificate_authority_data)
    
    exec {
      api_version = "client.authentication.k8s.io/v1beta1"
      # üëá LO MISMO AQU√ç
      command     = "C:\\Program Files\\Amazon\\AWSCLIV2\\aws.exe"
      args = [
        "eks",
        "get-token",
        "--cluster-name",
        module.eks.cluster_name
      ]
    }
  }
}

# 1. VPC
module "vpc" {
  source = "./modules/vpc"

  vpc_cidr     = var.vpc_cidr
  environment  = var.environment
  cluster_name = var.cluster_name
}

# 2. EKS
module "eks" {
  source = "./modules/eks"

  cluster_name = var.cluster_name
  vpc_id       = module.vpc.vpc_id
  subnet_ids   = module.vpc.public_subnets
  environment  = var.environment
}

# 3. RDS
module "rds" {
  source = "./modules/rds"

  environment               = var.environment
  vpc_id                    = module.vpc.vpc_id
  subnet_ids                = module.vpc.public_subnets
  allowed_security_group_id = module.eks.cluster_security_group_id
}

# 4. S3
module "s3" {
  source = "./modules/s3"

  environment = var.environment
  bucket_name = "gpuchile-images-${var.environment}-nicolas-2026"
}

# 5. Lambda
module "lambda" {
  source = "./modules/lambda"

  environment      = var.environment
  s3_bucket_name   = module.s3.bucket_name
  s3_bucket_arn    = module.s3.bucket_arn
}

# 6. Secretos Adicionales (JWT, Redis)
module "secrets" {
  source = "./modules/secrets"

  environment = var.environment
}

# 7. IRSA Role para el Backend
module "backend_irsa" {
  source = "./modules/irsa"

  cluster_name         = var.cluster_name
  oidc_provider_arn    = module.eks.oidc_provider_arn
  namespace            = "default"
  service_account_name = "gpuchile-backend-sa"
  s3_bucket_arn        = module.s3.bucket_arn
  
  secrets_arns = [
    module.rds.db_secret_arn,
    module.secrets.jwt_secret_arn,
    module.secrets.redis_secret_arn
  ]
}

# 8. ECR (Comentado porque ya existe)
# module "ecr" { ... }

# 9. Monitoring
#module "monitoring" {
#  source = "./modules/monitoring"

#  cluster_name      = module.eks.cluster_name
#  oidc_provider_arn = module.eks.oidc_provider_arn
#  namespace         = "monitoring"
  
#  depends_on = [ module.eks ]
#}

# 10. Helm Controllers (Comentado temporalmente para fase 1, o descom√©ntalo si Monitoring funciona)

module "helm_controllers" {
  source = "./modules/helm-controllers"

  cluster_name      = module.eks.cluster_name 
  aws_region        = var.region
  vpc_id            = module.vpc.vpc_id
  oidc_provider_arn = module.eks.oidc_provider_arn
  
  tags = {
    Environment = var.environment
    Project     = "GpuChile"
  }

  depends_on = [
    module.eks
  ]
}


########################################
ARCHIVO: .\terraform\outputs.tf
########################################

# terraform/outputs.tf

output "vpc_id" {
  value = module.vpc.vpc_id
}

output "eks_cluster_endpoint" {
  value = module.eks.cluster_endpoint
}

output "eks_cluster_name" {
  value = module.eks.cluster_name
}

output "rds_endpoint" {
  value = module.rds.db_instance_endpoint
}

output "s3_bucket_name" {
  value = module.s3.bucket_name
}

output "lambda_function_name" {
  value = module.lambda.lambda_function_name
}

output "backend_service_account_role_arn" {
  description = "ARN del IAM Role para el backend Service Account"
  value       = module.backend_irsa.role_arn
}

output "jwt_secret_arn" {
  value = module.secrets.jwt_secret_arn
}

#output "ecr_repositories" {
#  description = "URLs de los repositorios ECR"
#  value       = module.ecr.repository_urls
#}

#output "prometheus_role_arn" {
 # value = module.monitoring.prometheus_role_arn
#}


########################################
ARCHIVO: .\terraform\variables.tf
########################################

# terraform/variables.tf

variable "region" {
  description = "Regi√≥n de AWS"
  type        = string
  default     = "us-east-1"
}

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
  default     = "dev"
}

variable "vpc_cidr" {
  description = "CIDR block para la VPC"
  type        = string
  default     = "10.0.0.0/16"
}

variable "cluster_name" {
  description = "Nombre del cluster EKS"
  type        = string
  default     = "gpuchile-cluster"
}

########################################
ARCHIVO: .\terraform\modules\ecr\main.tf
########################################

resource "aws_ecr_repository" "repos" {
  for_each = toset(var.repositories)

  name                 = each.value
  image_tag_mutability = "MUTABLE"

  image_scanning_configuration {
    scan_on_push = true # Escaneo de seguridad autom√°tico (Trivy)
  }

  encryption_configuration {
    encryption_type = "AES256"
  }

  tags = {
    Name        = each.value
    Environment = var.environment
  }
}

# Pol√≠tica de ciclo de vida (Retener solo √∫ltimas 10 im√°genes)
resource "aws_ecr_lifecycle_policy" "cleanup" {
  for_each   = aws_ecr_repository.repos
  repository = each.value.name

  policy = jsonencode({
    rules = [
      {
        rulePriority = 1
        description  = "Keep last 10 images"
        selection = {
          tagStatus   = "any"
          countType   = "imageCountMoreThan"
          countNumber = 10
        }
        action = {
          type = "expire"
        }
      }
    ]
  })
}


########################################
ARCHIVO: .\terraform\modules\ecr\outputs.tf
########################################

output "repository_urls" {
  description = "Map de nombres a URLs de los repositorios ECR"
  value = {
    for name, repo in aws_ecr_repository.repos :
    name => repo.repository_url
  }
}

output "repository_arns" {
  description = "Map de nombres a ARNs de los repositorios"
  value = {
    for name, repo in aws_ecr_repository.repos :
    name => repo.arn
  }
}


########################################
ARCHIVO: .\terraform\modules\ecr\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
}

variable "repositories" {
  description = "Lista de nombres de repositorios ECR"
  type        = list(string)
  default     = ["gpuchile-backend", "gpuchile-frontend"]
}


########################################
ARCHIVO: .\terraform\modules\eks\main.tf
########################################

module "eks" {
  source  = "terraform-aws-modules/eks/aws"
  version = "~> 19.0"

  cluster_name    = var.cluster_name
  cluster_version = var.cluster_version

  # üåê RED: Cluster p√∫blico (Accesso API Server)
  cluster_endpoint_public_access = true

  vpc_id                   = var.vpc_id
  subnet_ids               = var.subnet_ids
  control_plane_subnet_ids = var.subnet_ids

  # üõ°Ô∏è SEGURIDAD: OIDC Provider (Vital para IRSA - Roles de Service Accounts)
  enable_irsa = true

  # üí∞ NODOS (WORKERS)
  eks_managed_node_groups = {
    spot_nodes_v2 = {
      min_size     = var.min_size
      max_size     = var.max_size
      desired_size = var.desired_size

      instance_types = var.node_instance_types
      capacity_type  = "ON_DEMAND"

      # Importante: Nodos en subnets p√∫blicas necesitan IP p√∫blica si no hay NAT Gateway
      associate_public_ip_address = true

      # Labels √∫tiles para selectores en K8s
      labels = {
        Environment = var.environment
        NodeType    = "spot"
      }
    }
  }

  tags = {
    Environment = var.environment
    Terraform   = "true"
    Project     = "GpuChile"
  }
}


########################################
ARCHIVO: .\terraform\modules\eks\outputs.tf
########################################

output "cluster_endpoint" {
  description = "Endpoint for EKS control plane"
  value       = module.eks.cluster_endpoint
}

output "cluster_security_group_id" {
  description = "Security group ids attached to the cluster control plane"
  value       = module.eks.cluster_security_group_id
}

output "cluster_name" {
  description = "Kubernetes Cluster Name"
  value       = module.eks.cluster_name
}

output "oidc_provider_arn" {
  description = "The ARN of the OIDC Provider if enable_irsa = true"
  value       = module.eks.oidc_provider_arn
}

output "cluster_certificate_authority_data" {
  description = "Nested attribute containing certificate-authority-data for your cluster"
  value       = module.eks.cluster_certificate_authority_data
}


########################################
ARCHIVO: .\terraform\modules\eks\variables.tf
########################################

variable "cluster_name" {
  description = "Nombre del cluster EKS"
  type        = string
}

variable "vpc_id" {
  description = "ID de la VPC donde se desplegar√° el cluster"
  type        = string
}

variable "subnet_ids" {
  description = "Lista de IDs de subnets para los nodos y el control plane"
  type        = list(string)
}

variable "environment" {
  description = "Entorno (dev, prod, etc.)"
  type        = string
  default     = "dev"
}

variable "cluster_version" {
  description = "Versi√≥n de Kubernetes"
  type        = string
  default     = "1.29"
}

variable "node_instance_types" {
  description = "Tipos de instancia para los nodos trabajadores"
  type        = list(string)
  default     = ["t3.medium"]
}

variable "min_size" {
  description = "N√∫mero m√≠nimo de nodos"
  type        = number
  default     = 1
}

variable "max_size" {
  description = "N√∫mero m√°ximo de nodos"
  type        = number
  default     = 2
}

variable "desired_size" {
  description = "N√∫mero deseado de nodos iniciales"
  type        = number
  default     = 1
}


########################################
ARCHIVO: .\terraform\modules\helm-controllers\main.tf
########################################

# =============================================================================
# M√≥dulo: Helm Controllers Essentials
# Instala AWS LB Controller y External Secrets Operator con IRSA
# =============================================================================

terraform {
  required_providers {
    helm = {
      source  = "hashicorp/helm"
      version = "~> 2.12"
    }
    kubernetes = {
      source  = "hashicorp/kubernetes"
      version = "~> 2.25"
    }
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# -----------------------------------------------------------------------------
# Data Sources
# -----------------------------------------------------------------------------

data "aws_caller_identity" "current" {}

data "aws_eks_cluster" "cluster" {
  name = var.cluster_name
}

data "aws_eks_cluster_auth" "cluster" {
  name = var.cluster_name
}

# -----------------------------------------------------------------------------
# 1. AWS Load Balancer Controller
# -----------------------------------------------------------------------------

# IAM Policy para el LB Controller
resource "aws_iam_policy" "aws_lb_controller" {
  name        = "${var.cluster_name}-aws-lb-controller-policy"
  description = "IAM policy for AWS Load Balancer Controller"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "iam:CreateServiceLinkedRole"
        ]
        Resource = "*"
        Condition = {
          StringEquals = {
            "iam:AWSServiceName" = "elasticloadbalancing.amazonaws.com"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:DescribeAccountAttributes",
          "ec2:DescribeAddresses",
          "ec2:DescribeAvailabilityZones",
          "ec2:DescribeInternetGateways",
          "ec2:DescribeVpcs",
          "ec2:DescribeVpcPeeringConnections",
          "ec2:DescribeSubnets",
          "ec2:DescribeSecurityGroups",
          "ec2:DescribeInstances",
          "ec2:DescribeNetworkInterfaces",
          "ec2:DescribeTags",
          "ec2:GetCoipPoolUsage",
          "ec2:DescribeCoipPools",
          "elasticloadbalancing:DescribeLoadBalancers",
          "elasticloadbalancing:DescribeLoadBalancerAttributes",
          "elasticloadbalancing:DescribeListeners",
          "elasticloadbalancing:DescribeListenerCertificates",
          "elasticloadbalancing:DescribeSSLPolicies",
          "elasticloadbalancing:DescribeRules",
          "elasticloadbalancing:DescribeTargetGroups",
          "elasticloadbalancing:DescribeTargetGroupAttributes",
          "elasticloadbalancing:DescribeTargetHealth",
          "elasticloadbalancing:DescribeTags"
        ]
        Resource = "*"
      },
      {
        Effect = "Allow"
        Action = [
          "cognito-idp:DescribeUserPoolClient",
          "acm:ListCertificates",
          "acm:DescribeCertificate",
          "iam:ListServerCertificates",
          "iam:GetServerCertificate",
          "waf-regional:GetWebACL",
          "waf-regional:GetWebACLForResource",
          "waf-regional:AssociateWebACL",
          "waf-regional:DisassociateWebACL",
          "wafv2:GetWebACL",
          "wafv2:GetWebACLForResource",
          "wafv2:AssociateWebACL",
          "wafv2:DisassociateWebACL",
          "shield:GetSubscriptionState",
          "shield:DescribeProtection",
          "shield:CreateProtection",
          "shield:DeleteProtection"
        ]
        Resource = "*"
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:AuthorizeSecurityGroupIngress",
          "ec2:RevokeSecurityGroupIngress"
        ]
        Resource = "*"
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:CreateSecurityGroup"
        ]
        Resource = "*"
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:CreateTags"
        ]
        Resource = "arn:aws:ec2:*:*:security-group/*"
        Condition = {
          StringEquals = {
            "ec2:CreateAction" = "CreateSecurityGroup"
          }
          Null = {
            "aws:RequestTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:CreateTags",
          "ec2:DeleteTags"
        ]
        Resource = "arn:aws:ec2:*:*:security-group/*"
        Condition = {
          Null = {
            "aws:RequestTag/elbv2.k8s.aws/cluster"  = "true"
            "aws:ResourceTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "ec2:AuthorizeSecurityGroupIngress",
          "ec2:RevokeSecurityGroupIngress",
          "ec2:DeleteSecurityGroup"
        ]
        Resource = "*"
        Condition = {
          Null = {
            "aws:ResourceTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:CreateLoadBalancer",
          "elasticloadbalancing:CreateTargetGroup"
        ]
        Resource = "*"
        Condition = {
          Null = {
            "aws:RequestTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:CreateListener",
          "elasticloadbalancing:DeleteListener",
          "elasticloadbalancing:CreateRule",
          "elasticloadbalancing:DeleteRule"
        ]
        Resource = "*"
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:AddTags",
          "elasticloadbalancing:RemoveTags"
        ]
        Resource = [
          "arn:aws:elasticloadbalancing:*:*:targetgroup/*/*",
          "arn:aws:elasticloadbalancing:*:*:loadbalancer/net/*/*",
          "arn:aws:elasticloadbalancing:*:*:loadbalancer/app/*/*"
        ]
        Condition = {
          Null = {
            "aws:RequestTag/elbv2.k8s.aws/cluster"  = "true"
            "aws:ResourceTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:AddTags",
          "elasticloadbalancing:RemoveTags"
        ]
        Resource = [
          "arn:aws:elasticloadbalancing:*:*:listener/net/*/*/*",
          "arn:aws:elasticloadbalancing:*:*:listener/app/*/*/*",
          "arn:aws:elasticloadbalancing:*:*:listener-rule/net/*/*/*",
          "arn:aws:elasticloadbalancing:*:*:listener-rule/app/*/*/*"
        ]
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:ModifyLoadBalancerAttributes",
          "elasticloadbalancing:SetIpAddressType",
          "elasticloadbalancing:SetSecurityGroups",
          "elasticloadbalancing:SetSubnets",
          "elasticloadbalancing:DeleteLoadBalancer",
          "elasticloadbalancing:ModifyTargetGroup",
          "elasticloadbalancing:ModifyTargetGroupAttributes",
          "elasticloadbalancing:DeleteTargetGroup"
        ]
        Resource = "*"
        Condition = {
          Null = {
            "aws:ResourceTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:AddTags"
        ]
        Resource = [
          "arn:aws:elasticloadbalancing:*:*:targetgroup/*/*",
          "arn:aws:elasticloadbalancing:*:*:loadbalancer/net/*/*",
          "arn:aws:elasticloadbalancing:*:*:loadbalancer/app/*/*"
        ]
        Condition = {
          StringEquals = {
            "elasticloadbalancing:CreateAction" = [
              "CreateTargetGroup",
              "CreateLoadBalancer"
            ]
          }
          Null = {
            "aws:RequestTag/elbv2.k8s.aws/cluster" = "false"
          }
        }
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:RegisterTargets",
          "elasticloadbalancing:DeregisterTargets"
        ]
        Resource = "arn:aws:elasticloadbalancing:*:*:targetgroup/*/*"
      },
      {
        Effect = "Allow"
        Action = [
          "elasticloadbalancing:SetWebAcl",
          "elasticloadbalancing:ModifyListener",
          "elasticloadbalancing:AddListenerCertificates",
          "elasticloadbalancing:RemoveListenerCertificates",
          "elasticloadbalancing:ModifyRule"
        ]
        Resource = "*"
      }
    ]
  })

  tags = var.tags
}

# IRSA Role para LB Controller
module "aws_lb_controller_irsa" {
  source  = "terraform-aws-modules/iam/aws//modules/iam-role-for-service-accounts-eks"
  version = "~> 5.34"

  role_name = "${var.cluster_name}-aws-lb-controller"

  attach_load_balancer_controller_policy = true

  oidc_providers = {
    main = {
      provider_arn               = var.oidc_provider_arn
      namespace_service_accounts = ["kube-system:aws-load-balancer-controller"]
    }
  }

  tags = var.tags
}

# Helm Release: AWS Load Balancer Controller
resource "helm_release" "aws_lb_controller" {
  name       = "aws-load-balancer-controller"
  repository = "https://aws.github.io/eks-charts"
  chart      = "aws-load-balancer-controller"
  version    = "1.7.1" # Check latest: https://github.com/aws/eks-charts
  namespace  = "kube-system"

  set {
    name  = "clusterName"
    value = var.cluster_name
  }

  set {
    name  = "serviceAccount.create"
    value = "true"
  }

  set {
    name  = "serviceAccount.name"
    value = "aws-load-balancer-controller"
  }

  set {
    name  = "serviceAccount.annotations.eks\\.amazonaws\\.com/role-arn"
    value = module.aws_lb_controller_irsa.iam_role_arn
  }

  set {
    name  = "region"
    value = var.aws_region
  }

  set {
    name  = "vpcId"
    value = var.vpc_id
  }

  # Evitar conflictos con el default Ingress Controller de AWS
  set {
    name  = "enableShield"
    value = "false"
  }

  set {
    name  = "enableWaf"
    value = "false"
  }

  set {
    name  = "enableWafv2"
    value = "false"
  }

  depends_on = [
    module.aws_lb_controller_irsa
  ]
}

# -----------------------------------------------------------------------------
# 2. External Secrets Operator (ESO)
# -----------------------------------------------------------------------------

# IAM Policy para ESO (acceso a Secrets Manager)
resource "aws_iam_policy" "external_secrets" {
  name        = "${var.cluster_name}-external-secrets-policy"
  description = "IAM policy for External Secrets Operator to access Secrets Manager"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "secretsmanager:GetResourcePolicy",
          "secretsmanager:GetSecretValue",
          "secretsmanager:DescribeSecret",
          "secretsmanager:ListSecretVersionIds"
        ]
        Resource = "arn:aws:secretsmanager:${var.aws_region}:${data.aws_caller_identity.current.account_id}:secret:${var.cluster_name}/*"
      },
      {
        Effect = "Allow"
        Action = [
          "secretsmanager:ListSecrets"
        ]
        Resource = "*"
      }
    ]
  })

  tags = var.tags
}

# IRSA Role para ESO
module "external_secrets_irsa" {
  source  = "terraform-aws-modules/iam/aws//modules/iam-role-for-service-accounts-eks"
  version = "~> 5.34"

  role_name = "${var.cluster_name}-external-secrets"

  role_policy_arns = {
    policy = aws_iam_policy.external_secrets.arn
  }

  oidc_providers = {
    main = {
      provider_arn               = var.oidc_provider_arn
      namespace_service_accounts = ["external-secrets:external-secrets"]
    }
  }

  tags = var.tags
}

# Namespace para ESO
resource "kubernetes_namespace" "external_secrets" {
  metadata {
    name = "external-secrets"
    labels = {
      name = "external-secrets"
    }
  }
}

# Helm Release: External Secrets Operator
resource "helm_release" "external_secrets" {
  name       = "external-secrets"
  repository = "https://charts.external-secrets.io"
  chart      = "external-secrets"
  version    = "0.9.13" # Check latest: https://github.com/external-secrets/external-secrets
  namespace  = kubernetes_namespace.external_secrets.metadata[0].name

  set {
    name  = "installCRDs"
    value = "true"
  }

  set {
    name  = "serviceAccount.annotations.eks\\.amazonaws\\.com/role-arn"
    value = module.external_secrets_irsa.iam_role_arn
  }

  # Recursos m√≠nimos para cost optimization
  set {
    name  = "resources.requests.cpu"
    value = "50m"
  }

  set {
    name  = "resources.requests.memory"
    value = "128Mi"
  }

  set {
    name  = "resources.limits.cpu"
    value = "200m"
  }

  set {
    name  = "resources.limits.memory"
    value = "256Mi"
  }

  depends_on = [
    kubernetes_namespace.external_secrets,
    module.external_secrets_irsa
  ]
}

# SecretStore global (apunta a AWS Secrets Manager)

resource "kubernetes_manifest" "secret_store" {
  manifest = {
    apiVersion = "external-secrets.io/v1beta1"
    kind       = "ClusterSecretStore"
    metadata = {
      name = "aws-secrets-manager"
    }
    spec = {
      provider = {
        aws = {
          service = "SecretsManager"
          region  = var.aws_region
          auth = {
            jwt = {
              serviceAccountRef = {
                name      = "external-secrets"
                namespace = "external-secrets"
              }
            }
          }
        }
      }
    }
  }
}


########################################
ARCHIVO: .\terraform\modules\helm-controllers\outputs.tf
########################################

output "aws_lb_controller_role_arn" {
  value = module.aws_lb_controller_irsa.iam_role_arn
}

########################################
ARCHIVO: .\terraform\modules\helm-controllers\variables.tf
########################################

variable "cluster_name" { type = string }
variable "aws_region" { type = string }
variable "vpc_id" { type = string }
variable "oidc_provider_arn" { type = string }
variable "tags" { type = map(string) }

########################################
ARCHIVO: .\terraform\modules\irsa\main.tf
########################################

# Extraer el OIDC Provider ID del ARN
locals {
  oidc_provider_id = replace(var.oidc_provider_arn, "/^(.*provider/)/", "")
}

# IAM Role para el Service Account
resource "aws_iam_role" "service_account" {
  name = "${var.cluster_name}-${var.service_account_name}-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Principal = {
          Federated = var.oidc_provider_arn
        }
        Action = "sts:AssumeRoleWithWebIdentity"
        Condition = {
          StringEquals = {
            "${local.oidc_provider_id}:sub" = "system:serviceaccount:${var.namespace}:${var.service_account_name}"
            "${local.oidc_provider_id}:aud" = "sts.amazonaws.com"
          }
        }
      }
    ]
  })

  tags = {
    Name = "${var.cluster_name}-${var.service_account_name}"
  }
}

# Policy: Acceso a S3 (Subir/Leer im√°genes)
resource "aws_iam_role_policy" "s3_access" {
  name = "s3-access"
  role = aws_iam_role.service_account.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "s3:GetObject",
          "s3:PutObject",
          "s3:DeleteObject",
          "s3:ListBucket"
        ]
        Resource = [
          var.s3_bucket_arn,
          "${var.s3_bucket_arn}/*"
        ]
      }
    ]
  })
}

# Policy: Acceso a Secrets Manager (Leer credenciales)
resource "aws_iam_role_policy" "secrets_access" {
  name = "secrets-access"
  role = aws_iam_role.service_account.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "secretsmanager:GetSecretValue",
          "secretsmanager:DescribeSecret"
        ]
        Resource = var.secrets_arns
      }
    ]
  })
}


########################################
ARCHIVO: .\terraform\modules\irsa\outputs.tf
########################################

output "role_arn" {
  description = "ARN del IAM Role para el Service Account"
  value       = aws_iam_role.service_account.arn
}

output "role_name" {
  description = "Nombre del IAM Role"
  value       = aws_iam_role.service_account.name
}


########################################
ARCHIVO: .\terraform\modules\irsa\variables.tf
########################################

variable "cluster_name" {
  description = "Nombre del cluster EKS"
  type        = string
}

variable "oidc_provider_arn" {
  description = "ARN del OIDC provider del cluster EKS"
  type        = string
}

variable "namespace" {
  description = "Namespace de Kubernetes donde correr√° la app"
  type        = string
  default     = "default"
}

variable "service_account_name" {
  description = "Nombre del Service Account en K8s"
  type        = string
}

variable "s3_bucket_arn" {
  description = "ARN del bucket S3 para permisos"
  type        = string
}

variable "secrets_arns" {
  description = "Lista de ARNs de secretos en Secrets Manager"
  type        = list(string)
}


########################################
ARCHIVO: .\terraform\modules\lambda\lambda_function.zip
########################################

PK     !            
   DockerfiletMJAs"q›ò(	AD$t$
4Gr#b2lÏ¢∫<qbI!aKgqUyv7FR+Q«û&À≥.Œ´6<V
lP_~IEH|,G7r1+IUÕæ)6&mdV"6–ÇDULl(&'x⁄ØO!k^kk¬™B{h‘§-[
Y0
^s,7ƒ¨1hÂÇÅmw5WtKN
Y9t  PK~    PK     !               lambda_function.pyUnF;RZ eukY$_*∆ê+“±lCEoE >ﬂ§OG(dJq@ovfxpp/?Wn
#xFBs)x>!A02{xox	C6∑ü°{ =w0Q<IHAX$h]J.0=	8qg‹Ét&18])nH.R–ï"I–æjyKe F6O\Jf0<;’ªZ.TQiZÒ∫êÜ>G8IbkBJ@,P!Hrtqn5ECY5(%Âê≠Õµ nM zF!)"Q
-!PF<!*t F7œìxespA
rFJi66gSu6e'0#6"K"2SXb,hf2+FcÿÑ6~Õµ6^lr≈Öq9I|^L3m+#bmxl-YXN{['j‘≤Q%N1F`>ËñórKJ|e-g	U{2'p/
È≥Å#Zf"FY?~>
≈©Pf
NX⁄©(Yg[^&#.as
u0
0\$J"0cn<:ra}SMPe…¥Qrx^e<iL[|J5}&.H|DJP38(;RASwx<uWc_5
w4fyEw.
qA«§S&Gu’áZoxCNB,Ug_{ÃÖ,/\#
(NMZ|A+6b?JjO(O1p’∞ÿì#|l}kuÀãowDoxowlvL	Lr;N]fg::Áî∞]7*,ÁòêzqdV«∞'E"4’µZ/G4
)7+5TPn6kjlox‰öÄ
  PK:X    PK     !               requirements.txt
/5433J/7532q  PKh#      PK     !~    
               DockerfilePK     !:X               L  lambda_function.pyPK     !h#                   requirements.txtPK         E    

########################################
ARCHIVO: .\terraform\modules\lambda\main.tf
########################################

# IAM Role para Lambda
resource "aws_iam_role" "lambda" {
  name = "${var.function_name}-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [{
      Action = "sts:AssumeRole"
      Effect = "Allow"
      Principal = {
        Service = "lambda.amazonaws.com"
      }
    }]
  })
}

# Policy para logs CloudWatch
resource "aws_iam_role_policy_attachment" "lambda_logs" {
  role       = aws_iam_role.lambda.name
  policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
}

# Policy para acceso a S3
resource "aws_iam_role_policy" "lambda_s3" {
  name = "lambda-s3-access"
  role = aws_iam_role.lambda.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "s3:GetObject",
          "s3:PutObject"
        ]
        Resource = "${var.s3_bucket_arn}/*"
      }
    ]
  })
}

# Archivar el c√≥digo de Lambda (tu lambda_function.py)
data "archive_file" "lambda_zip" {
  type = "zip"
  # ‚ö†Ô∏è Aseg√∫rate que esta ruta coincida con tu carpeta real
  source_dir  = "${path.root}/../lambda/image-resizer"
  output_path = "${path.module}/lambda_function.zip"
}

# Funci√≥n Lambda
resource "aws_lambda_function" "resizer" {
  filename      = data.archive_file.lambda_zip.output_path
  function_name = var.function_name
  role          = aws_iam_role.lambda.arn
  handler       = "lambda_function.lambda_handler"

  source_code_hash = data.archive_file.lambda_zip.output_base64sha256

  runtime     = "python3.11"
  timeout     = 30
  memory_size = 512

  # üëá LA MAGIA: Layer p√∫blica que contiene Pillow (PIL) para Python 3.11 en us-east-1
  #layers = ["arn:aws:lambda:us-east-1:770693421928:layer:Klayers-p311-Pillow:4"] 
  # (Si falla la v4, intenta borrar la l√≠nea layers temporalmente si no es cr√≠tica la funci√≥n de im√°genes).


  environment {
    variables = {
      ENVIRONMENT = var.environment
    }
  }

  tags = {
    Environment = var.environment
  }
}

# Permiso para que S3 invoque la Lambda
resource "aws_lambda_permission" "allow_s3" {
  statement_id  = "AllowS3Invoke"
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.resizer.function_name
  principal     = "s3.amazonaws.com"
  source_arn    = var.s3_bucket_arn
}

# Trigger S3 -> Lambda (cuando se sube a /original/)
resource "aws_s3_bucket_notification" "lambda_trigger" {
  bucket = var.s3_bucket_name

  lambda_function {
    lambda_function_arn = aws_lambda_function.resizer.arn
    events              = ["s3:ObjectCreated:*"]
    filter_prefix       = "original/"
  }

  depends_on = [aws_lambda_permission.allow_s3]
}

########################################
ARCHIVO: .\terraform\modules\lambda\outputs.tf
########################################

output "lambda_function_arn" {
  description = "ARN de la funci√≥n Lambda"
  value       = aws_lambda_function.resizer.arn
}

output "lambda_function_name" {
  description = "Nombre de la funci√≥n Lambda"
  value       = aws_lambda_function.resizer.function_name
}


########################################
ARCHIVO: .\terraform\modules\lambda\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
}

variable "s3_bucket_name" {
  description = "Nombre del bucket S3 que disparar√° la Lambda"
  type        = string
}

variable "s3_bucket_arn" {
  description = "ARN del bucket S3"
  type        = string
}

variable "function_name" {
  description = "Nombre de la funci√≥n Lambda"
  type        = string
  default     = "gpuchile-image-resizer"
}


########################################
ARCHIVO: .\terraform\modules\monitoring\main.tf
########################################

# 1. Extraer OIDC Provider ID
locals {
  oidc_provider_id = replace(var.oidc_provider_arn, "/^(.*provider/)/", "")
}

# 2. IAM Role para Prometheus
resource "aws_iam_role" "prometheus" {
  name = "${var.cluster_name}-prometheus-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect    = "Allow"
        Principal = { Federated = var.oidc_provider_arn }
        Action    = "sts:AssumeRoleWithWebIdentity"
        Condition = {
          StringEquals = {
            "${local.oidc_provider_id}:sub" = "system:serviceaccount:${var.namespace}:prometheus-stack-kube-prom-prometheus"
            "${local.oidc_provider_id}:aud" = "sts.amazonaws.com"
          }
        }
      }
    ]
  })
}

# 3. Policy CloudWatch
resource "aws_iam_role_policy" "prometheus_cloudwatch" {
  name = "cloudwatch-access"
  role = aws_iam_role.prometheus.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect   = "Allow"
        Action   = ["cloudwatch:GetMetricStatistics", "cloudwatch:ListMetrics"]
        Resource = "*"
      }
    ]
  })
}

# 4. Instalaci√≥n de Prometheus con Helm (ESTILO YAML)
resource "helm_release" "kube_prometheus_stack" {
  name             = "prometheus-stack"
  repository       = "https://prometheus-community.github.io/helm-charts"
  chart            = "kube-prometheus-stack"
  namespace        = var.namespace
  create_namespace = true
  timeout = 900   # 900 segundos = 15 minutos
  wait    = true

  # ‚ö†Ô∏è AQU√ç EST√Å EL CAMBIO M√ÅGICO
  # En lugar de usar 'set {}', usamos 'values' con YAML.
  # Esto evita el error de "Unsupported block type".
  values = [
    yamlencode({
      grafana = {
        adminPassword = "admin123"
      }
      prometheus = {
        prometheusSpec = {
          resources = {
            requests = { memory = "256Mi" }
            limits   = { memory = "512Mi" }
          }
          serviceAccount = {
            annotations = {
              "eks.amazonaws.com/role-arn" = aws_iam_role.prometheus.arn
            }
          }
        }
      }
    })
  ]
}

########################################
ARCHIVO: .\terraform\modules\monitoring\outputs.tf
########################################

output "prometheus_role_arn" {
  description = "ARN del IAM Role para Prometheus"
  value       = aws_iam_role.prometheus.arn
}

output "namespace" {
  value = var.namespace
}


########################################
ARCHIVO: .\terraform\modules\monitoring\variables.tf
########################################

variable "cluster_name" {
  description = "Nombre del cluster EKS"
  type        = string
}

variable "oidc_provider_arn" {
  description = "ARN del OIDC provider"
  type        = string
}

variable "namespace" {
  description = "Namespace para Prometheus"
  type        = string
  default     = "monitoring"
}


########################################
ARCHIVO: .\terraform\modules\monitoring\versions.tf
########################################

terraform {
  required_providers {
    helm = {
      source  = "hashicorp/helm"
      version = ">= 2.11"
    }
  }
}

########################################
ARCHIVO: .\terraform\modules\rds\main.tf
########################################

# Generar password aleatorio (se guarda en Terraform State)
resource "random_password" "db_password" {
  length  = 24
  special = true
}

# Security Group para RDS
resource "aws_security_group" "rds" {
  name        = "gpuchile-rds-${var.environment}"
  description = "Security group for RDS PostgreSQL"
  vpc_id      = var.vpc_id

  ingress {
    description     = "PostgreSQL from EKS"
    from_port       = 5432
    to_port         = 5432
    protocol        = "tcp"
    security_groups = [var.allowed_security_group_id]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name        = "gpuchile-rds-sg"
    Environment = var.environment
  }
}

# Subnet Group (RDS necesita al menos 2 AZs)
resource "aws_db_subnet_group" "main" {
  name       = "gpuchile-db-subnet-${var.environment}"
  subnet_ids = var.subnet_ids

  tags = {
    Name = "GpuChile DB Subnet Group"
  }
}

# RDS Instance
resource "aws_db_instance" "postgres" {
  identifier     = "gpuchile-db-${var.environment}"
  engine         = "postgres"
  engine_version = "16.3"
  instance_class = var.instance_class

  allocated_storage     = var.allocated_storage
  max_allocated_storage = 50 # Autoscaling hasta 50GB

  db_name  = var.db_name
  username = var.db_username
  password = random_password.db_password.result

  db_subnet_group_name   = aws_db_subnet_group.main.name
  vpc_security_group_ids = [aws_security_group.rds.id]

  # ‚ö†Ô∏è COST SAVING: Single-AZ (Multi-AZ duplica el costo)
  multi_az                = false
  publicly_accessible     = false
  skip_final_snapshot     = true # Para dev/portfolio (En prod: false)
  backup_retention_period = 7

  tags = {
    Name        = "gpuchile-postgres"
    Environment = var.environment
  }
}

# Guardar credenciales en AWS Secrets Manager (para External Secrets Operator)
resource "aws_secretsmanager_secret" "db_credentials" {
  name = "gpuchile/${var.environment}/db"

  tags = {
    Environment = var.environment
  }
}

resource "aws_secretsmanager_secret_version" "db_credentials" {
  secret_id = aws_secretsmanager_secret.db_credentials.id
  secret_string = jsonencode({
    username = aws_db_instance.postgres.username
    password = random_password.db_password.result
    host     = aws_db_instance.postgres.address
    port     = aws_db_instance.postgres.port
    dbname   = aws_db_instance.postgres.db_name
    url      = "postgresql://${aws_db_instance.postgres.username}:${random_password.db_password.result}@${aws_db_instance.postgres.address}:${aws_db_instance.postgres.port}/${aws_db_instance.postgres.db_name}"
  })
}


########################################
ARCHIVO: .\terraform\modules\rds\outputs.tf
########################################

output "db_instance_endpoint" {
  description = "El endpoint de conexi√≥n de la base de datos"
  value       = aws_db_instance.postgres.endpoint
}

output "db_instance_name" {
  description = "El nombre de la base de datos"
  value       = aws_db_instance.postgres.db_name
}

output "db_secret_arn" {
  description = "ARN del secreto en Secrets Manager"
  value       = aws_secretsmanager_secret.db_credentials.arn
}

output "db_security_group_id" {
  description = "ID del security group de RDS"
  value       = aws_security_group.rds.id
}


########################################
ARCHIVO: .\terraform\modules\rds\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
}

variable "vpc_id" {
  description = "ID de la VPC"
  type        = string
}

variable "subnet_ids" {
  description = "Lista de subnet IDs para el subnet group"
  type        = list(string)
}

variable "allowed_security_group_id" {
  description = "Security Group ID del EKS cluster para permitir conexi√≥n"
  type        = string
}

variable "db_name" {
  description = "Nombre de la base de datos"
  type        = string
  default     = "gpuchile"
}

variable "db_username" {
  description = "Usuario maestro de la DB"
  type        = string
  default     = "gpuchile_admin"
}

variable "instance_class" {
  description = "Tipo de instancia RDS"
  type        = string
  default     = "db.t3.micro" # Free Tier eligible (750 horas/mes)
}

variable "allocated_storage" {
  description = "Almacenamiento en GB"
  type        = number
  default     = 20
}


########################################
ARCHIVO: .\terraform\modules\s3\main.tf
########################################

resource "aws_s3_bucket" "images" {
  bucket = var.bucket_name

  tags = {
    Name        = "GpuChile Images"
    Environment = var.environment
  }
}

# Bloquear acceso p√∫blico a nivel de bucket (security)
resource "aws_s3_bucket_public_access_block" "images" {
  bucket = aws_s3_bucket.images.id

  block_public_acls       = false
  block_public_policy     = false
  ignore_public_acls      = false
  restrict_public_buckets = false
}

# Pol√≠tica para permitir lectura p√∫blica en /thumbnails/
resource "aws_s3_bucket_policy" "images" {
  bucket = aws_s3_bucket.images.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid       = "PublicReadThumbnails"
        Effect    = "Allow"
        Principal = "*"
        Action    = "s3:GetObject"
        Resource  = "${aws_s3_bucket.images.arn}/thumbnails/*"
      },
      {
        Sid       = "PublicReadOriginals"
        Effect    = "Allow"
        Principal = "*"
        Action    = "s3:GetObject"
        Resource  = "${aws_s3_bucket.images.arn}/original/*"
      }
    ]
  })
}

# CORS para que el frontend pueda cargar im√°genes
resource "aws_s3_bucket_cors_configuration" "images" {
  bucket = aws_s3_bucket.images.id

  cors_rule {
    allowed_headers = ["*"]
    allowed_methods = ["GET", "HEAD"]
    allowed_origins = ["*"] # En prod: Especificar dominios exactos
    expose_headers  = ["ETag"]
    max_age_seconds = 3000
  }
}

# Versionado (Opcional, para recuperaci√≥n)
resource "aws_s3_bucket_versioning" "images" {
  bucket = aws_s3_bucket.images.id

  versioning_configuration {
    status = "Disabled" # En prod: Enabled
  }
}


########################################
ARCHIVO: .\terraform\modules\s3\outputs.tf
########################################

output "bucket_name" {
  description = "Nombre del bucket S3"
  value       = aws_s3_bucket.images.id
}

output "bucket_arn" {
  description = "ARN del bucket S3"
  value       = aws_s3_bucket.images.arn
}

output "bucket_regional_domain_name" {
  description = "Domain name regional del bucket"
  value       = aws_s3_bucket.images.bucket_regional_domain_name
}


########################################
ARCHIVO: .\terraform\modules\s3\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
}

variable "bucket_name" {
  description = "Nombre del bucket S3"
  type        = string
}


########################################
ARCHIVO: .\terraform\modules\secrets\main.tf
########################################

# Generar JWT Secret aleatorio
resource "random_password" "jwt_secret" {
  length  = 64
  special = true
}

# Secreto para JWT
resource "aws_secretsmanager_secret" "jwt" {
  name = "gpuchile/${var.environment}/jwt"

  tags = {
    Environment = var.environment
  }
}

resource "aws_secretsmanager_secret_version" "jwt" {
  secret_id = aws_secretsmanager_secret.jwt.id
  secret_string = jsonencode({
    secret = random_password.jwt_secret.result
  })
}

# Secreto para Redis (si lo usas en K8s como pod)
resource "aws_secretsmanager_secret" "redis" {
  name = "gpuchile/${var.environment}/redis"

  tags = {
    Environment = var.environment
  }
}

resource "aws_secretsmanager_secret_version" "redis" {
  secret_id = aws_secretsmanager_secret.redis.id
  secret_string = jsonencode({
    url = "redis://redis-service.default.svc.cluster.local:6379/0"
  })
}


########################################
ARCHIVO: .\terraform\modules\secrets\outputs.tf
########################################

output "jwt_secret_arn" {
  description = "ARN del secreto JWT"
  value       = aws_secretsmanager_secret.jwt.arn
}

output "redis_secret_arn" {
  description = "ARN del secreto Redis"
  value       = aws_secretsmanager_secret.redis.arn
}


########################################
ARCHIVO: .\terraform\modules\secrets\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue"
  type        = string
}


########################################
ARCHIVO: .\terraform\modules\vpc\main.tf
########################################

module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "5.1.2"

  name = "gpuchile-vpc-${var.environment}"
  cidr = var.vpc_cidr

  azs             = var.availability_zones
  private_subnets = var.private_subnets
  public_subnets  = var.public_subnets

  # ‚ö†Ô∏è COST SAVING: NAT Gateway desactivado ($32/mes ahorro)
  enable_nat_gateway = false
  single_nat_gateway = false
  enable_vpn_gateway = false

  # Requisitos EKS
  enable_dns_hostnames = true
  enable_dns_support   = true

  # ‚ö†Ô∏è CR√çTICO: IP p√∫blica autom√°tica para nodos (ya que no hay NAT)
  map_public_ip_on_launch = true

  # Tags requeridos por AWS Load Balancer Controller
  public_subnet_tags = {
    "kubernetes.io/role/elb"                    = 1
    "kubernetes.io/cluster/${var.cluster_name}" = "shared"
  }

  private_subnet_tags = {
    "kubernetes.io/role/internal-elb"           = 1
    "kubernetes.io/cluster/${var.cluster_name}" = "shared"
  }

  tags = {
    Environment = var.environment
    Terraform   = "true"
    Project     = "GpuChile"
  }
}


########################################
ARCHIVO: .\terraform\modules\vpc\outputs.tf
########################################

output "vpc_id" {
  description = "El ID de la VPC creada"
  value       = module.vpc.vpc_id
}

output "private_subnets" {
  description = "Lista de IDs de las subnets privadas"
  value       = module.vpc.private_subnets
}

output "public_subnets" {
  description = "Lista de IDs de las subnets p√∫blicas"
  value       = module.vpc.public_subnets
}

output "vpc_cidr_block" {
  description = "El bloque CIDR de la VPC"
  value       = module.vpc.vpc_cidr_block
}


########################################
ARCHIVO: .\terraform\modules\vpc\variables.tf
########################################

variable "environment" {
  description = "Entorno de despliegue (dev, prod)"
  type        = string
}

variable "vpc_cidr" {
  description = "Bloque CIDR principal para la VPC"
  type        = string
}

variable "availability_zones" {
  description = "Lista de zonas de disponibilidad"
  type        = list(string)
  default     = ["us-east-1a", "us-east-1b"]
}

variable "private_subnets" {
  description = "Lista de CIDRs para subnets privadas"
  type        = list(string)
  default     = ["10.0.1.0/24", "10.0.2.0/24"]
}

variable "public_subnets" {
  description = "Lista de CIDRs para subnets p√∫blicas"
  type        = list(string)
  default     = ["10.0.101.0/24", "10.0.102.0/24"]
}

variable "cluster_name" {
  description = "Nombre del cluster (necesario para tags de EKS)"
  type        = string
}
