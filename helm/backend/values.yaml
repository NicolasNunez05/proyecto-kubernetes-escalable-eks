# ============================================
# CONFIGURACIÃ“N DEL BACKEND - GPUCHILE
# ============================================

replicaCount: 1

image:
  repository: 592451843842.dkr.ecr.us-east-1.amazonaws.com/gpuchile-backend
  pullPolicy: IfNotPresent
  tag: "latest"

resources:
  limits:
    cpu: 500m
    memory: 768Mi
  requests:
    cpu: 250m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70

livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 2

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "PLACEHOLDER_ROLE_ARN"
  name: gpuchile-backend-sa

service:
  type: LoadBalancer
  port: 80
  targetPort: 8000
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

ingress:
  enabled: false
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.gpuchile.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: api-gpuchile-tls
      hosts:
        - api.gpuchile.com

externalSecrets:
  enabled: true
  secretStoreName: aws-secrets-store
  refreshInterval: 1h
  target:
    name: backend-secrets
  data:
    - secretKey: DATABASE_URL
      remoteRef:
        key: gpuchile/dev/db
        property: url
    - secretKey: REDIS_URL
      remoteRef:
        key: gpuchile/dev/redis
        property: url
    - secretKey: JWT_SECRET
      remoteRef:
        key: gpuchile/dev/jwt
        property: secret
    # AI Keys desde Secrets Manager
    - secretKey: GROQ_API_KEY
      remoteRef:
        key: gpuchile/dev/ai
        property: groq_key
    - secretKey: AGENTOPS_API_KEY
      remoteRef:
        key: gpuchile/dev/ai
        property: agentops_key

# Variables de entorno no sensibles
env:
  - name: ENVIRONMENT
    value: "production"
  - name: AWS_REGION
    value: "us-east-1"
  - name: S3_BUCKET_NAME
    value: "gpuchile-images-dev-nicolas-2026"
  - name: LOG_LEVEL
    value: "INFO"
